(function(e){function t(t){for(var n,s,o=t[0],c=t[1],l=t[2],d=0,m=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&m.push(a[s][0]),a[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(m.length)m.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var n={},a={app:0},i=[];function s(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=n,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;i.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"00c5":function(e,t,r){"use strict";var n=r("e1c6"),a=r.n(n);a.a},"07e5":function(e,t,r){"use strict";var n=r("b187"),a=r.n(n);a.a},"1a4c":function(e,t,r){},2250:function(e,t,r){},"360e":function(e,t,r){},"3d66":function(e,t,r){"use strict";var n=r("1a4c"),a=r.n(n);a.a},4678:function(e,t,r){var n={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(e){var t=i(e);return r(t)}function i(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=i,e.exports=a,a.id="4678"},"4a5e":function(e,t,r){"use strict";var n=r("2250"),a=r.n(n);a.a},"4b9e":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("4de4"),r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=r("c1df"),i=r.n(a),s=r("bc3a"),o=r.n(s),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return"success"===e.state?r("v-app",{staticClass:"app"},[e.user?r("EditDialog",{attrs:{"save-button-text":"Save",title:"Change password","event-name":"i-user"},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("ChangePasswordForm",{attrs:{"project-id":e.projectId,"item-id":e.user.id,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,1540666743),model:{value:e.passwordDialog,callback:function(t){e.passwordDialog=t},expression:"passwordDialog"}}):e._e(),e.user?r("EditDialog",{attrs:{"save-button-text":"Save",title:"Edit User","event-name":"i-user"},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("UserForm",{attrs:{"project-id":e.projectId,"item-id":e.user.id,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,3036806143),model:{value:e.userDialog,callback:function(t){e.userDialog=t},expression:"userDialog"}}):e._e(),r("EditDialog",{attrs:{"save-button-text":"Delete","max-width":1e3,"hide-buttons":!0},on:{close:function(t){return e.onTaskLogDialogClosed()}},scopedSlots:e._u([{key:"title",fn:function(t){return[r("div",{staticClass:"text-truncate",staticStyle:{"max-width":"calc(100% - 36px)"}},[r("router-link",{staticClass:"breadcrumbs__item breadcrumbs__item--link",attrs:{to:"/project/"+e.projectId+"/templates/"+(e.template?e.template.id:null)},on:{click:function(t){e.taskLogDialog=!1}}},[e._v(e._s(e.template?e.template.alias:null)+" ")]),r("v-icon",[e._v("mdi-chevron-right")]),r("span",{staticClass:"breadcrumbs__item"},[e._v("Task #"+e._s(e.task?e.task.id:null))])],1),r("v-spacer"),r("v-btn",{attrs:{icon:""},on:{click:function(t){e.taskLogDialog=!1,e.onTaskLogDialogClosed()}}},[r("v-icon",[e._v("mdi-close")])],1)]}},{key:"form",fn:function(t){return[r("TaskLogView",{attrs:{"project-id":e.projectId,"item-id":e.task?e.task.id:null}})]}}],null,!1,2107806164),model:{value:e.taskLogDialog,callback:function(t){e.taskLogDialog=t},expression:"taskLogDialog"}}),r("EditDialog",{attrs:{"save-button-text":"创建",title:"新项目","event-name":"i-project"},scopedSlots:e._u([{key:"form",fn:function(e){var t=e.onSave,n=e.onError,a=e.needSave,i=e.needReset;return[r("ProjectForm",{attrs:{"item-id":"new","need-save":a,"need-reset":i},on:{save:t,error:n}})]}}],null,!1,4121900462),model:{value:e.newProjectDialog,callback:function(t){e.newProjectDialog=t},expression:"newProjectDialog"}}),r("v-snackbar",{attrs:{color:e.snackbarColor,timeout:3e3,top:""},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(" "+e._s(e.snackbarText)+" "),r("v-btn",{attrs:{text:""},on:{click:function(t){e.snackbar=!1}}},[e._v(" Close ")])],1),e.$route.path.startsWith("/project/")?r("v-navigation-drawer",{attrs:{app:"",dark:"",color:"#005057",fixed:"",width:"260","mobile-breakpoint":"960"},scopedSlots:e._u([{key:"append",fn:function(){return[r("v-menu",{attrs:{top:"","max-width":"235","nudge-top":"12"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("v-list",{staticClass:"pa-0"},[r("v-list-item",e._g(e._b({key:"project"},"v-list-item",a,!1),n),[r("v-list-item-icon",[r("v-icon",[e._v("mdi-account")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v(e._s(e.user.name))])],1)],1)],1)]}}],null,!1,2989402144)},[r("v-list",[r("v-list-item",{key:"users",attrs:{to:"/users"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-account-multiple")])],1),r("v-list-item-content",[e._v(" 用户 ")])],1),r("v-list-item",{key:"edit",on:{click:function(t){e.userDialog=!0}}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-pencil")])],1),r("v-list-item-content",[e._v(" 编辑账户 ")])],1),r("v-list-item",{key:"password",on:{click:function(t){e.passwordDialog=!0}}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-lock")])],1),r("v-list-item-content",[e._v(" 修改密码 ")])],1),r("v-list-item",{key:"sign_out",on:{click:function(t){return e.signOut()}}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-exit-to-app")])],1),r("v-list-item-content",[e._v(" 退出 ")])],1)],1)],1)]},proxy:!0}],null,!1,2246549806),model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[e.project?r("v-menu",{attrs:{bottom:"","max-width":"235","max-height":"100%"},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("v-list",{staticClass:"pa-0 overflow-y-auto"},[r("v-list-item",e._g(e._b({key:"project",staticClass:"app__project-selector"},"v-list-item",a,!1),n),[r("v-list-item-icon",[r("v-avatar",{staticStyle:{"font-size":"13px","font-weight":"bold"},attrs:{color:e.getProjectColor(e.project),size:"24"}},[r("span",{staticClass:"white--text"},[e._v(e._s(e.getProjectInitials(e.project)))])])],1),r("v-list-item-content",[r("v-list-item-title",{staticClass:"app__project-selector-title"},[e._v(" "+e._s(e.project.name)+" ")])],1),r("v-list-item-icon",[r("v-icon",[e._v("mdi-chevron-down")])],1)],1)],1)]}}],null,!1,73063203)},[r("v-list",[e._l(e.projects,(function(t,n){return r("v-list-item",{key:n,attrs:{to:"/project/"+t.id},on:{click:function(r){return e.selectProject(t.id)}}},[r("v-list-item-icon",[r("v-avatar",{staticStyle:{"font-size":"13px","font-weight":"bold"},attrs:{color:e.getProjectColor(t),size:"24"}},[r("span",{staticClass:"white--text"},[e._v(e._s(e.getProjectInitials(t)))])])],1),r("v-list-item-content",[e._v(e._s(t.name))])],1)})),r("v-list-item",{on:{click:function(t){e.newProjectDialog=!0}}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-plus")])],1),r("v-list-item-content",[e._v(" New project... ")])],1)],2)],1):e._e(),e.project?e._e():r("v-list",{staticClass:"pt-0"},[r("v-list-item",{key:"new_project",attrs:{to:"/project/new"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-plus")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("New Project")])],1)],1)],1),e.project?r("v-list",{staticClass:"pt-0"},[r("v-list-item",{key:"dashboard",attrs:{to:"/project/"+e.projectId+"/history"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-view-dashboard")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("仪表盘")])],1)],1),r("v-list-item",{key:"templates",attrs:{to:e.templatesUrl}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-check-all")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("任务模板")])],1)],1),r("v-list-item",{key:"inventory",attrs:{to:"/project/"+e.projectId+"/inventory"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-monitor-multiple")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("主机清单")])],1)],1),r("v-list-item",{key:"environment",attrs:{to:"/project/"+e.projectId+"/environment"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-code-braces")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("运行环境")])],1)],1),r("v-list-item",{key:"keys",attrs:{to:"/project/"+e.projectId+"/keys"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-key-change")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("密钥库")])],1)],1),r("v-list-item",{key:"repositories",attrs:{to:"/project/"+e.projectId+"/repositories"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-git")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("剧本库")])],1)],1),r("v-list-item",{key:"team",attrs:{to:"/project/"+e.projectId+"/team"}},[r("v-list-item-icon",[r("v-icon",[e._v("mdi-account-multiple")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("团队")])],1)],1)],1):e._e()],1):e._e(),r("v-main",[r("router-view",{attrs:{projectId:e.projectId,userId:e.user?e.user.id:null}})],1)],1):"loading"===e.state?r("v-app",[r("v-main",[r("v-container",{staticClass:"pa-0",attrs:{fluid:"","fill-height":"","align-center":"","justify-center":""}},[r("v-progress-circular",{attrs:{size:70,color:"primary",indeterminate:""}})],1)],1)],1):"error"===e.state?r("v-app",[r("v-main",[r("v-container",{staticClass:"pa-0 text-center",attrs:{fluid:"","flex-column":"","fill-height":"","align-center":"","justify-center":""}},[r("v-alert",{staticClass:"d-inline-block",attrs:{text:"",color:"error"}},[r("h3",{staticClass:"headline"},[e._v(" 错误 ")]),e._v(" "+e._s(e.snackbarText)+" ")]),r("div",{staticClass:"mb-6"},[r("v-btn",{attrs:{text:"",color:"blue darken-1"},on:{click:function(t){return e.refreshPage()}}},[r("v-icon",{attrs:{left:""}},[e._v("mdi-refresh")]),e._v(" 刷新页面 ")],1),r("v-btn",{attrs:{text:"",color:"blue darken-1"},on:{click:function(t){return e.signOut()}}},[r("v-icon",{attrs:{left:""}},[e._v("mdi-exit-to-app")]),e._v(" Relogin ")],1)],1)],1)],1)],1):r("v-app")},l=[],u=(r("99af"),r("7db0"),r("c740"),r("caad"),r("45fc"),r("b0c0"),r("a9e3"),r("9129"),r("ac1f"),r("2532"),r("5319"),r("1276"),r("2ca0"),r("5530")),d=(r("96cf"),r("1da1"));function m(e){return e.response&&e.response.data&&e.response.data.error||e.message}var p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-dialog",{attrs:{"max-width":e.maxWidth||400,persistent:"",transition:!1,"content-class":"item-dialog item-dialog--"+e.position},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",[e._t("title",[e._v(e._s(e.title))])],2),r("v-card-text",{staticClass:"pb-0"},[e._t("form",null,{onSave:e.close,onError:e.clearFlags,needSave:e.needSave,needReset:e.needReset})],2),e.hideButtons?e._e():r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){return e.close()}}},[e._v(" 取消 ")]),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.needSave=!0}}},[e._v(" "+e._s(e.saveButtonText)+" ")])],1)],1)],1)},v=[],f=new n["a"],b={props:{position:String,title:String,saveButtonText:String,value:Boolean,maxWidth:Number,eventName:String,hideButtons:Boolean},data:function(){return{dialog:!1,needSave:!1,needReset:!1}},watch:{dialog:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$emit("input",e),t.needReset=e,e?window.addEventListener("keydown",t.handleEscape):window.removeEventListener("keydown",t.handleEscape);case 3:case"end":return r.stop()}}),r)})))()},value:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.dialog=e;case 1:case"end":return r.stop()}}),r)})))()}},methods:{close:function(e){this.dialog=!1,this.clearFlags(),e&&(this.$emit("save",e),this.eventName&&f.$emit(this.eventName,e)),this.$emit("close")},clearFlags:function(){this.needSave=!1,this.needReset=!1},handleEscape:function(e){"Escape"===e.key&&!1!==this.dialog&&this.close()}}},h=b,g=(r("4a5e"),r("2877")),k=r("6544"),_=r.n(k),w=r("8336"),j=r("b0af"),x=r("99d9"),y=r("169a"),I=r("2fa4"),T=Object(g["a"])(h,p,v,!1,null,null,null),S=T.exports;_()(T,{VBtn:w["a"],VCard:j["a"],VCardActions:x["a"],VCardText:x["b"],VCardTitle:x["c"],VDialog:y["a"],VSpacer:I["a"]});var V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"task-log-view",class:{"task-log-view--with-message":e.item.message}},[e.item.message?r("v-alert",{attrs:{type:"info",text:""}},[e._v(e._s(e.item.message)+" ")]):e._e(),r("v-container",{staticClass:"pa-0 mb-2"},[r("v-row",{attrs:{"no-gutters":""}},[r("v-col",[r("v-list",{staticClass:"pa-0",attrs:{"two-line":"",subheader:""}},[r("v-list-item",{staticClass:"pa-0"},[r("v-list-item-content",[r("div",[r("TaskStatus",{attrs:{status:e.item.status}})],1)])],1)],1)],1),r("v-col",[r("v-list",{staticClass:"pa-0",attrs:{"two-line":"",subheader:""}},[r("v-list-item",{staticClass:"pa-0"},[r("v-list-item-content",[r("v-list-item-title",[e._v("Author")]),r("v-list-item-subtitle",[e._v(e._s(e.user.name))])],1)],1)],1)],1),r("v-col",[r("v-list",{staticClass:"pa-0",attrs:{"two-line":"",subheader:""}},[r("v-list-item",{staticClass:"pa-0"},[r("v-list-item-content",[r("v-list-item-title",[e._v("Started")]),r("v-list-item-subtitle",[e._v(" "+e._s(e._f("formatDate")(e.item.start))+" ")])],1)],1)],1)],1),r("v-col",[r("v-list-item",{staticClass:"pa-0"},[r("v-list-item-content",[r("v-list-item-title",[e._v("Duration")]),r("v-list-item-subtitle",[e._v(" "+e._s(e._f("formatMilliseconds")([e.item.start,e.item.end]))+" ")])],1)],1)],1)],1)],1),r("div",{ref:"output",staticClass:"task-log-records"},e._l(e.output,(function(t){return r("div",{key:t.id,staticClass:"task-log-records__record"},[r("div",{staticClass:"task-log-records__time"},[e._v(" "+e._s(e._f("formatTime")(t.time))+" ")]),r("div",{staticClass:"task-log-records__output"},[e._v(e._s(t.output))])])})),0),"running"===e.item.status||"waiting"===e.item.status?r("v-btn",{staticStyle:{position:"absolute",bottom:"10px",right:"10px"},attrs:{color:"error"},on:{click:function(t){return e.stopTask()}}},[e._v(" Stop ")]):e._e()],1)},E=[],D=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.status?r("v-chip",{staticStyle:{"font-weight":"bold"},attrs:{color:e.getStatusColor(e.status)}},["running"!==e.status?r("v-icon",{attrs:{left:""}},[e._v(e._s(e.getStatusIcon(e.status)))]):r("IndeterminateProgressCircular",{staticStyle:{"margin-left":"-5px"}}),e._v(" "+e._s(e.humanizeStatus(e.status))+" ")],1):e._e()},R=[],O=(r("dca8"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-progress-circular",{staticClass:"indeterminate-progress-circular mr-2",attrs:{color:"white",size:"20",width:"10",rotate:e.rotate,value:e.value}})}),C=[],$=r("d4ec"),P=r("bee2"),N=r("45eb"),L=r("7e84"),A=r("262e"),U=r("2caf"),F=(r("a4d3"),r("e01a"),r("4160"),r("b64b"),r("d3b7"),r("159b"),function(){function e(){Object($["a"])(this,e),this.listeners={}}return Object(P["a"])(e,[{key:"addListener",value:function(e){var t=Symbol();return this.listeners[t]=e,t}},{key:"removeListener",value:function(e){return null!=this.listeners[e]&&(delete this.listeners[e],!0)}},{key:"callListeners",value:function(e){var t=this;Object.getOwnPropertySymbols(this.listeners).forEach((function(r){var n=t.listeners[r];n(e)}))}},{key:"hasListeners",value:function(){return Object.keys(this.listeners).length>0}}]),e}()),q=function(e){Object(A["a"])(r,e);var t=Object(U["a"])(r);function r(){var e;return Object($["a"])(this,r),e=t.call(this),e.direction=1,e.value=0,e.rotate=0,e}return Object(P["a"])(r,[{key:"start",value:function(){var e=1,t=this;t.valueTimer=setInterval((function(){1===t.direction&&t.value>=100?t.direction=-1:-1===t.direction&&t.value<=0&&(t.direction=1),1===t.direction?(t.rotate+=e,t.value+=e):(t.rotate+=5*e,t.value+=-e),t.rotate>360&&(t.rotate%=360),t.callListeners({value:t.value,rotate:t.rotate})}),50)}},{key:"stop",value:function(){clearInterval(this.valueTimer)}},{key:"addListener",value:function(e){return this.hasListeners()||this.start(),Object(N["a"])(Object(L["a"])(r.prototype),"addListener",this).call(this,e)}},{key:"removeListener",value:function(e){Object(N["a"])(Object(L["a"])(r.prototype),"removeListener",this).call(this,e),this.hasListeners()||this.stop()}}]),r}(F),B=new q,M={data:function(){return{value:null,rotate:null,listenerId:null}},mounted:function(){var e=this;this.value=B.value,this.rotate=B.rotate,this.listenerId=B.addListener((function(t){var r=t.value,n=t.rotate;e.value=r,e.rotate=n}))},beforeDestroy:function(){B.removeListener(this.listenerId)}},z=M,H=(r("3d66"),r("490a")),Y=Object(g["a"])(z,O,C,!1,null,null,null),K=Y.exports;_()(Y,{VProgressCircular:H["a"]});var W=Object.freeze({WAITING:"waiting",RUNNING:"running",SUCCESS:"success",ERROR:"error",STOPPING:"stopping",STOPPED:"stopped"}),G={components:{IndeterminateProgressCircular:K},props:{status:String},methods:{getStatusIcon:function(e){switch(e){case W.WAITING:return"mdi-alarm";case W.RUNNING:return"";case W.SUCCESS:return"mdi-check-circle";case W.ERROR:return"mdi-information";case W.STOPPING:return"mdi-stop-circle";case W.STOPPED:return"mdi-stop-circle";default:throw new Error("Unknown task status ".concat(e))}},humanizeStatus:function(e){switch(e){case W.WAITING:return"Waiting";case W.RUNNING:return"Running";case W.SUCCESS:return"Success";case W.ERROR:return"Failed";case W.STOPPING:return"Stopping...";case W.STOPPED:return"Stopped";default:throw new Error("Unknown task status ".concat(e))}},getStatusColor:function(e){switch(e){case W.WAITING:return"";case W.RUNNING:return"primary";case W.SUCCESS:return"success";case W.ERROR:return"error";case W.STOPPING:return"";case W.STOPPED:return"";default:throw new Error("Unknown task status ".concat(e))}}}},J=G,X=r("cc20"),Q=r("132d"),Z=Object(g["a"])(J,D,R,!1,null,null,null),ee=Z.exports;_()(Z,{VChip:X["a"],VIcon:Q["a"]});var te=function(e){Object(A["a"])(r,e);var t=Object(U["a"])(r);function r(e){var n;return Object($["a"])(this,r),n=t.call(this),n.websocketCreator=e,n}return Object(P["a"])(r,[{key:"start",value:function(){var e=this;if(null!=this.ws)throw new Error("Websocket already started. Please stop it before starting.");this.ws=this.websocketCreator(),this.ws.onclose=function(){e.isRunning()&&(e.ws=null,setTimeout((function(){e.start()}),2e3))},this.ws.onmessage=function(t){var r=t.data;e.callListeners(JSON.parse(r))}}},{key:"isRunning",value:function(){return null!=this.ws}},{key:"stop",value:function(){this.ws&&(this.ws.close(),delete this.ws)}}]),r}(F),re=new te((function(){var e="ws".concat(document.baseURI.substr(4));return new WebSocket("".concat(e,"api/ws"))})),ne=re,ae={components:{TaskStatus:ee},props:{itemId:Number,projectId:Number},data:function(){return{item:{},output:[],user:{}}},watch:{itemId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.reset(),t.next=3,e.loadData();case 3:case"end":return t.stop()}}),t)})))()},projectId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.reset(),t.next=3,e.loadData();case 3:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return ne.addListener((function(t){return e.onWebsocketDataReceived(t)})),t.next=3,e.loadData();case 3:case"end":return t.stop()}}),t)})))()},methods:{stopTask:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"post",url:"/api/project/".concat(e.projectId,"/tasks/").concat(e.itemId,"/stop"),responseType:"json"});case 2:case"end":return t.stop()}}),t)})))()},reset:function(){this.item={},this.output=[],this.user={}},onWebsocketDataReceived:function(e){var t=this;if(e.project_id===this.projectId&&e.task_id===this.itemId)switch(e.type){case"update":Object.assign(this.item,Object(u["a"])(Object(u["a"])({},e),{},{type:void 0}));break;case"log":this.output.push(e),setTimeout((function(){t.$refs.output.scrollTop=t.$refs.output.scrollHeight}),200);break;default:break}},loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/project/".concat(e.projectId,"/tasks/").concat(e.itemId),responseType:"json"});case 2:return e.item=t.sent.data,t.next=5,o()({method:"get",url:"/api/project/".concat(e.projectId,"/tasks/").concat(e.itemId,"/output"),responseType:"json"});case 5:return e.output=t.sent.data,t.next=8,o()({method:"get",url:"/api/users/".concat(e.item.user_id),responseType:"json"});case 8:e.user=t.sent.data;case 9:case"end":return t.stop()}}),t)})))()}}},ie=ae,se=(r("00c5"),r("0798")),oe=r("62ad"),ce=r("a523"),le=r("8860"),ue=r("da13"),de=r("5d23"),me=r("0fd9"),pe=Object(g["a"])(ie,V,E,!1,null,null,null),ve=pe.exports;_()(pe,{VAlert:se["a"],VBtn:w["a"],VCol:oe["a"],VContainer:ce["a"],VList:le["a"],VListItem:ue["a"],VListItemContent:de["a"],VListItemSubtitle:de["b"],VListItemTitle:de["c"],VRow:me["a"]});var fe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.item?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError))]),r("v-text-field",{attrs:{label:"项目名",rules:[function(e){return!!e||"Project name is required"}],required:"",disabled:e.formSaving},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}}),r("v-checkbox",{attrs:{label:"项目启用告警"},model:{value:e.item.alert,callback:function(t){e.$set(e.item,"alert",t)},expression:"item.alert"}}),r("v-text-field",{attrs:{label:"告警通信 ID",disabled:e.formSaving},model:{value:e.item.alert_chat,callback:function(t){e.$set(e.item,"alert_chat",t)},expression:"item.alert_chat"}})],1):e._e()},be=[],he={props:{itemId:[Number,String],projectId:[Number,String],needSave:Boolean,needReset:Boolean},data:function(){return{item:null,formValid:!1,formError:null,formSaving:!1}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:case"end":return t.stop()}}),t)})))()},computed:{isNew:function(){return"new"===this.itemId}},watch:{needSave:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=3;break}return r.next=3,t.save();case 3:case"end":return r.stop()}}),r)})))()},needReset:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e){r.next=3;break}return r.next=3,t.reset();case 3:case"end":return r.stop()}}),r)})))()}},methods:{reset:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.item=null,e.formError=null,e.$refs.form&&e.$refs.form.resetValidation(),t.next=5,e.loadData();case 5:case"end":return t.stop()}}),t)})))()},getItemsUrl:function(){throw new Error("Not implemented")},getSingleItemUrl:function(){throw new Error("Not implemented")},beforeSave:function(){},afterSave:function(){},afterLoadData:function(){},getNewItem:function(){return{}},loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isNew){t.next=4;break}e.item=e.getNewItem(),t.next=7;break;case 4:return t.next=6,o()({method:"get",url:e.getSingleItemUrl(),responseType:"json"});case 6:e.item=t.sent.data;case 7:return t.next=9,e.afterLoadData();case 9:case"end":return t.stop()}}),t)})))()},getRequestOptions:function(){return{}},save:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.formError=null,e.$refs.form.validate()){t.next=4;break}return e.$emit("error",{}),t.abrupt("return",null);case 4:return e.formSaving=!0,t.prev=5,t.next=8,e.beforeSave();case 8:return t.next=10,o()(Object(u["a"])({method:e.isNew?"post":"put",url:e.isNew?e.getItemsUrl():e.getSingleItemUrl(),responseType:"json",data:Object(u["a"])(Object(u["a"])({},e.item),{},{project_id:e.projectId})},e.getRequestOptions()));case 10:return r=t.sent.data,t.next=13,e.afterSave(r);case 13:e.$emit("save",{item:r||e.item,action:e.isNew?"new":"edit"}),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](5),e.formError=m(t.t0),e.$emit("error",{});case 20:return t.prev=20,e.formSaving=!1,t.finish(20);case 23:return t.abrupt("return",r||e.item);case 24:case"end":return t.stop()}}),t,null,[[5,16,20,23]])})))()}}},ge={mixins:[he],methods:{getItemsUrl:function(){return"/api/projects"},getSingleItemUrl:function(){return"/api/project/".concat(this.itemId)}}},ke=ge,_e=r("ac7c"),we=r("4bd4"),je=r("8654"),xe=Object(g["a"])(ke,fe,be,!1,null,null,null),ye=xe.exports;_()(xe,{VAlert:se["a"],VCheckbox:_e["a"],VForm:we["a"],VTextField:je["a"]});var Ie=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.item?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError))]),r("v-text-field",{attrs:{label:"Name",rules:[function(e){return!!e||"Name is required"}],required:"",disabled:e.formSaving},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}}),r("v-text-field",{attrs:{label:"Username",rules:[function(e){return!!e||"Username is required"}],required:"",disabled:e.formSaving},model:{value:e.item.username,callback:function(t){e.$set(e.item,"username",t)},expression:"item.username"}}),r("v-text-field",{attrs:{label:"Email",rules:[function(e){return!!e||"Email is required"}],required:"",disabled:e.formSaving},model:{value:e.item.email,callback:function(t){e.$set(e.item,"email",t)},expression:"item.email"}}),r("v-text-field",{attrs:{label:"Password",type:"password",required:e.isNew,rules:e.isNew?[function(e){return!!e||"Password is required"}]:[],disabled:e.formSaving},model:{value:e.item.password,callback:function(t){e.$set(e.item,"password",t)},expression:"item.password"}}),r("v-checkbox",{attrs:{label:"Admin user"},model:{value:e.item.admin,callback:function(t){e.$set(e.item,"admin",t)},expression:"item.admin"}}),r("v-checkbox",{attrs:{label:"Send alerts"},model:{value:e.item.alert,callback:function(t){e.$set(e.item,"alert",t)},expression:"item.alert"}})],1):e._e()},Te=[],Se={mixins:[he],methods:{getItemsUrl:function(){return"/api/users"},getSingleItemUrl:function(){return"/api/users/".concat(this.itemId)}}},Ve=Se,Ee=Object(g["a"])(Ve,Ie,Te,!1,null,null,null),De=Ee.exports;_()(Ee,{VAlert:se["a"],VCheckbox:_e["a"],VForm:we["a"],VTextField:je["a"]});var Re=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError))]),r("v-text-field",{attrs:{label:"Password",type:e.showPassword?"text":"password","append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",rules:[function(e){return!!e||"Password is required"}],required:"",disabled:e.formSaving},on:{"click:append":function(t){e.showPassword=!e.showPassword}},model:{value:e.item.password,callback:function(t){e.$set(e.item,"password",t)},expression:"item.password"}})],1)},Oe=[],Ce={mixins:[he],data:function(){return{showPassword:!1}},methods:{loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.item={};case 1:case"end":return t.stop()}}),t)})))()},getItemsUrl:function(){return null},getSingleItemUrl:function(){return null},getRequestOptions:function(){return{method:"post",url:"/api/users/".concat(this.itemId,"/password")}}}},$e=Ce,Pe=Object(g["a"])($e,Re,Oe,!1,null,null,null),Ne=Pe.exports;_()(Pe,{VAlert:se["a"],VForm:we["a"],VTextField:je["a"]});var Le=["red","blue","orange","green"],Ae={name:"App",components:{ChangePasswordForm:Ne,UserForm:De,EditDialog:S,TaskLogView:ve,ProjectForm:ye},data:function(){return{drawer:null,user:null,state:"loading",snackbar:!1,snackbarText:"",snackbarColor:"",projects:null,newProjectDialog:null,userDialog:null,passwordDialog:null,taskLogDialog:null,task:null,template:null}},watch:{projects:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(0!==e.length||!t.$route.path.startsWith("/project/")||"/project/new"===t.$route.path){r.next=3;break}return r.next=3,t.$router.push({path:"/project/new"});case 3:case"end":return r.stop()}}),r)})))()},$route:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:null==e.query.t?t.taskLogDialog=!1:(n=parseInt(t.$route.query.t||"",10),n&&f.$emit("i-show-task",{taskId:n}));case 1:case"end":return r.stop()}}),r)})))()}},computed:{projectId:function(){return parseInt(this.$route.params.projectId,10)||null},project:function(){var e=this;return this.projects.find((function(t){return t.id===e.projectId}))},isAuthenticated:function(){return document.cookie.includes("semaphore=")},templatesUrl:function(){var e=localStorage.getItem("project".concat(this.projectId,"__lastVisitedViewId"));return e&&(e=parseInt(e,10),!Number.isNaN(e))?"/project/".concat(this.projectId,"/views/").concat(e,"/templates"):"/project/".concat(this.projectId,"/templates")}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isAuthenticated){t.next=6;break}if("/auth/login"===e.$route.path){t.next=4;break}return t.next=4,e.$router.push({path:"/auth/login"});case 4:return e.state="success",t.abrupt("return");case 6:return t.prev=6,t.next=9,e.loadData();case 9:e.state="success",t.next=17;break;case 12:t.prev=12,t.t0=t["catch"](6),f.$emit("i-snackbar",{color:"error",text:m(t.t0)}),e.state="error",ne.stop();case 17:case"end":return t.stop()}}),t,null,[[6,12]])})))()},mounted:function(){var e=this;f.$on("i-snackbar",(function(t){e.snackbar=!0,e.snackbarColor=t.color,e.snackbarText=t.text})),f.$on("i-account-change",Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadUserInfo();case 2:case"end":return t.stop()}}),t)})))),f.$on("i-show-drawer",Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.drawer=!0;case 1:case"end":return t.stop()}}),t)})))),f.$on("i-show-task",function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(parseInt(e.$route.query.t||"",10)===r.taskId){t.next=4;break}return n=Object(u["a"])(Object(u["a"])({},e.$route.query),{},{t:r.taskId}),t.next=4,e.$router.replace({query:n});case 4:return t.next=6,o()({method:"get",url:"/api/project/".concat(e.projectId,"/tasks/").concat(r.taskId),responseType:"json"});case 6:return e.task=t.sent.data,t.next=9,o()({method:"get",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.task.template_id),responseType:"json"});case 9:e.template=t.sent.data,e.taskLogDialog=!0;case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),f.$on("i-open-last-project",Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.trySelectMostSuitableProject();case 2:case"end":return t.stop()}}),t)})))),f.$on("i-user",function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.t0=r.action,t.next="new"===t.t0?3:"edit"===t.t0?5:"delete"===t.t0?7:9;break;case 3:return n="User ".concat(r.item.name," created"),t.abrupt("break",10);case 5:return n="User ".concat(r.item.name," saved"),t.abrupt("break",10);case 7:return n="User ".concat(r.item.name," deleted"),t.abrupt("break",10);case 9:throw new Error("Unknown project action");case 10:if(f.$emit("i-snackbar",{color:"success",text:n}),!e.user||r.item.id!==e.user.id){t.next=14;break}return t.next=14,e.loadUserInfo();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),f.$on("i-project",function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(r){var n,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.projects.find((function(e){return e.id===r.item.id}))||r.item,i=a.name||"#".concat(a.id),t.t0=r.action,t.next="new"===t.t0?5:"edit"===t.t0?7:"delete"===t.t0?9:11;break;case 5:return n="Project ".concat(i," created"),t.abrupt("break",12);case 7:return n="Project ".concat(i," saved"),t.abrupt("break",12);case 9:return n="Project ".concat(i," deleted"),t.abrupt("break",12);case 11:throw new Error("Unknown project action");case 12:return f.$emit("i-snackbar",{color:"success",text:n}),t.next=15,e.loadProjects();case 15:t.t1=r.action,t.next="new"===t.t1?18:"delete"===t.t1?21:25;break;case 18:return t.next=20,e.selectProject(r.item.id);case 20:return t.abrupt("break",26);case 21:if(!(e.projectId===r.item.id&&e.projects.length>0)){t.next=24;break}return t.next=24,e.selectProject(e.projects[0].id);case 24:return t.abrupt("break",26);case 25:return t.abrupt("break",26);case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},methods:{onTaskLogDialogClosed:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=Object(u["a"])(Object(u["a"])({},e.$route.query),{},{t:void 0}),t.next=3,e.$router.replace({query:r});case 3:case"end":return t.stop()}}),t)})))()},loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return ne.isRunning()||ne.start(),t.next=3,e.loadUserInfo();case 3:return t.next=5,e.loadProjects();case 5:if("/"!==e.$route.path&&"/project"!==e.$route.path&&!e.$route.path.startsWith("/project/")){t.next=8;break}return t.next=8,e.trySelectMostSuitableProject();case 8:e.$route.query.t&&(r=parseInt(e.$route.query.t||"",10),r&&f.$emit("i-show-task",{taskId:r}));case 9:case"end":return t.stop()}}),t)})))()},trySelectMostSuitableProject:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.projects.length){t.next=5;break}if("/project/new"===e.$route.path){t.next=4;break}return t.next=4,e.$router.push({path:"/project/new"});case 4:return t.abrupt("return");case 5:if(e.projectId&&(r=e.projectId),null!=r&&e.projects.some((function(e){return e.id===r}))||!localStorage.getItem("projectId")||(r=parseInt(localStorage.getItem("projectId"),10)),null!=r&&e.projects.some((function(e){return e.id===r}))||(r=e.projects[0].id),null==r){t.next=11;break}return t.next=11,e.selectProject(r);case 11:case"end":return t.stop()}}),t)})))()},selectProject:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(localStorage.setItem("projectId",e),t.projectId!==e){r.next=3;break}return r.abrupt("return");case 3:return r.next=5,t.$router.push({path:"/project/".concat(e)});case 5:case"end":return r.stop()}}),r)})))()},loadProjects:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/projects",responseType:"json"});case 2:e.projects=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},loadUserInfo:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isAuthenticated){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,o()({method:"get",url:"/api/user",responseType:"json"});case 4:e.user=t.sent.data;case 5:case"end":return t.stop()}}),t)})))()},getProjectColor:function(e){var t=this.projects.length-this.projects.findIndex((function(t){return t.id===e.id}));return Le[t%Le.length]},getProjectInitials:function(e){var t=e.name.split(/\s/);return t.length>=2?"".concat(t[0][0]).concat(t[1][0]).toUpperCase():t[0].substr(0,2).toUpperCase()},signOut:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.snackbar=!1,e.snackbarColor="",e.snackbarText="",ne.stop(),t.next=6,o()({method:"post",url:"/api/auth/logout",responseType:"json"});case 6:if("/auth/login"===e.$route.path){t.next=10;break}return t.next=9,e.$router.push({path:"/auth/login"});case 9:e.state="success";case 10:case"end":return t.stop()}}),t)})))()},refreshPage:function(){var e=document,t=e.location;document.location=t}}},Ue=Ae,Fe=(r("5c0b"),r("7496")),qe=r("8212"),Be=r("34c3"),Me=r("f6c4"),ze=r("e449"),He=r("f774"),Ye=r("2db4"),Ke=Object(g["a"])(Ue,c,l,!1,null,null,null),We=Ke.exports;_()(Ke,{VAlert:se["a"],VApp:Fe["a"],VAvatar:qe["a"],VBtn:w["a"],VContainer:ce["a"],VIcon:Q["a"],VList:le["a"],VListItem:ue["a"],VListItemContent:de["a"],VListItemIcon:Be["a"],VListItemTitle:de["c"],VMain:Me["a"],VMenu:ze["a"],VNavigationDrawer:He["a"],VProgressCircular:H["a"],VSnackbar:Ye["a"],VSpacer:I["a"]});var Ge=r("8c4f"),Je=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items?r("div",[r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("仪表盘")]),r("v-spacer"),r("div",[r("v-tabs",{attrs:{centered:""}},[r("v-tab",{key:"history",attrs:{to:"/project/"+e.projectId+"/history"}},[e._v("历史")]),r("v-tab",{key:"activity",attrs:{to:"/project/"+e.projectId+"/activity"}},[e._v("动作")]),r("v-tab",{key:"settings",attrs:{to:"/project/"+e.projectId+"/settings"}},[e._v("设置")])],1)],1)],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"footer-props":{itemsPerPageOptions:[20]}},scopedSlots:e._u([{key:"item.tpl_alias",fn:function(t){var n=t.item;return[r("div",{staticClass:"d-flex"},[r("v-icon",{staticClass:"mr-3",attrs:{small:""}},[e._v(" "+e._s(e.TEMPLATE_TYPE_ICONS[n.tpl_type])+" ")]),r("TaskLink",{attrs:{"task-id":n.id,tooltip:n.message,label:"#"+n.id}}),r("v-icon",{staticClass:"ml-1 mr-1",attrs:{small:""}},[e._v("mdi-arrow-left")]),r("a",{attrs:{href:"/project/"+n.project_id+"/templates/"+n.template_id}},[e._v(e._s(n.tpl_alias))])],1)]}},{key:"item.version",fn:function(t){var n=t.item;return[""!==n.tpl_type?r("TaskLink",{staticClass:"ml-2",attrs:{disabled:"build"===n.tpl_type,status:n.status,"task-id":"build"===n.tpl_type?n.id:n.build_task.id,label:"build"===n.tpl_type?n.version:n.build_task.version,tooltip:"build"===n.tpl_type?n.message:n.build_task.message}}):r("div",{staticClass:"text-center"},[e._v("—")])]}},{key:"item.status",fn:function(e){var t=e.item;return[r("TaskStatus",{attrs:{status:t.status}})]}},{key:"item.start",fn:function(t){var r=t.item;return[e._v(" "+e._s(e._f("formatDate")(r.start))+" ")]}},{key:"item.end",fn:function(t){var r=t.item;return[e._v(" "+e._s(e._f("formatMilliseconds")([r.start,r.end]))+" ")]}}],null,!1,12502401)})],1):e._e()},Xe=[],Qe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-dialog",{attrs:{"max-width":"290"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",{staticClass:"headline"},[e._v(e._s(e.title))]),r("v-card-text",[e._v(e._s(e.text))]),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){return e.no()}}},[e._v(" "+e._s(e.noButtonTitle||"Cancel")+" ")]),r("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:function(t){return e.yes()}}},[e._v(" "+e._s(e.yesButtonTitle||"Yes")+" ")])],1)],1)],1)},Ze=[],et={props:{value:Boolean,title:String,text:String,yesButtonTitle:String,noButtonTitle:String},data:function(){return{dialog:!1}},watch:{dialog:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$emit("input",e);case 1:case"end":return r.stop()}}),r)})))()},value:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.dialog=e;case 1:case"end":return r.stop()}}),r)})))()}},methods:{yes:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$emit("yes"),e.dialog=!1;case 2:case"end":return t.stop()}}),t)})))()},no:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$emit("no"),e.dialog=!1;case 2:case"end":return t.stop()}}),t)})))()}}},tt=et,rt=Object(g["a"])(tt,Qe,Ze,!1,null,null,null),nt=rt.exports;_()(rt,{VBtn:w["a"],VCard:j["a"],VCardActions:x["a"],VCardText:x["b"],VCardTitle:x["c"],VDialog:y["a"],VSpacer:I["a"]});var at={components:{YesNoDialog:nt,EditDialog:S},props:{projectId:Number,userId:Number},data:function(){return{headers:this.getHeaders(),items:null,itemId:null,editDialog:null,deleteItemDialog:null}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.beforeLoadItems();case 2:return t.next=4,e.loadItems();case 4:case"end":return t.stop()}}),t)})))()},methods:{beforeLoadItems:function(){return Object(d["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},getSingleItemUrl:function(){throw new Error("Not implemented")},getHeaders:function(){throw new Error("Not implemented")},getEventName:function(){throw new Error("Not implemented")},showDrawer:function(){f.$emit("i-show-drawer")},onItemSave:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadItems();case 2:case"end":return t.stop()}}),t)})))()},askDeleteItem:function(e){this.itemId=e,this.deleteItemDialog=!0},deleteItem:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,n=t.items.find((function(t){return t.id===e})),r.next=4,o()({method:"delete",url:t.getSingleItemUrl(),responseType:"json"});case 4:return f.$emit(t.getEventName(),{action:"delete",item:n}),r.next=7,t.loadItems();case 7:r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](0),f.$emit("i-snackbar",{color:"error",text:m(r.t0)});case 12:case"end":return r.stop()}}),r,null,[[0,9]])})))()},editItem:function(e){this.itemId=e,this.editDialog=!0},loadItems:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:e.getItemsUrl(),responseType:"json"});case 2:e.items=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()}}},it=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",[null!=e.status?r("v-icon",{staticClass:"mr-1",attrs:{small:"",color:e.statusColor}},[e._v("mdi-"+e._s(e.statusIcon)+" ")]):e._e(),e.disabled?r("span",[e._v(e._s(e.label))]):r("v-tooltip",{attrs:{color:"black",right:"","max-width":"350",transition:"fade-transition",disabled:!e.tooltip},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,a=t.attrs;return[r("a",e._g(e._b({class:{"task-link-with-tooltip":e.tooltip},on:{click:function(t){return e.showTaskLog()}}},"a",a,!1),n),[e._v(e._s(e.label))])]}}])},[r("span",[e._v(e._s(e.tooltip))])])],1)},st=[],ot={props:{label:String,tooltip:String,taskId:Number,disabled:Boolean,status:String},computed:{statusColor:function(){switch(this.status){case"success":return"success";case"error":return"red";default:return"gray"}},statusIcon:function(){switch(this.status){case"success":return"check";case"error":return"close";default:return"clock-time-three-outline"}}},methods:{showTaskLog:function(){f.$emit("i-show-task",{taskId:this.taskId})}}},ct=ot,lt=(r("dc87"),r("3a2f")),ut=Object(g["a"])(ct,it,st,!1,null,null,null),dt=ut.exports;_()(ut,{VIcon:Q["a"],VTooltip:lt["a"]});var mt={"":"mdi-cog",build:"mdi-wrench",deploy:"mdi-rocket-launch"},pt={"":"Task",build:"Build",deploy:"Deploy"},vt={"":"Run",build:"Build",deploy:"Deploy"},ft={mixins:[at],data:function(){return{TEMPLATE_TYPE_ICONS:mt}},components:{TaskStatus:ee,TaskLink:dt},watch:{projectId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadItems();case 2:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;ne.addListener((function(t){return e.onWebsocketDataReceived(t)}))},methods:{showTaskLog:function(e){f.$emit("i-show-task",{taskId:e})},onWebsocketDataReceived:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.project_id===t.projectId&&"update"===e.type){r.next=2;break}return r.abrupt("return");case 2:if(t.items.some((function(t){return t.id===e.task_id}))){r.next=5;break}return r.next=5,t.loadItems();case 5:n=t.items.find((function(t){return t.id===e.task_id})),Object.assign(n,Object(u["a"])(Object(u["a"])({},e),{},{type:void 0}));case 7:case"end":return r.stop()}}),r)})))()},getHeaders:function(){return[{text:"任务",value:"tpl_alias",sortable:!1},{text:"版本",value:"version",sortable:!1},{text:"状态",value:"status",sortable:!1},{text:"用户",value:"user_name",sortable:!1},{text:"启动",value:"start",sortable:!1},{text:"持续时间",value:"end",sortable:!1}]},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/tasks/last")}}},bt=ft,ht=r("5bc1"),gt=r("8fea"),kt=r("71a3"),_t=r("fe57"),wt=r("71d9"),jt=r("2a7f"),xt=Object(g["a"])(bt,Je,Xe,!1,null,null,null),yt=xt.exports;_()(xt,{VAppBarNavIcon:ht["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VTab:kt["a"],VTabs:_t["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var It=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.items?r("div",[r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("仪表盘")]),r("v-spacer"),r("div",[r("v-tabs",{attrs:{centered:""}},[r("v-tab",{key:"history",attrs:{to:"/project/"+e.projectId+"/history"}},[e._v("历史")]),r("v-tab",{key:"activity",attrs:{to:"/project/"+e.projectId+"/activity"}},[e._v("动作")]),r("v-tab",{key:"settings",attrs:{to:"/project/"+e.projectId+"/settings"}},[e._v("设置")])],1)],1)],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"footer-props":{itemsPerPageOptions:[20]}},scopedSlots:e._u([{key:"item.created",fn:function(t){var r=t.item;return[e._v(" "+e._s(e._f("formatDate")(r.created))+" ")]}}],null,!1,2635796545)})],1):e._e()},Tt=[],St={mixins:[at],methods:{getHeaders:function(){return[{text:"时间",value:"created",sortable:!1,width:"20%"},{text:"用户",value:"username",sortable:!1,width:"10%"},{text:"描述",value:"description",sortable:!1,width:"70%"}]},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/events/last")}}},Vt=St,Et=Object(g["a"])(Vt,It,Tt,!1,null,null,null),Dt=Et.exports;_()(Et,{VAppBarNavIcon:ht["a"],VDataTable:gt["a"],VSpacer:I["a"],VTab:kt["a"],VTabs:_t["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var Rt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("YesNoDialog",{attrs:{title:"删除项目",text:"Are you really want to delete this project?"},on:{yes:function(t){return e.deleteProject()}},model:{value:e.deleteProjectDialog,callback:function(t){e.deleteProjectDialog=t},expression:"deleteProjectDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("仪表盘")]),r("v-spacer"),r("div",[r("v-tabs",{attrs:{centered:""}},[r("v-tab",{key:"history",attrs:{to:"/project/"+e.projectId+"/history"}},[e._v("历史")]),r("v-tab",{key:"activity",attrs:{to:"/project/"+e.projectId+"/activity"}},[e._v("动作")]),r("v-tab",{key:"settings",attrs:{to:"/project/"+e.projectId+"/settings"}},[e._v("设置")])],1)],1)],1),r("div",{staticClass:"project-settings-form"},[r("div",{staticStyle:{height:"220px"}},[r("ProjectForm",{ref:"form",attrs:{"item-id":e.projectId}})],1),r("div",{staticClass:"text-right"},[r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.saveProject()}}},[e._v("保存")])],1)]),r("div",{staticClass:"project-delete-form"},[r("v-row",{attrs:{align:"center"}},[r("v-col",{staticClass:"shrink"},[r("v-btn",{attrs:{color:"error"},on:{click:function(t){e.deleteProjectDialog=!0}}},[e._v("删除项目")])],1),r("v-col",{staticClass:"grow"},[r("div",{staticStyle:{"font-size":"14px",color:"#ff5252"}},[e._v(" Once you delete a project, there is no going back. Please be certain. ")])])],1)],1)],1)},Ot=[],Ct={components:{YesNoDialog:nt,ProjectForm:ye},props:{projectId:Number},data:function(){return{deleteProjectDialog:null}},methods:{showDrawer:function(){f.$emit("i-show-drawer")},saveProject:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.form.save();case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return");case 5:f.$emit("i-project",{action:"edit",item:r});case 6:case"end":return t.stop()}}),t)})))()},deleteProject:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o()({method:"delete",url:"/api/project/".concat(e.projectId),responseType:"json"});case 3:f.$emit("i-project",{action:"delete",item:{id:e.projectId}}),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),f.$emit("i-snackbar",{color:"error",text:m(t.t0)});case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))()}}},$t=Ct,Pt=(r("07e5"),Object(g["a"])($t,Rt,Ot,!1,null,null,null)),Nt=Pt.exports;_()(Pt,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VCol:oe["a"],VRow:me["a"],VSpacer:I["a"],VTab:kt["a"],VTabs:_t["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var Lt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isLoaded?r("div",[r("v-dialog",{attrs:{"max-width":400,persistent:"",transition:!1},model:{value:e.editViewsDialog,callback:function(t){e.editViewsDialog=t},expression:"editViewsDialog"}},[r("v-card",[r("v-card-title",[e._v(" 编辑视图 "),r("v-spacer"),r("v-btn",{attrs:{icon:""},on:{click:function(t){return e.closeEditViewDialog()}}},[r("v-icon",[e._v("mdi-close")])],1)],1),r("v-card-text",[r("EditViewsForm",{attrs:{"project-id":e.projectId}})],1)],1)],1),r("EditDialog",{attrs:{"max-width":700,"save-button-text":"创建",title:"新模板"},on:{save:function(t){return e.loadItems()}},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("TemplateForm",{attrs:{"project-id":e.projectId,"item-id":"new","need-save":i,"need-reset":s},on:{save:n,error:a}})]}}]),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("EditDialog",{attrs:{"save-button-text":e.TEMPLATE_TYPE_ACTION_TITLES[e.templateType],title:"新任务"},on:{save:e.onTaskCreated,close:function(t){e.itemId=null}},scopedSlots:e._u([{key:"title",fn:function(t){return[r("v-icon",{staticClass:"mr-4",attrs:{small:""}},[e._v(e._s(e.TEMPLATE_TYPE_ICONS[e.templateType]))]),r("span",{staticClass:"breadcrumbs__item"},[e._v(e._s(e.templateAlias))]),r("v-icon",[e._v("mdi-chevron-right")]),r("span",{staticClass:"breadcrumbs__item"},[e._v("新任务")])]}},{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("TaskForm",{attrs:{"project-id":e.projectId,"item-id":"new","template-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}]),model:{value:e.newTaskDialog,callback:function(t){e.newTaskDialog=t},expression:"newTaskDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("任务模板")]),r("v-spacer"),r("v-btn",{staticClass:"mr-1",attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("新模板 ")]),r("v-btn",{attrs:{icon:""},on:{click:function(t){e.settingsSheet=!0}}},[r("v-icon",[e._v("mdi-cog")])],1)],1),r("v-tabs",{staticClass:"pl-4",attrs:{"show-arrows":""},model:{value:e.viewTab,callback:function(t){e.viewTab=t},expression:"viewTab"}},[r("v-tab",{attrs:{to:e.getViewUrl(null),disabled:e.viewItemsLoading}},[e._v("All")]),e._l(e.views,(function(t){return r("v-tab",{key:t.id,attrs:{to:e.getViewUrl(t.id),disabled:e.viewItemsLoading}},[e._v(e._s(t.title)+" ")])})),r("v-btn",{staticClass:"mt-2 ml-4",attrs:{icon:""},on:{click:function(t){e.editViewsDialog=!0}}},[r("v-icon",[e._v("mdi-pencil")])],1)],2),r("v-data-table",{staticClass:"mt-4 templates-table",style:{opacity:e.viewItemsLoading?.3:1},attrs:{"hide-default-footer":"","single-expand":"","show-expand":"",headers:e.filteredHeaders,items:e.items,"items-per-page":Number.MAX_VALUE,expanded:e.openedItems},on:{"update:expanded":function(t){e.openedItems=t}},scopedSlots:e._u([{key:"item.alias",fn:function(t){var n=t.item;return[r("v-icon",{staticClass:"mr-3",attrs:{small:""}},[e._v(" "+e._s(e.TEMPLATE_TYPE_ICONS[n.type])+" ")]),r("router-link",{attrs:{to:e.viewId?"/project/"+e.projectId+"/views/"+e.viewId+"/templates/"+n.id:"/project/"+e.projectId+"/templates/"+n.id}},[e._v(e._s(n.alias))])]}},{key:"item.version",fn:function(t){var n=t.item;return[n.last_task&&""!==n.last_task.tpl_type?r("TaskLink",{attrs:{disabled:!0,status:n.last_task.status,"task-id":"build"===n.last_task.tpl_type?n.last_task.id:n.last_task.build_task.id,label:"build"===n.last_task.tpl_type?n.last_task.version:n.last_task.build_task.version,tooltip:"build"===n.last_task.tpl_type?n.last_task.message:n.last_task.build_task.message}}):r("div",[e._v("—")])]}},{key:"item.status",fn:function(t){var n=t.item;return[null!=n.last_task?r("div",{staticClass:"mt-2 mb-2 d-flex"},[r("TaskStatus",{attrs:{status:n.last_task.status}})],1):r("div",{staticClass:"mt-3 mb-2 d-flex",staticStyle:{color:"gray"}},[e._v("Not launched")])]}},{key:"item.last_task",fn:function(t){var n=t.item;return[null!=n.last_task?r("div",{staticClass:"mt-2 mb-2",staticStyle:{"line-height":"1"}},[r("TaskLink",{attrs:{"task-id":n.last_task.id,label:"#"+n.last_task.id,tooltip:n.last_task.message}}),r("div",{staticStyle:{color:"gray","font-size":"14px"}},[e._v(" by "+e._s(n.last_task.user_name)+" "+e._s(e._f("formatDate")(n.last_task.created))+" ")])],1):e._e()]}},{key:"item.inventory_id",fn:function(t){var r=t.item;return[e._v(" "+e._s(e.inventory.find((function(e){return e.id===r.inventory_id})).name)+" ")]}},{key:"item.environment_id",fn:function(t){var r=t.item;return[e._v(" "+e._s(e.environment.find((function(e){return e.id===r.environment_id})).name)+" ")]}},{key:"item.repository_id",fn:function(t){var r=t.item;return[e._v(" "+e._s(e.repositories.find((function(e){return e.id===r.repository_id})).name)+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("v-btn",{staticClass:"pl-1 pr-2",attrs:{text:"",color:"black"},on:{click:function(t){return e.createTask(n.id)}}},[r("v-icon",{staticClass:"pr-1"},[e._v("mdi-replay")]),e._v(" "+e._s(e.TEMPLATE_TYPE_ACTION_TITLES[n.type])+" ")],1)]}},{key:"expanded-item",fn:function(t){var n=t.headers,a=t.item;return[e.openedItems.some((function(e){return e.id===a.id}))?r("td",{attrs:{colspan:n.length}},[r("TaskList",{staticStyle:{border:"1px solid lightgray","border-radius":"6px",margin:"10px 0"},attrs:{template:a,limit:5,"hide-footer":!0}})],1):e._e()]}}])}),r("TableSettingsSheet",{attrs:{"table-name":"project__template",headers:e.headers},on:{change:e.onTableSettingsChange},model:{value:e.settingsSheet,callback:function(t){e.settingsSheet=t},expression:"settingsSheet"}})],1):r("div",[r("v-progress-linear",{attrs:{indeterminate:"",color:"primary darken-2"}})],1)},At=[],Ut=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isLoaded?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-dialog",{attrs:{"hide-overlay":"",width:"300"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-alert",{staticClass:"mb-0 pb-0",attrs:{border:"top","colored-border":"",type:"info",elevation:"2"}},["build_version"===e.helpKey?r("div",[r("p",[e._v(" Defines start version of your "),r("a",{attrs:{target:"_black",href:"https://en.wikipedia.org/wiki/Software_build"}},[e._v("artifact")]),e._v(". Each run increments the artifact version. ")]),r("p",[e._v(" For more information about building, see the "),r("a",{attrs:{href:"https://docs.ansible-semaphore.com/user-guide/task-templates#build",target:"_blank"}},[e._v("Task Template reference")]),e._v(". ")])]):"build"===e.helpKey?r("div",[r("p",[e._v(" Defines what "),r("a",{attrs:{target:"_black",href:"https://en.wikipedia.org/wiki/Software_build"}},[e._v("artifact")]),e._v(" should be deployed when the task run. ")]),r("p",[e._v(" For more information about deploying, see the "),r("a",{attrs:{href:"https://docs.ansible-semaphore.com/user-guide/task-templates#build",target:"_blank"}},[e._v("Task Template reference")]),e._v(". ")])]):e._e(),"cron"===e.helpKey?r("div",[r("p",[e._v("Defines autorun schedule.")]),r("p",[e._v(" For more information about cron, see the "),r("a",{attrs:{href:"https://pkg.go.dev/github.com/robfig/cron#hdr-CRON_Expression_Format",target:"_blank"}},[e._v("Cron expression format reference")]),e._v(". ")])]):e._e()])],1),r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError)+" ")]),r("v-row",[r("v-col",{staticClass:"pb-0",attrs:{cols:"12",md:"6"}},[r("v-card",{staticClass:"mb-6"},[r("v-tabs",{attrs:{"fixed-tabs":""},model:{value:e.itemTypeIndex,callback:function(t){e.itemTypeIndex=t},expression:"itemTypeIndex"}},e._l(Object.keys(e.TEMPLATE_TYPE_ICONS),(function(t){return r("v-tab",{key:t,staticStyle:{padding:"0"}},[r("v-icon",{staticClass:"mr-2",attrs:{small:""}},[e._v(e._s(e.TEMPLATE_TYPE_ICONS[t]))]),e._v(" "+e._s(e.TEMPLATE_TYPE_TITLES[t])+" ")],1)})),1),e.item.type?r("div",{staticClass:"ml-4 mr-4 mt-6"},["build"===e.item.type?r("v-text-field",{attrs:{label:"Start Version",rules:[function(e){return!!e||"Start Version is required"}],required:"",disabled:e.formSaving,placeholder:"Example: 0.0.0","append-outer-icon":"mdi-help-circle"},on:{"click:append-outer":function(t){return e.showHelpDialog("build_version")}},model:{value:e.item.start_version,callback:function(t){e.$set(e.item,"start_version",t)},expression:"item.start_version"}}):e._e(),"deploy"===e.item.type?r("v-select",{attrs:{label:"Build Template",items:e.buildTemplates,"item-value":"id","item-text":"alias",rules:[function(e){return!!e||"Build Template is required"}],required:"",disabled:e.formSaving,"append-outer-icon":"mdi-help-circle"},on:{"click:append-outer":function(t){return e.showHelpDialog("build")}},model:{value:e.item.build_template_id,callback:function(t){e.$set(e.item,"build_template_id",t)},expression:"item.build_template_id"}}):e._e()],1):e._e()],1),r("v-text-field",{attrs:{label:"剧本别名",rules:[function(e){return!!e||"Playbook Alias is required"}],required:"",disabled:e.formSaving},model:{value:e.item.alias,callback:function(t){e.$set(e.item,"alias",t)},expression:"item.alias"}}),r("v-text-field",{attrs:{label:"剧本文件",rules:[function(e){return!!e||"Playbook Filename is required"}],required:"",disabled:e.formSaving,placeholder:"Example: site.yml"},model:{value:e.item.playbook,callback:function(t){e.$set(e.item,"playbook",t)},expression:"item.playbook"}}),r("v-select",{attrs:{label:"主机清单",items:e.inventory,"item-value":"id","item-text":"name",rules:[function(e){return!!e||"Inventory is required"}],required:"",disabled:e.formSaving},model:{value:e.item.inventory_id,callback:function(t){e.$set(e.item,"inventory_id",t)},expression:"item.inventory_id"}}),r("v-select",{attrs:{label:"剧本仓库",items:e.repositories,"item-value":"id","item-text":"name",rules:[function(e){return!!e||"Playbook Repository is required"}],required:"",disabled:e.formSaving},model:{value:e.item.repository_id,callback:function(t){e.$set(e.item,"repository_id",t)},expression:"item.repository_id"}}),r("v-select",{attrs:{label:"运行环境",items:e.environment,"item-value":"id","item-text":"name",rules:[function(e){return!!e||"Environment is required"}],required:"",disabled:e.formSaving},model:{value:e.item.environment_id,callback:function(t){e.$set(e.item,"environment_id",t)},expression:"item.environment_id"}}),r("v-select",{attrs:{label:"库密码",clearable:"",items:e.loginPasswordKeys,"item-value":"id","item-text":"name",disabled:e.formSaving},model:{value:e.item.vault_key_id,callback:function(t){e.$set(e.item,"vault_key_id",t)},expression:"item.vault_key_id"}})],1),r("v-col",{staticClass:"pb-0",attrs:{cols:"12",md:"6"}},[r("v-textarea",{attrs:{outlined:"",label:"描述",disabled:e.formSaving,rows:"5"},model:{value:e.item.description,callback:function(t){e.$set(e.item,"description",t)},expression:"item.description"}}),r("codemirror",{style:{border:"1px solid lightgray"},attrs:{options:e.cmOptions,disabled:e.formSaving,placeholder:'Enter extra CLI Arguments...\nExample:\n[\n  "-i",\n  "@myinventory.sh",\n  "--private-key=/there/id_rsa",\n  "-vvvv"\n]'},model:{value:e.item.arguments,callback:function(t){e.$set(e.item,"arguments",t)},expression:"item.arguments"}}),r("v-select",{attrs:{label:"视图",clearable:"",items:e.views,"item-value":"id","item-text":"title",disabled:e.formSaving},model:{value:e.item.view_id,callback:function(t){e.$set(e.item,"view_id",t)},expression:"item.view_id"}}),null==e.schedules||e.schedules.length<=1?r("v-text-field",{staticClass:"mt-6",attrs:{label:"定时执行",disabled:e.formSaving,placeholder:"Example: 0 */5 * * *","append-outer-icon":"mdi-help-circle"},on:{"click:append-outer":function(t){return e.showHelpDialog("cron")}},model:{value:e.cronFormat,callback:function(t){e.cronFormat=t},expression:"cronFormat"}}):e._e()],1)],1)],1):e._e()},Ft=[],qt=(r("c975"),r("ddb0"),r("8f94")),Bt=(r("a7be"),r("693d"),r("d7d5"),{mixins:[he],components:{codemirror:qt["codemirror"]},props:{sourceItemId:String},data:function(){return{itemTypeIndex:0,TEMPLATE_TYPE_ICONS:mt,TEMPLATE_TYPE_TITLES:pt,cmOptions:{tabSize:2,mode:"application/json",lineNumbers:!0,line:!0,lint:!0,indentWithTabs:!1},item:null,keys:null,inventory:null,repositories:null,environment:null,schedules:null,views:null,cronFormat:null,helpDialog:null,helpKey:null}},watch:{needReset:function(e){e&&null!=this.item&&(this.item.template_id=this.templateId)},sourceItemId:function(e){this.item.template_id=e},itemTypeIndex:function(e){this.item.type=Object.keys(mt)[e]}},computed:{isLoaded:function(){return!(!this.isNew||null!=this.sourceItemId)||null!=this.keys&&null!=this.repositories&&null!=this.inventory&&null!=this.environment&&null!=this.item&&null!=this.schedules&&null!=this.views},loginPasswordKeys:function(){return null==this.keys?null:this.keys.filter((function(e){return"login_password"===e.type}))}},methods:{showHelpDialog:function(e){this.helpKey=e,this.helpDialog=!0},afterLoadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.sourceItemId){t.next=4;break}return t.next=3,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.sourceItemId),responseType:"json"});case 3:e.item=t.sent.data;case 4:return t.next=6,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/keys"),responseType:"json"});case 6:return e.keys=t.sent.data,t.next=9,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/repositories"),responseType:"json"});case 9:return e.repositories=t.sent.data,t.next=12,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/inventory"),responseType:"json"});case 12:return e.inventory=t.sent.data,t.next=15,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/environment"),responseType:"json"});case 15:return e.environment=t.sent.data,t.next=18,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/templates?type=build"),responseType:"json"});case 18:if(e.buildTemplates=t.sent.data.filter((function(e){return"build"===e.type})),!e.isNew){t.next=23;break}t.t0=[],t.next=26;break;case 23:return t.next=25,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.itemId,"/schedules"),responseType:"json"});case 25:t.t0=t.sent.data;case 26:return e.schedules=t.t0,t.next=29,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/views"),responseType:"json"});case 29:e.views=t.sent.data,1===e.schedules.length&&(e.cronFormat=e.schedules[0].cron_format),e.itemTypeIndex=Object.keys(mt).indexOf(e.item.type);case 32:case"end":return t.stop()}}),t)})))()},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/templates")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/templates/").concat(this.itemId)},beforeSave:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!=e.cronFormat&&""!==e.cronFormat){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,o()({method:"post",url:"/api/project/".concat(e.projectId,"/schedules/validate"),responseType:"json",data:{cron_format:e.cronFormat}});case 4:case"end":return t.stop()}}),t)})))()},afterSave:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e&&0!==t.schedules.length){r.next=6;break}if(null==t.cronFormat||""===t.cronFormat){r.next=4;break}return r.next=4,o()({method:"post",url:"/api/project/".concat(t.projectId,"/schedules"),responseType:"json",data:{project_id:t.projectId,template_id:e?e.id:t.itemId,cron_format:t.cronFormat}});case 4:r.next=16;break;case 6:if(!(t.schedules.length>1)){r.next=9;break}r.next=16;break;case 9:if(null!=t.cronFormat&&""!==t.cronFormat){r.next=14;break}return r.next=12,o()({method:"delete",url:"/api/project/".concat(t.projectId,"/schedules/").concat(t.schedules[0].id),responseType:"json"});case 12:r.next=16;break;case 14:return r.next=16,o()({method:"put",url:"/api/project/".concat(t.projectId,"/schedules/").concat(t.schedules[0].id),responseType:"json",data:{id:t.schedules[0].id,project_id:t.projectId,template_id:t.itemId,cron_format:t.cronFormat}});case 16:case"end":return r.stop()}}),r)})))()}}}),Mt=Bt,zt=r("b974"),Ht=r("a844"),Yt=Object(g["a"])(Mt,Ut,Ft,!1,null,null,null),Kt=Yt.exports;_()(Yt,{VAlert:se["a"],VCard:j["a"],VCol:oe["a"],VDialog:y["a"],VForm:we["a"],VIcon:Q["a"],VRow:me["a"],VSelect:zt["a"],VTab:kt["a"],VTabs:_t["a"],VTextField:je["a"],VTextarea:Ht["a"]});var Wt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isLoaded()?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError)+" ")]),r("v-alert",{attrs:{color:"blue",dark:"",icon:"mdi-source-fork",dismissible:"",prominent:""},model:{value:e.commitAvailable,callback:function(t){e.commitAvailable=t},expression:"commitAvailable"}},[r("div",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(e.commitHash?e.commitHash.substr(0,10):"")+" ")]),e.commitMessage?r("div",[e._v(e._s(e.commitMessage))]):e._e()]),"deploy"===e.template.type?r("v-select",{attrs:{label:"Build Version",items:e.buildTasks,"item-value":"id","item-text":function(e){return e.version+(e.message?" — "+e.message:"")},rules:[function(e){return!!e||"Build Version is required"}],required:"",disabled:e.formSaving},model:{value:e.item.build_task_id,callback:function(t){e.$set(e.item,"build_task_id",t)},expression:"item.build_task_id"}}):e._e(),r("v-text-field",{attrs:{label:"Message (Optional)",disabled:e.formSaving},model:{value:e.item.message,callback:function(t){e.$set(e.item,"message",t)},expression:"item.message"}}),r("v-row",{attrs:{"no-gutters":""}},[r("v-col",[r("v-checkbox",{attrs:{label:"Debug"},model:{value:e.item.debug,callback:function(t){e.$set(e.item,"debug",t)},expression:"item.debug"}})],1),r("v-col",[r("v-checkbox",{attrs:{label:"Dry Run"},model:{value:e.item.dry_run,callback:function(t){e.$set(e.item,"dry_run",t)},expression:"item.dry_run"}})],1)],1)],1):e._e()},Gt=[],Jt={mixins:[he],props:{templateId:Number,commitHash:String,commitMessage:String,buildTask:Object},data:function(){return{template:null,buildTasks:null,commitAvailable:null}},watch:{needReset:function(e){e&&(this.item.template_id=this.templateId)},templateId:function(e){this.item.template_id=e},commitHash:function(e){this.item.commit_hash=e,this.commitAvailable=null!=this.item.commit_hash},version:function(e){this.item.version=e},commitAvailable:function(e){this.item.commit_hash=e?this.commitHash:null}},methods:{isLoaded:function(){return null!=this.item&&null!=this.template&&null!=this.buildTasks},afterLoadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.item.template_id=e.templateId,t.next=3,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.templateId),responseType:"json"});case 3:if(e.template=t.sent.data,"deploy"!==e.template.type){t.next=10;break}return t.next=7,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.template.build_template_id,"/tasks"),responseType:"json"});case 7:t.t0=t.sent.data.filter((function(e){return null!=e.version&&"success"===e.status})),t.next=11;break;case 10:t.t0=[];case 11:e.buildTasks=t.t0,e.buildTasks.length>0&&(e.item.build_task_id=e.build_task?e.build_task.id:e.buildTasks[0].id),e.commitAvailable=null!=e.commitHash;case 14:case"end":return t.stop()}}),t)})))()},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/tasks")}}},Xt=Jt,Qt=Object(g["a"])(Xt,Wt,Gt,!1,null,null,null),Zt=Qt.exports;_()(Qt,{VAlert:se["a"],VCheckbox:_e["a"],VCol:oe["a"],VForm:we["a"],VRow:me["a"],VSelect:zt["a"],VTextField:je["a"]});var er=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.views?r("div",[e.views.length>0?r("draggable",{staticClass:"mb-5",attrs:{list:e.views,handle:".handle6785"},on:{end:e.onDragEnd}},e._l(e.views,(function(t){return r("div",{key:t.id,staticClass:"d-flex mb-2"},[r("v-icon",{staticClass:"handle6785",staticStyle:{cursor:"move"}},[e._v("mdi-menu")]),r("v-text-field",{staticClass:"ml-4 mr-1",attrs:{"hide-details":"",dense:"",solo:"",flat:!t.active,disabled:t.disabled},on:{focus:function(r){return e.editView(t.id)}},model:{value:t.title,callback:function(r){e.$set(t,"title",r)},expression:"view.title"}}),t.active?r("v-btn",{staticClass:"mt-1",attrs:{small:"",icon:"",disabled:t.disabled},on:{click:function(r){return e.saveView(t.id)}}},[r("v-icon",{attrs:{small:"",color:"green"}},[e._v("mdi-check")])],1):e._e(),t.active&&t.id>0?r("v-btn",{staticClass:"mt-1",attrs:{small:"",icon:"",disabled:t.disabled},on:{click:function(r){return e.resetView(t.id)}}},[r("v-icon",{attrs:{small:"",color:"red"}},[e._v("mdi-close")])],1):e._e(),r("v-btn",{staticClass:"ml-4",attrs:{icon:""},on:{click:function(r){return e.removeView(t.id)}}},[r("v-icon",[e._v("mdi-close")])],1)],1)})),0):r("v-alert",{attrs:{type:"info"}},[e._v("无视图")]),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.addView()}}},[e._v("添加视图")])],1):e._e()},tr=[],rr=(r("d81d"),r("13d5"),r("a434"),r("ade3")),nr=r("b76a"),ar=r.n(nr),ir={props:{projectId:Number},components:{draggable:ar.a},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/project/".concat(e.projectId,"/views"),responseType:"json"});case 2:e.views=t.sent.data.map((function(e){return Object(u["a"])(Object(u["a"])({},e),{},{active:!1,disabled:!1})})),e.views.sort((function(e,t){return e.position-t.position}));case 4:case"end":return t.stop()}}),t)})))()},data:function(){return{views:null}},methods:{onDragEnd:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.views.reduce((function(e,t,r){return t.id<0||t.position===r?e:Object(u["a"])(Object(u["a"])({},e),{},Object(rr["a"])({},t.id,r))}),{}),t.next=3,o()({method:"post",url:"/api/project/".concat(e.projectId,"/views/positions"),responseType:"json",data:r});case 3:Object.keys(r).map((function(e){return parseInt(e,10)})).forEach((function(t){var n=e.views.find((function(e){return e.id===t}));n.position=r[t]}));case 4:case"end":return t.stop()}}),t)})))()},saveView:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n,a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.views.findIndex((function(t){return t.id===e})),-1!==n){r.next=3;break}return r.abrupt("return");case 3:if(a=t.views[n],a.title){r.next=6;break}return r.abrupt("return");case 6:if(a.disabled=!0,r.prev=7,!(a.id<0)){r.next=15;break}return r.next=11,o()({method:"post",url:"/api/project/".concat(t.projectId,"/views"),responseType:"json",data:{project_id:t.projectId,title:a.title,position:n}});case 11:i=r.sent.data,a.id=i.id,r.next=17;break;case 15:return r.next=17,o()({method:"put",url:"/api/project/".concat(t.projectId,"/views/").concat(a.id),responseType:"json",data:{id:a.id,project_id:t.projectId,title:a.title,position:n}});case 17:return r.prev=17,a.disabled=!1,r.finish(17);case 20:a.active=!1;case 21:case"end":return r.stop()}}),r,null,[[7,,17,20]])})))()},resetView:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.views.find((function(t){return t.id===e})),null!=n){r.next=3;break}return r.abrupt("return");case 3:return n.disabled=!0,r.prev=4,r.next=7,o()({method:"get",url:"/api/project/".concat(t.projectId,"/views/").concat(n.id),responseType:"json"});case 7:a=r.sent.data,n.title=a.title;case 9:return r.prev=9,n.disabled=!1,r.finish(9);case 12:n.active=!1;case 13:case"end":return r.stop()}}),r,null,[[4,,9,12]])})))()},editView:function(e){var t=this.views.find((function(t){return t.id===e}));null!=t&&(t.active=!0)},removeView:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.views.findIndex((function(t){return t.id===e})),-1!==n){r.next=3;break}return r.abrupt("return");case 3:if(a=t.views[n],!(a.id>=0)){r.next=12;break}return a.disabled=!0,r.prev=6,r.next=9,o()({method:"delete",url:"/api/project/".concat(t.projectId,"/views/").concat(a.id),responseType:"json"});case 9:return r.prev=9,a.disabled=!1,r.finish(9);case 12:t.views.splice(n,1);case 13:case"end":return r.stop()}}),r,null,[[6,,9,12]])})))()},addView:function(){this.views.push({id:-Math.round(1e7*Math.random()),title:"",active:!0,disabled:!1})}}},sr=ir,or=Object(g["a"])(sr,er,tr,!1,null,null,null),cr=or.exports;_()(or,{VAlert:se["a"],VBtn:w["a"],VIcon:Q["a"],VTextField:je["a"]});var lr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.settings?r("PageBottomSheet",{model:{value:e.sheet,callback:function(t){e.sheet=t},expression:"sheet"}},[r("h4",[e._v("Columns")]),r("div",{staticClass:"d-flex flex-row flex-wrap"},e._l(e.headers.filter((function(e){return"actions"!==e.value})),(function(t){return r("v-checkbox",{key:t.value,staticClass:"mr-6",attrs:{label:t.text},on:{change:function(t){return e.saveSettings()}},model:{value:e.settings.columns[t.value].visible,callback:function(r){e.$set(e.settings.columns[t.value],"visible",r)},expression:"settings.columns[header.value].visible"}})})),1)]):e._e()},ur=[],dr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"sheet",staticClass:"page-bottom-sheet"},[r("v-bottom-sheet",{attrs:{attach:this.$refs.sheet,"hide-overlay":""},model:{value:e.sheet,callback:function(t){e.sheet=t},expression:"sheet"}},[r("v-sheet",{staticClass:"pa-4"},[e._t("default")],2)],1)],1)},mr=[],pr={props:{value:Boolean},data:function(){return{sheet:!1}},watch:{sheet:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$emit("input",e);case 1:case"end":return r.stop()}}),r)})))()},value:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.sheet=e;case 1:case"end":return r.stop()}}),r)})))()}}},vr=pr,fr=(r("cc42"),r("288c")),br=r("8dd9"),hr=Object(g["a"])(vr,dr,mr,!1,null,null,null),gr=hr.exports;_()(hr,{VBottomSheet:fr["a"],VSheet:br["a"]});var kr={props:{value:Boolean,tableName:String,headers:Array},components:{PageBottomSheet:gr},data:function(){return{sheet:!1,settings:null}},watch:{sheet:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.$emit("input",e);case 1:case"end":return r.stop()}}),r)})))()},value:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.sheet=e;case 1:case"end":return r.stop()}}),r)})))()},headers:function(){this.loadSettings()}},created:function(){this.loadSettings()},methods:{saveSettings:function(){localStorage.setItem("".concat(this.tableName,"__settings"),JSON.stringify(this.settings)),this.loadSettings()},loadSettings:function(){var e=this;localStorage.getItem("".concat(this.tableName,"__settings"))?this.settings=JSON.parse(localStorage.getItem("".concat(this.tableName,"__settings"))):this.settings={columns:{}},this.headers.forEach((function(t){e.settings.columns[t.value]||(e.settings.columns[t.value]={visible:!0})})),this.$emit("change",{settings:this.settings,headers:this.headers.filter((function(t){var r=e.settings.columns[t.value];return!r||r.visible}))})}}},_r=kr,wr=Object(g["a"])(_r,lr,ur,!1,null,null,null),jr=wr.exports;_()(wr,{VCheckbox:_e["a"]});var xr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.tasks?r("div",[r("EditDialog",{attrs:{"save-button-text":"Re"+e.getActionButtonTitle()},on:{save:e.onTaskCreated},scopedSlots:e._u([{key:"title",fn:function(t){return[r("v-icon",{staticClass:"mr-4"},[e._v(e._s(e.TEMPLATE_TYPE_ICONS[e.template.type]))]),r("span",{staticClass:"breadcrumbs__item"},[e._v(e._s(e.template.alias))]),r("v-icon",[e._v("mdi-chevron-right")]),r("span",{staticClass:"breadcrumbs__item"},[e._v("新任务")])]}},{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("TaskForm",{attrs:{"project-id":e.template.project_id,"item-id":"new","template-id":e.template.id,"need-save":i,"need-reset":s,"commit-hash":null==e.sourceTask?null:e.sourceTask.commit_hash,"commit-message":null==e.sourceTask?null:e.sourceTask.commit_message,build_task:null==e.sourceTask?null:e.sourceTask.build_task},on:{save:n,error:a}})]}}],null,!1,617670855),model:{value:e.newTaskDialog,callback:function(t){e.newTaskDialog=t},expression:"newTaskDialog"}}),r("v-data-table",{staticClass:"mt-0",attrs:{headers:e.headers,items:e.tasks,"hide-default-footer":e.hideFooter,"footer-props":{itemsPerPageOptions:[20]}},scopedSlots:e._u([{key:"item.id",fn:function(e){var t=e.item;return[r("TaskLink",{attrs:{"task-id":t.id,tooltip:t.message,label:"#"+t.id}})]}},{key:"item.version",fn:function(t){var n=t.item;return[""!==n.tpl_type?r("div",[r("TaskLink",{attrs:{disabled:"build"===n.tpl_type,"task-id":n.build_task_id,tooltip:"build"===n.tpl_type?n.message:n.build_task.message,label:"build"===n.tpl_type?n.version:n.build_task.version,status:n.status}})],1):r("div",[e._v("—")])]}},{key:"item.status",fn:function(e){var t=e.item;return[r("TaskStatus",{attrs:{status:t.status}})]}},{key:"item.start",fn:function(t){var r=t.item;return[e._v(" "+e._s(e._f("formatDate")(r.start))+" ")]}},{key:"item.end",fn:function(t){var r=t.item;return[e._v(" "+e._s(e._f("formatMilliseconds")([r.start,r.end]))+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("v-btn",{staticClass:"pl-1 pr-2",attrs:{text:"",color:"black"},on:{click:function(t){return e.createTask(n)}}},[r("v-icon",{staticClass:"pr-1"},[e._v("mdi-replay")]),e._v(" Re"+e._s(e.getActionButtonTitle())+" ")],1)]}}],null,!1,1106861552)})],1):e._e()},yr=[],Ir={components:{EditDialog:S,TaskStatus:ee,TaskForm:Zt,TaskLink:dt},props:{template:Object,limit:Number,hideFooter:Boolean},data:function(){return{headers:[{text:"Task ID",value:"id",sortable:!1},{text:"Version",value:"version",sortable:!1},{text:"Status",value:"status",sortable:!1},{text:"User",value:"user_name",sortable:!1},{text:"Start",value:"start",sortable:!1},{text:"Duration",value:"end",sortable:!1},{text:"Actions",value:"actions",sortable:!1,width:"0%"}],tasks:null,taskId:null,newTaskDialog:null,sourceTask:null,TEMPLATE_TYPE_ICONS:mt}},watch:{template:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:case"end":return t.stop()}}),t)})))()},methods:{loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tasks=null,t.next=3,o()({method:"get",url:"/api/project/".concat(e.template.project_id,"/templates/").concat(e.template.id,"/tasks/last?limit=").concat(e.limit||200),responseType:"json"});case 3:e.tasks=t.sent.data;case 4:case"end":return t.stop()}}),t)})))()},getActionButtonTitle:function(){return vt[this.template.type]},onTaskCreated:function(e){f.$emit("i-show-task",{taskId:e.item.id})},createTask:function(e){this.sourceTask=e,this.newTaskDialog=!0}}},Tr=Ir,Sr=Object(g["a"])(Tr,xr,yr,!1,null,null,null),Vr=Sr.exports;_()(Sr,{VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"]});var Er={components:{TemplateForm:Kt,TaskForm:Zt,TableSettingsSheet:jr,TaskStatus:ee,TaskLink:dt,TaskList:Vr,EditViewsForm:cr},mixins:[at],created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return ne.addListener((function(t){return e.onWebsocketDataReceived(t)})),t.next=3,e.loadData();case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{TEMPLATE_TYPE_ICONS:mt,TEMPLATE_TYPE_ACTION_TITLES:vt,inventory:null,environment:null,repositories:null,newTaskDialog:null,settingsSheet:null,filteredHeaders:[],openedItems:[],views:null,editViewsDialog:null,viewItemsLoading:null,viewTab:null}},computed:{viewId:function(){return/^-?\d+$/.test(this.$route.params.viewId)?parseInt(this.$route.params.viewId,10):this.$route.params.viewId},templateType:function(){var e=this;return null==this.itemId||"new"===this.itemId?"":this.items.find((function(t){return t.id===e.itemId})).type},templateAlias:function(){var e=this;return null==this.itemId||"new"===this.itemId?"":this.items.find((function(t){return t.id===e.itemId})).alias},isLoaded:function(){return this.items&&this.inventory&&this.environment&&this.repositories&&this.views}},watch:{viewId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.viewItemsLoading=!0,t.next=4,e.loadItems();case 4:e.viewId?localStorage.setItem("project".concat(e.projectId,"__lastVisitedViewId"),e.viewId):localStorage.removeItem("project".concat(e.projectId,"__lastVisitedViewId"));case 5:return t.prev=5,e.viewItemsLoading=!1,t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[0,,5,8]])})))()}},methods:{beforeLoadItems:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadViews();case 2:case"end":return t.stop()}}),t)})))()},getViewUrl:function(e){return null==e?"/project/".concat(this.projectId,"/templates"):"/project/".concat(this.projectId,"/views/").concat(e,"/templates")},loadViews:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/project/".concat(e.projectId,"/views"),responseType:"json"});case 2:if(e.views=t.sent.data,e.views.sort((function(e,t){return e.position-t.position})),null==e.viewId||e.views.some((function(t){return t.id===e.viewId}))){t.next=7;break}return t.next=7,e.$router.push({path:"/project/".concat(e.projectId,"/templates")});case 7:case"end":return t.stop()}}),t)})))()},closeEditViewDialog:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.editViewsDialog=!1,t.next=3,e.loadViews();case 3:case"end":return t.stop()}}),t)})))()},onWebsocketDataReceived:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.project_id===t.projectId&&"update"===e.type){r.next=2;break}return r.abrupt("return");case 2:if(n=t.items.find((function(t){return t.id===e.template_id})),null!=n){r.next=5;break}return r.abrupt("return");case 5:if(e.task_id===n.last_task_id){r.next=13;break}return r.t0=Object,r.t1=n.last_task,r.next=10,o()({method:"get",url:"/api/project/".concat(t.projectId,"/tasks/").concat(e.task_id),responseType:"json"});case 10:r.t2=r.sent.data,r.t0.assign.call(r.t0,r.t1,r.t2),n.last_task_id=e.task_id;case 13:Object.assign(n.last_task,Object(u["a"])(Object(u["a"])({},e),{},{type:void 0}));case 14:case"end":return r.stop()}}),r)})))()},onTaskCreated:function(e){f.$emit("i-show-task",{taskId:e.item.id}),this.itemId=null},showTaskLog:function(e){f.$emit("i-show-task",{taskId:e})},createTask:function(e){this.itemId=e,this.newTaskDialog=!0},getHeaders:function(){return[{text:"模板名称",value:"alias"},{text:"版本",value:"version",sortable:!1},{text:"状态",value:"status",sortable:!1},{text:"最近任务",value:"last_task",sortable:!1},{text:"剧本",value:"playbook",sortable:!1},{text:"主机清单",value:"inventory_id",sortable:!1},{text:"运行环境",value:"environment_id",sortable:!1},{text:"剧本库",value:"repository_id",sortable:!1},{text:"动作",value:"actions",sortable:!1,width:"0%"}]},getItemsUrl:function(){return null==this.viewId?"/api/project/".concat(this.projectId,"/templates"):"/api/project/".concat(this.projectId,"/views/").concat(this.viewId,"/templates")},loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/project/".concat(e.projectId,"/inventory"),responseType:"json"});case 2:return e.inventory=t.sent.data,t.next=5,o()({method:"get",url:"/api/project/".concat(e.projectId,"/environment"),responseType:"json"});case 5:return e.environment=t.sent.data,t.next=8,o()({method:"get",url:"/api/project/".concat(e.projectId,"/repositories"),responseType:"json"});case 8:e.repositories=t.sent.data;case 9:case"end":return t.stop()}}),t)})))()},onTableSettingsChange:function(e){var t=e.headers;this.filteredHeaders=t}}},Dr=Er,Rr=(r("5ad4"),r("8e36")),Or=Object(g["a"])(Dr,Lt,At,!1,null,null,null),Cr=Or.exports;_()(Or,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VCard:j["a"],VCardText:x["b"],VCardTitle:x["c"],VDataTable:gt["a"],VDialog:y["a"],VIcon:Q["a"],VProgressLinear:Rr["a"],VSpacer:I["a"],VTab:kt["a"],VTabs:_t["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var $r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isLoaded?r("div",[r("EditDialog",{attrs:{"max-width":700,"save-button-text":"Save",title:"编辑模板"},on:{save:function(t){return e.loadData()}},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("TemplateForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}]),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("EditDialog",{attrs:{"save-button-text":"创建",title:"新模板"},on:{save:e.onTemplateCopied},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("TemplateForm",{attrs:{"project-id":e.projectId,"item-id":"new","source-item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}]),model:{value:e.copyDialog,callback:function(t){e.copyDialog=t},expression:"copyDialog"}}),r("YesNoDialog",{attrs:{title:"删除模板",text:"Are you really want to delete this template?"},on:{yes:function(t){return e.remove()}},model:{value:e.deleteDialog,callback:function(t){e.deleteDialog=t},expression:"deleteDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",{staticClass:"breadcrumbs"},[r("router-link",{staticClass:"breadcrumbs__item breadcrumbs__item--link",attrs:{to:e.viewId?"/project/"+e.projectId+"/views/"+e.viewId+"/templates/":"/project/"+e.projectId+"/templates/"}},[e._v("Task Templates")]),r("v-icon",[e._v("mdi-chevron-right")]),r("span",{staticClass:"breadcrumbs__item"},[e._v(e._s(e.item.alias))])],1),r("v-spacer"),r("v-btn",{attrs:{icon:"",color:"error"},on:{click:function(t){e.deleteDialog=!0}}},[r("v-icon",[e._v("mdi-delete")])],1),r("v-btn",{attrs:{icon:"",color:"black"},on:{click:function(t){e.copyDialog=!0}}},[r("v-icon",[e._v("mdi-content-copy")])],1),r("v-btn",{attrs:{icon:"",color:"black"},on:{click:function(t){e.editDialog=!0}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1),r("v-container",[e.item.description?r("v-alert",{staticClass:"mb-0 ml-4 mr-4 mb-2",attrs:{text:"",type:"info"}},[e._v(e._s(e.item.description)+" ")]):e._e(),r("v-row",[r("v-col",[r("v-list",{attrs:{subheader:"",dense:""}},[r("v-list-item",[r("v-list-item-icon",[r("v-icon",[e._v("mdi-book-play")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("Playbook")]),r("v-list-item-subtitle",[e._v(e._s(e.item.playbook))])],1)],1)],1)],1),r("v-col",[r("v-list",{attrs:{subheader:"",dense:""}},[r("v-list-item",[r("v-list-item-icon",[r("v-icon",[e._v(e._s(e.TEMPLATE_TYPE_ICONS[e.item.type]))])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("Type")]),r("v-list-item-subtitle",[e._v(e._s(e.TEMPLATE_TYPE_TITLES[e.item.type]))])],1)],1)],1)],1),r("v-col",[r("v-list",{attrs:{subheader:"",dense:""}},[r("v-list-item",[r("v-list-item-icon",[r("v-icon",[e._v("mdi-monitor")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("Inventory")]),r("v-list-item-subtitle",[e._v(" "+e._s(e.inventory.find((function(t){return t.id===e.item.inventory_id})).name)+" ")])],1)],1)],1)],1),r("v-col",[r("v-list",{attrs:{subheader:"",dense:""}},[r("v-list-item",[r("v-list-item-icon",[r("v-icon",[e._v("mdi-code-braces")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("Environment")]),r("v-list-item-subtitle",[e._v(" "+e._s(e.environment.find((function(t){return t.id===e.item.environment_id})).name)+" ")])],1)],1)],1)],1),r("v-col",[r("v-list",{attrs:{subheader:"",dense:""}},[r("v-list-item",[r("v-list-item-icon",[r("v-icon",[e._v("mdi-git")])],1),r("v-list-item-content",[r("v-list-item-title",[e._v("Repository")]),r("v-list-item-subtitle",[e._v(" "+e._s(e.repositories.find((function(t){return t.id===e.item.repository_id})).name)+" ")])],1)],1)],1)],1)],1)],1),r("TaskList",{attrs:{template:e.item}})],1):r("div",[r("v-progress-linear",{attrs:{indeterminate:"",color:"primary darken-2"}})],1)},Pr=[],Nr={components:{YesNoDialog:nt,EditDialog:S,TemplateForm:Kt,TaskList:Vr},props:{projectId:Number},data:function(){return{item:null,inventory:null,environment:null,repositories:null,deleteDialog:null,editDialog:null,copyDialog:null,TEMPLATE_TYPE_ICONS:mt,TEMPLATE_TYPE_TITLES:pt,TEMPLATE_TYPE_ACTION_TITLES:vt}},computed:{viewId:function(){return/^-?\d+$/.test(this.$route.params.viewId)?parseInt(this.$route.params.viewId,10):this.$route.params.viewId},itemId:function(){return/^-?\d+$/.test(this.$route.params.templateId)?parseInt(this.$route.params.templateId,10):this.$route.params.templateId},isNew:function(){return"new"===this.itemId},isLoaded:function(){return this.item&&this.inventory&&this.environment&&this.repositories}},watch:{itemId:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.loadData();case 2:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isNew){t.next=5;break}return t.next=3,e.$router.replace({path:"/project/".concat(e.projectId,"/templates/new/edit")});case 3:t.next=7;break;case 5:return t.next=7,e.loadData();case 7:case"end":return t.stop()}}),t)})))()},methods:{showDrawer:function(){f.$emit("i-show-drawer")},remove:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o()({method:"delete",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.itemId),responseType:"json"});case 3:return f.$emit("i-snackbar",{color:"success",text:'Template "'.concat(e.item.alias,'" deleted')}),t.next=6,e.$router.push({path:"/project/".concat(e.projectId,"/templates")});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),f.$emit("i-snackbar",{color:"error",text:m(t.t0)});case 11:return t.prev=11,e.deleteDialog=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[0,8,11,14]])})))()},onTemplateCopied:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$router.push({path:"/project/".concat(t.projectId,"/templates/").concat(e.item.id)});case 2:case"end":return r.stop()}}),r)})))()},loadData:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/project/".concat(e.projectId,"/templates/").concat(e.itemId),responseType:"json"});case 2:return e.item=t.sent.data,t.next=5,o()({method:"get",url:"/api/project/".concat(e.projectId,"/inventory"),responseType:"json"});case 5:return e.inventory=t.sent.data,t.next=8,o()({method:"get",url:"/api/project/".concat(e.projectId,"/environment"),responseType:"json"});case 8:return e.environment=t.sent.data,t.next=11,o()({method:"get",url:"/api/project/".concat(e.projectId,"/repositories"),responseType:"json"});case 11:e.repositories=t.sent.data;case 12:case"end":return t.stop()}}),t)})))()}}},Lr=Nr,Ar=Object(g["a"])(Lr,$r,Pr,!1,null,null,null),Ur=Ar.exports;_()(Ar,{VAlert:se["a"],VAppBarNavIcon:ht["a"],VBtn:w["a"],VCol:oe["a"],VContainer:ce["a"],VIcon:Q["a"],VList:le["a"],VListItem:ue["a"],VListItemContent:de["a"],VListItemIcon:Be["a"],VListItemSubtitle:de["b"],VListItemTitle:de["c"],VProgressLinear:Rr["a"],VRow:me["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var Fr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items?r("div",[r("EditDialog",{attrs:{"save-button-text":"Save",title:"Edit Environment","max-width":500},on:{save:e.loadItems},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("EnvironmentForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,1874033041),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("YesNoDialog",{attrs:{title:"Delete environment",text:"Are you really want to delete this environment?"},on:{yes:function(t){return e.deleteItem(e.itemId)}},model:{value:e.deleteItemDialog,callback:function(t){e.deleteItemDialog=t},expression:"deleteItemDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("Environment")]),r("v-spacer"),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("New Environment")])],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","items-per-page":Number.MAX_VALUE},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticStyle:{"white-space":"nowrap"}},[r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.askDeleteItem(n.id)}}},[r("v-icon",[e._v("mdi-delete")])],1),r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.editItem(n.id)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1)]}}],null,!1,2194686913)})],1):e._e()},qr=[],Br=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.item?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError))]),r("v-text-field",{staticClass:"mb-4",attrs:{label:"Environment Name",rules:[function(e){return!!e||"Name is required"}],required:"",disabled:e.formSaving},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}}),r("codemirror",{style:{border:"1px solid lightgray"},attrs:{options:e.cmOptions,placeholder:"Enter environment JSON..."},model:{value:e.item.json,callback:function(t){e.$set(e.item,"json",t)},expression:"item.json"}}),r("v-alert",{staticClass:"mt-4",attrs:{dense:"",text:"",type:"info"}},[e._v(" Environment must be valid JSON. You may use the key "),r("code",[e._v("ENV")]),e._v(" to pass environment variables to ansible-playbook. Example: "),r("pre",{staticStyle:{"font-size":"14px"}},[e._v('{\n  "var_available_in_playbook_1": 1245,\n  "var_available_in_playbook_2": "test",\n  "ENV": {\n    "VAR1": "Read by lookup(\'env\', \'VAR1\')"\n  }\n}')])])],1):e._e()},Mr=[],zr={mixins:[he],components:{codemirror:qt["codemirror"]},data:function(){return{cmOptions:{tabSize:2,mode:"application/json",lineNumbers:!0,line:!0,lint:!0,indentWithTabs:!1}}},methods:{getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/environment")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/environment/").concat(this.itemId)}}},Hr=zr,Yr=Object(g["a"])(Hr,Br,Mr,!1,null,null,null),Kr=Yr.exports;_()(Yr,{VAlert:se["a"],VForm:we["a"],VTextField:je["a"]});var Wr={components:{EnvironmentForm:Kr},mixins:[at],methods:{getHeaders:function(){return[{text:"Name",value:"name",width:"100%"},{text:"Actions",value:"actions",sortable:!1}]},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/environment")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/environment/").concat(this.itemId)},getEventName:function(){return"i-environment"}}},Gr=Wr,Jr=Object(g["a"])(Gr,Fr,qr,!1,null,null,null),Xr=Jr.exports;_()(Jr,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var Qr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items?r("div",[r("EditDialog",{attrs:{"save-button-text":"new"===e.itemId?"Create":"Save",title:("new"===e.itemId?"New":"Edit")+" Inventory","max-width":450},on:{save:e.loadItems},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("InventoryForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,3949045006),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("YesNoDialog",{attrs:{title:"Delete inventory",text:"Are you really want to delete this inventory?"},on:{yes:function(t){return e.deleteItem(e.itemId)}},model:{value:e.deleteItemDialog,callback:function(t){e.deleteItemDialog=t},expression:"deleteItemDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("Inventory")]),r("v-spacer"),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("New Inventory")])],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","items-per-page":Number.MAX_VALUE},scopedSlots:e._u([{key:"item.type",fn:function(t){var n=t.item;return[r("code",[e._v(e._s(n.type))])]}},{key:"item.inventory",fn:function(t){var r=t.item;return[e._v(" "+e._s("file"===r.type?r.inventory:"—")+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticStyle:{"white-space":"nowrap"}},[r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.askDeleteItem(n.id)}}},[r("v-icon",[e._v("mdi-delete")])],1),r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.editItem(n.id)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1)]}}],null,!1,2537040050)})],1):e._e()},Zr=[],en=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.item&&null!=e.keys?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError))]),r("v-text-field",{attrs:{label:"Name",rules:[function(e){return!!e||"Name is required"}],required:"",disabled:e.formSaving},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}}),r("v-select",{attrs:{label:"User Credentials",items:e.keys,"item-value":"id","item-text":"name",rules:[function(e){return!!e||"User Credentials is required"}],required:"",disabled:e.formSaving},model:{value:e.item.ssh_key_id,callback:function(t){e.$set(e.item,"ssh_key_id",t)},expression:"item.ssh_key_id"}}),r("v-select",{attrs:{label:"Sudo Credentials (Optional)",clearable:"",items:e.loginPasswordKeys,"item-value":"id","item-text":"name",disabled:e.formSaving},model:{value:e.item.become_key_id,callback:function(t){e.$set(e.item,"become_key_id",t)},expression:"item.become_key_id"}}),r("v-select",{attrs:{label:"Type",rules:[function(e){return!!e||"Type is required"}],items:e.inventoryTypes,"item-value":"id","item-text":"name",required:"",disabled:e.formSaving},model:{value:e.item.type,callback:function(t){e.$set(e.item,"type",t)},expression:"item.type"}}),"file"===e.item.type?r("v-text-field",{attrs:{label:"Path to Inventory file",rules:[function(e){return!!e||"Path to Inventory file is required"}],required:"",disabled:e.formSaving},model:{value:e.item.inventory,callback:function(t){e.$set(e.item,"inventory",t)},expression:"item.inventory"}}):e._e(),"static"===e.item.type?r("codemirror",{style:{border:"1px solid lightgray"},attrs:{options:e.cmOptions,placeholder:"Enter inventory..."},model:{value:e.item.inventory,callback:function(t){e.$set(e.item,"inventory",t)},expression:"item.inventory"}}):e._e(),"static"===e.item.type?r("v-alert",{staticClass:"mt-4",attrs:{dense:"",text:"",type:"info"}},[e._v(" Static inventory example: "),r("pre",{staticStyle:{"font-size":"14px"}},[e._v("[website]\n172.18.8.40\n172.18.8.41")])]):e._e()],1):e._e()},tn=[],rn={mixins:[he],components:{codemirror:qt["codemirror"]},data:function(){return{cmOptions:{tabSize:2,mode:"text/x-ini",lineNumbers:!0,line:!0,lint:!0,indentWithTabs:!1},keys:null,inventoryTypes:[{id:"static",name:"Static"},{id:"file",name:"File"}]}},computed:{loginPasswordKeys:function(){return null==this.keys?null:this.keys.filter((function(e){return"login_password"===e.type}))}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/keys"),responseType:"json"});case 2:e.keys=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},methods:{getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/inventory")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/inventory/").concat(this.itemId)}}},nn=rn,an=(r("a427"),Object(g["a"])(nn,en,tn,!1,null,null,null)),sn=an.exports;_()(an,{VAlert:se["a"],VForm:we["a"],VSelect:zt["a"],VTextField:je["a"]});var on={mixins:[at],components:{InventoryForm:sn},methods:{getHeaders:function(){return[{text:"Name",value:"name",width:"33.33%"},{text:"Type",value:"type",width:"33.33%"},{text:"Path",value:"inventory",width:"33.33%"},{text:"Actions",value:"actions",sortable:!1}]},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/inventory")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/inventory/").concat(this.itemId)},getEventName:function(){return"i-inventory"}}},cn=on,ln=Object(g["a"])(cn,Qr,Zr,!1,null,null,null),un=ln.exports;_()(ln,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var dn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items?r("div",[r("EditDialog",{attrs:{"save-button-text":"new"===e.itemId?"Create":"Save",title:("new"===e.itemId?"New":"Edit")+" Key","max-width":450,position:"top"},on:{save:function(t){return e.loadItems()}},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("KeyForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,230075347),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("YesNoDialog",{attrs:{title:"Delete key",text:"Are you really want to delete this key?"},on:{yes:function(t){return e.deleteItem(e.itemId)}},model:{value:e.deleteItemDialog,callback:function(t){e.deleteItemDialog=t},expression:"deleteItemDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("Key Store")]),r("v-spacer"),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("New Key")])],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","items-per-page":Number.MAX_VALUE},scopedSlots:e._u([{key:"item.type",fn:function(t){var n=t.item;return[r("code",[e._v(e._s(n.type))])]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticStyle:{"white-space":"nowrap"}},[r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.askDeleteItem(n.id)}}},[r("v-icon",[e._v("mdi-delete")])],1),r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.editItem(n.id)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1)]}}],null,!1,328709053)})],1):e._e()},mn=[],pn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.item?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError)+" ")]),r("v-text-field",{attrs:{label:"Key Name",rules:[function(e){return!!e||"Name is required"}],required:"",disabled:e.formSaving},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}}),r("v-select",{attrs:{label:"Type",rules:[function(t){return!!t||!e.canEditSecrets||"Type is required"}],items:e.inventoryTypes,"item-value":"id","item-text":"name",required:e.canEditSecrets,disabled:e.formSaving||!e.canEditSecrets},model:{value:e.item.type,callback:function(t){e.$set(e.item,"type",t)},expression:"item.type"}}),"ssh"===e.item.type?r("v-text-field",{attrs:{label:"Passphrase (Optional)",disabled:e.formSaving||!e.canEditSecrets},model:{value:e.item.login_password.passphrase,callback:function(t){e.$set(e.item.login_password,"passphrase",t)},expression:"item.login_password.passphrase"}}):e._e(),"ssh"===e.item.type?r("v-textarea",{attrs:{outlined:"",label:"Private Key",disabled:e.formSaving||!e.canEditSecrets,rules:[function(e){return!!e||"Private Key is required"}]},model:{value:e.item.ssh.private_key,callback:function(t){e.$set(e.item.ssh,"private_key",t)},expression:"item.ssh.private_key"}}):e._e(),"login_password"===e.item.type?r("v-text-field",{attrs:{label:"Login (Optional)",disabled:e.formSaving||!e.canEditSecrets},model:{value:e.item.login_password.login,callback:function(t){e.$set(e.item.login_password,"login",t)},expression:"item.login_password.login"}}):e._e(),"login_password"===e.item.type?r("v-text-field",{attrs:{label:"Password",rules:[function(t){return!!t||!e.canEditSecrets||"Password is required"}],required:e.canEditSecrets,disabled:e.formSaving||!e.canEditSecrets,autocomplete:"new-password"},model:{value:e.item.login_password.password,callback:function(t){e.$set(e.item.login_password,"password",t)},expression:"item.login_password.password"}}):e._e(),e.isNew?e._e():r("v-checkbox",{attrs:{label:"Override"},model:{value:e.item.override_secret,callback:function(t){e.$set(e.item,"override_secret",t)},expression:"item.override_secret"}}),"none"===e.item.type?r("v-alert",{attrs:{dense:"",text:"",type:"info"}},[e._v(" Use this type of key for HTTPS repositories and for playbooks which use non-SSH connections. ")]):e._e()],1):e._e()},vn=[],fn={mixins:[he],data:function(){return{inventoryTypes:[{id:"ssh",name:"SSH Key"},{id:"login_password",name:"Login with password"},{id:"none",name:"None"}]}},computed:{canEditSecrets:function(){return this.isNew||this.item.override_secret}},methods:{getNewItem:function(){return{ssh:{},login_password:{}}},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/keys")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/keys/").concat(this.itemId)}}},bn=fn,hn=Object(g["a"])(bn,pn,vn,!1,null,null,null),gn=hn.exports;_()(hn,{VAlert:se["a"],VCheckbox:_e["a"],VForm:we["a"],VSelect:zt["a"],VTextField:je["a"],VTextarea:Ht["a"]});var kn={components:{KeyForm:gn},mixins:[at],methods:{getHeaders:function(){return[{text:"Name",value:"name",width:"50%"},{text:"Type",value:"type",width:"50%"},{text:"Actions",value:"actions",sortable:!1}]},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/keys")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/keys/").concat(this.itemId)},getEventName:function(){return"i-keys"}}},_n=kn,wn=Object(g["a"])(_n,dn,mn,!1,null,null,null),jn=wn.exports;_()(wn,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var xn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items&&null!=e.keys?r("div",[r("EditDialog",{attrs:{"save-button-text":"new"===e.itemId?"Create":"Save",title:("new"===e.itemId?"New":"Edit")+" Repository"},on:{save:function(t){return e.loadItems()}},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("RepositoryForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,1393318470),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("YesNoDialog",{attrs:{title:"Delete repository",text:"Are you really want to delete this repository?"},on:{yes:function(t){return e.deleteItem(e.itemId)}},model:{value:e.deleteItemDialog,callback:function(t){e.deleteItemDialog=t},expression:"deleteItemDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("Playbook Repositories")]),r("v-spacer"),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("New Repository")])],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","items-per-page":Number.MAX_VALUE},scopedSlots:e._u([{key:"item.ssh_key_id",fn:function(t){var r=t.item;return[e._v(" "+e._s(e.keys.find((function(e){return e.id===r.ssh_key_id})).name)+" ")]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticStyle:{"white-space":"nowrap"}},[r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.askDeleteItem(n.id)}}},[r("v-icon",[e._v("mdi-delete")])],1),r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.editItem(n.id)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1)]}}],null,!1,1858921276)})],1):e._e()},yn=[],In=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.item&&null!=e.keys?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError)+" ")]),r("v-text-field",{attrs:{label:"Name",rules:[function(e){return!!e||"Name is required"}],required:"",disabled:e.formSaving},model:{value:e.item.name,callback:function(t){e.$set(e.item,"name",t)},expression:"item.name"}}),r("v-text-field",{attrs:{label:"Repository URL",rules:[function(e){return!!e||"Repository is required"}],required:"",disabled:e.formSaving,"append-outer-icon":"mdi-help-circle"},on:{"click:append-outer":function(t){return e.showHelpDialog("url")}},model:{value:e.item.git_url,callback:function(t){e.$set(e.item,"git_url",t)},expression:"item.git_url"}}),r("v-select",{attrs:{label:"Access Key","append-outer-icon":"mdi-help-circle",items:e.keys,"item-value":"id","item-text":"name",rules:[function(e){return!!e||"Key is required"}],required:"",disabled:e.formSaving},on:{"click:append-outer":function(t){return e.showHelpDialog("key")}},model:{value:e.item.ssh_key_id,callback:function(t){e.$set(e.item,"ssh_key_id",t)},expression:"item.ssh_key_id"}}),r("v-dialog",{attrs:{"hide-overlay":"",width:"300"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-alert",{staticClass:"mb-0",attrs:{border:"top","colored-border":"",type:"info",elevation:"2"}},["url"===e.helpKey?r("div",[r("p",[e._v(" Address of the repository with your Ansible playbooks. It can be: ")]),r("ul",[r("li",[e._v("Git URL "),r("code",[e._v("git://")])]),r("li",[e._v("SSH URL "),r("code",[e._v("ssh://")])]),r("li",[e._v("HTTPS URL "),r("code",[e._v("https://")])]),r("li",[e._v("file URL "),r("code",[e._v("file://")])])])]):"key"===e.helpKey?r("div",[r("p",[e._v("Credentials to access to the Git repository. It should be:")]),r("ul",[r("li",[r("code",[e._v("SSH")]),e._v(" if you use Git or SSH URL.")]),r("li",[r("code",[e._v("None")]),e._v(" if you use HTTPS or file URL.")])])]):e._e()])],1)],1):e._e()},Tn=[],Sn={mixins:[he],data:function(){return{helpDialog:null,helpKey:null,keys:null,inventoryTypes:[{id:"static",name:"Static"},{id:"file",name:"File"}]}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({keys:"get",url:"/api/project/".concat(e.projectId,"/keys"),responseType:"json"});case 2:e.keys=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},methods:{showHelpDialog:function(e){this.helpKey=e,this.helpDialog=!0},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/repositories")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/repositories/").concat(this.itemId)}}},Vn=Sn,En=Object(g["a"])(Vn,In,Tn,!1,null,null,null),Dn=En.exports;_()(En,{VAlert:se["a"],VDialog:y["a"],VForm:we["a"],VSelect:zt["a"],VTextField:je["a"]});var Rn={mixins:[at],components:{RepositoryForm:Dn},data:function(){return{keys:null}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:"/api/project/".concat(e.projectId,"/keys"),responseType:"json"});case 2:e.keys=t.sent.data;case 3:case"end":return t.stop()}}),t)})))()},methods:{getHeaders:function(){return[{text:"Name",value:"name",width:"25%"},{text:"Git URL",value:"git_url",width:"50%"},{text:"SSH Key",value:"ssh_key_id",width:"25%"},{text:"Actions",value:"actions",sortable:!1}]},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/repositories")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/repositories/").concat(this.itemId)},getEventName:function(){return"i-repositories"}}},On=Rn,Cn=Object(g["a"])(On,xn,yn,!1,null,null,null),$n=Cn.exports;_()(Cn,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var Pn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items?r("div",[r("EditDialog",{attrs:{"save-button-text":"new"===this.itemId?"Link":"Save",title:("new"===this.itemId?"New":"Edit")+" Team Member"},on:{save:function(t){return e.loadItems()}},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("TeamMemberForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,954445673),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("YesNoDialog",{attrs:{title:"Delete team member",text:"Are you really want to delete the team member?"},on:{yes:function(t){return e.deleteItem(e.itemId)}},model:{value:e.deleteItemDialog,callback:function(t){e.deleteItemDialog=t},expression:"deleteItemDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("Team")]),r("v-spacer"),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("New Team Member")])],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","items-per-page":Number.MAX_VALUE},scopedSlots:e._u([{key:"item.admin",fn:function(t){var n=t.item;return[r("v-switch",{attrs:{inset:"",disabled:!e.isUserAdmin()},on:{change:function(t){n.admin?e.grantAdmin(n.id):e.refuseAdmin(n.id)}},model:{value:n.admin,callback:function(t){e.$set(n,"admin",t)},expression:"item.admin"}})]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("v-btn",{attrs:{icon:"",disabled:!e.isUserAdmin()},on:{click:function(t){return e.askDeleteItem(n.id)}}},[r("v-icon",[e._v("mdi-delete")])],1)]}}],null,!1,433215650)})],1):e._e()},Nn=[],Ln=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.teamMembers&&null!=e.users?r("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.formValid,callback:function(t){e.formValid=t},expression:"formValid"}},[r("v-alert",{staticClass:"pb-2",attrs:{value:e.formError,color:"error"}},[e._v(e._s(e.formError))]),r("v-select",{attrs:{label:"User",items:e.users,"item-value":"id","item-text":"name",rules:[function(e){return!!e||"User is required"}],required:"",disabled:e.formSaving},model:{value:e.item.user_id,callback:function(t){e.$set(e.item,"user_id",t)},expression:"item.user_id"}}),r("v-checkbox",{attrs:{label:"Administrator"},model:{value:e.item.admin,callback:function(t){e.$set(e.item,"admin",t)},expression:"item.admin"}})],1):e._e()},An=[],Un={mixins:[he],data:function(){return{users:null,userId:null,teamMembers:null}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o()({method:"get",url:e.getItemsUrl(),responseType:"json"});case 2:return e.teamMembers=t.sent.data,t.next=5,o()({method:"get",url:"/api/users",responseType:"json"});case 5:e.users=t.sent.data.filter((function(t){return!e.teamMembers.some((function(e){return t.id===e.id}))}));case 6:case"end":return t.stop()}}),t)})))()},methods:{getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/users")},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/users/").concat(this.itemId)}}},Fn=Un,qn=Object(g["a"])(Fn,Ln,An,!1,null,null,null),Bn=qn.exports;_()(qn,{VAlert:se["a"],VCheckbox:_e["a"],VForm:we["a"],VSelect:zt["a"]});var Mn={components:{TeamMemberForm:Bn},mixins:[at],methods:{grantAdmin:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o()({method:"post",url:"/api/project/".concat(t.projectId,"/users/").concat(e,"/admin"),responseType:"json"});case 2:return r.next=4,t.loadItems();case 4:case"end":return r.stop()}}),r)})))()},refuseAdmin:function(e){var t=this;return Object(d["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o()({method:"delete",url:"/api/project/".concat(t.projectId,"/users/").concat(e,"/admin"),responseType:"json"});case 2:return r.next=4,t.loadItems();case 4:case"end":return r.stop()}}),r)})))()},getHeaders:function(){return[{text:"Name",value:"name",width:"50%"},{text:"Username",value:"username"},{text:"Email",value:"email",width:"50%"},{text:"Admin",value:"admin"},{text:"Actions",value:"actions",sortable:!1}]},getSingleItemUrl:function(){return"/api/project/".concat(this.projectId,"/users/").concat(this.itemId)},getItemsUrl:function(){return"/api/project/".concat(this.projectId,"/users?sort=name&order=asc")},getEventName:function(){return"i-repositories"},isUserAdmin:function(){var e=this;return(this.items.find((function(t){return t.id===e.userId}))||{}).admin}}},zn=Mn,Hn=r("b73d"),Yn=Object(g["a"])(zn,Pn,Nn,!1,null,null,null),Kn=Yn.exports;_()(Yn,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VSwitch:Hn["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var Wn=function(){var e=this,t=e.$createElement,r=e._self._c||t;return null!=e.items?r("div",[r("EditDialog",{attrs:{"save-button-text":"Save",title:"Edit User"},on:{save:function(t){return e.loadItems()}},scopedSlots:e._u([{key:"form",fn:function(t){var n=t.onSave,a=t.onError,i=t.needSave,s=t.needReset;return[r("UserForm",{attrs:{"project-id":e.projectId,"item-id":e.itemId,"need-save":i,"need-reset":s},on:{save:n,error:a}})]}}],null,!1,2674817173),model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}}),r("YesNoDialog",{attrs:{title:"Delete user",text:"Are you really want to delete this user?"},on:{yes:function(t){return e.deleteItem(e.itemId)}},model:{value:e.deleteItemDialog,callback:function(t){e.deleteItemDialog=t},expression:"deleteItemDialog"}}),r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-btn",{staticClass:"mr-4",attrs:{icon:""},on:{click:function(t){return e.returnToProjects()}}},[r("v-icon",[e._v("mdi-arrow-left")])],1),r("v-toolbar-title",[e._v("Users")]),r("v-spacer"),r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.editItem("new")}}},[e._v("New User")])],1),r("v-data-table",{staticClass:"mt-4",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","footer-props":{itemsPerPageOptions:[20]}},scopedSlots:e._u([{key:"item.external",fn:function(t){var n=t.item;return[n.external?r("v-icon",[e._v("mdi-checkbox-marked")]):r("v-icon",[e._v("mdi-checkbox-blank-outline")])]}},{key:"item.alert",fn:function(t){var n=t.item;return[n.alert?r("v-icon",[e._v("mdi-checkbox-marked")]):r("v-icon",[e._v("mdi-checkbox-blank-outline")])]}},{key:"item.admin",fn:function(t){var n=t.item;return[n.admin?r("v-icon",[e._v("mdi-checkbox-marked")]):r("v-icon",[e._v("mdi-checkbox-blank-outline")])]}},{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticStyle:{"white-space":"nowrap"}},[r("v-btn",{staticClass:"mr-1",attrs:{icon:"",disabled:n.id===e.userId},on:{click:function(t){return e.askDeleteItem(n.id)}}},[r("v-icon",[e._v("mdi-delete")])],1),r("v-btn",{staticClass:"mr-1",attrs:{icon:""},on:{click:function(t){return e.editItem(n.id)}}},[r("v-icon",[e._v("mdi-pencil")])],1)],1)]}}],null,!1,489976516)})],1):e._e()},Gn=[],Jn={mixins:[at],components:{YesNoDialog:nt,UserForm:De,EditDialog:S},methods:{getHeaders:function(){return[{text:"Name",value:"name",width:"50%"},{text:"Username",value:"username"},{text:"Email",value:"email"},{text:"Alert",value:"alert"},{text:"Admin",value:"admin"},{text:"External",value:"external",width:"50%"},{text:"Actions",value:"actions",sortable:!1}]},returnToProjects:function(){return Object(d["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:f.$emit("i-open-last-project");case 1:case"end":return e.stop()}}),e)})))()},getItemsUrl:function(){return"/api/users"},getSingleItemUrl:function(){return"/api/users/".concat(this.itemId)},getEventName:function(){return"i-user"}}},Xn=Jn,Qn=Object(g["a"])(Xn,Wn,Gn,!1,null,null,null),Zn=Qn.exports;_()(Qn,{VBtn:w["a"],VDataTable:gt["a"],VIcon:Q["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]});var ea=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"auth"},[r("v-container",{staticClass:"pa-0",attrs:{fluid:"","fill-height":"","align-center":"","justify-center":""}},[r("v-form",{ref:"signInForm",staticStyle:{width:"300px",height:"300px"},attrs:{"lazy-validation":""},model:{value:e.signInFormValid,callback:function(t){e.signInFormValid=t},expression:"signInFormValid"}},[r("h3",{staticClass:"text-center mb-8"},[e._v("SEMAPHORE")]),r("v-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{value:null!=e.signInError,color:"error"}},[e._v(e._s(e.signInError))]),r("v-text-field",{attrs:{label:"Username",rules:e.usernameRules,autofocus:"",required:"",disabled:e.signInProcess},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),r("v-text-field",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"Password",rules:[function(e){return!!e||"Password is required"}],type:"password",required:"",disabled:e.signInProcess},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.signIn(t)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),r("v-btn",{attrs:{color:"primary",disabled:e.signInProcess,block:""},on:{click:e.signIn}},[e._v(" Sign In ")])],1)],1)],1)},ta=[],ra={data:function(){return{signInFormValid:!1,signInError:null,signInProcess:!1,password:"",username:"",email:"",emailRules:[function(e){return!!e||"Email is required"}],passwordRules:[function(e){return!!e||"Password is required"},function(e){return e.length>=6||"Password too short. Min 6 characters"}],usernameRules:[function(e){return!!e||"Username is required"}]}},created:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.isAuthenticated()&&(document.location=document.baseURI);case 1:case"end":return t.stop()}}),t)})))()},methods:{isAuthenticated:function(){return document.cookie.includes("semaphore=")},signIn:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.signInError=null,e.$refs.signInForm.validate()){t.next=3;break}return t.abrupt("return");case 3:return e.signInProcess=!0,t.prev=4,t.next=7,o()({method:"post",url:"/api/auth/login",responseType:"json",data:{auth:e.username,password:e.password}});case 7:document.location=document.baseURI,t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](4),console.log(t.t0),401===t.t0.response.status?e.signInError="Incorrect login or password":e.signInError=m(t.t0);case 14:return t.prev=14,e.signInProcess=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[4,10,14,17]])})))()}}},na=ra,aa=(r("c9b5"),Object(g["a"])(na,ea,ta,!1,null,null,null)),ia=aa.exports;_()(aa,{VAlert:se["a"],VBtn:w["a"],VContainer:ce["a"],VForm:we["a"],VTextField:je["a"]});var sa=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-toolbar",{attrs:{flat:"",color:"white"}},[r("v-app-bar-nav-icon",{on:{click:function(t){return e.showDrawer()}}}),r("v-toolbar-title",[e._v("New Project")]),r("v-spacer")],1),r("div",{staticClass:"project-settings-form"},[r("div",{staticStyle:{height:"220px"}},[r("ProjectForm",{ref:"editForm",attrs:{"item-id":"new"}})],1),r("div",{staticClass:"text-right"},[r("v-btn",{attrs:{color:"primary"},on:{click:function(t){return e.createProject()}}},[e._v("创建")])],1)])],1)},oa=[],ca={components:{ProjectForm:ye},data:function(){return{}},methods:{showDrawer:function(){f.$emit("i-show-drawer")},createProject:function(){var e=this;return Object(d["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.editForm.save();case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return");case 5:f.$emit("i-project",{action:"new",item:r});case 6:case"end":return t.stop()}}),t)})))()}}},la=ca,ua=Object(g["a"])(la,sa,oa,!1,null,null,null),da=ua.exports;_()(ua,{VAppBarNavIcon:ht["a"],VBtn:w["a"],VSpacer:I["a"],VToolbar:wt["a"],VToolbarTitle:jt["a"]}),n["a"].use(Ge["a"]);var ma=[{path:"/project/new",component:da},{path:"/project/:projectId",redirect:"/project/:projectId/history"},{path:"/project/:projectId/history",component:yt},{path:"/project/:projectId/activity",component:Dt},{path:"/project/:projectId/settings",component:Nt},{path:"/project/:projectId/templates",component:Cr},{path:"/project/:projectId/views/:viewId/templates",component:Cr},{path:"/project/:projectId/templates/:templateId",component:Ur},{path:"/project/:projectId/views/:viewId/templates/:templateId",component:Ur},{path:"/project/:projectId/environment",component:Xr},{path:"/project/:projectId/inventory",component:un},{path:"/project/:projectId/repositories",component:$n},{path:"/project/:projectId/keys",component:jn},{path:"/project/:projectId/team",component:Kn},{path:"/auth/login",component:ia},{path:"/users",component:Zn}],pa=new Ge["a"]({mode:"history",routes:ma}),va=pa,fa=r("f309");n["a"].use(fa["a"]);var ba=new fa["a"]({});r("c1c3");o.a.defaults.baseURL=document.baseURI,n["a"].config.productionTip=!1,n["a"].filter("formatDate",(function(e){return e?i()(String(e)).fromNow():"—"})),n["a"].filter("formatTime",(function(e){return e?i()(String(e)).format("LTS"):"—"})),n["a"].filter("formatMilliseconds",(function(e){if(null==e||""===e)return"—";var t;if("string"===typeof e)t=parseInt(e,10);else if("number"===typeof e)t=e;else if(Array.isArray(e)){if(2!==e.length)throw new Error("formatMilliseconds: invalid value format");if(null==e[0]||""===e[0])return"—";var r,n="string"===typeof e[0]?new Date(e[0]):e[0];r=null==e[1]||""===e[1]?Date.now():"string"===typeof e[1]?new Date(e[1]):e[1],t=r-n}return i.a.duration(t,"milliseconds").humanize()})),new n["a"]({router:va,vuetify:ba,render:function(e){return e(We)}}).$mount("#app")},"5ad4":function(e,t,r){"use strict";var n=r("360e"),a=r.n(n);a.a},"5c0b":function(e,t,r){"use strict";var n=r("9c0c"),a=r.n(n);a.a},"6d42":function(e,t,r){},"701c":function(e,t,r){},9279:function(e,t,r){},"9c0c":function(e,t,r){},a427:function(e,t,r){"use strict";var n=r("701c"),a=r.n(n);a.a},b187:function(e,t,r){},c1c3:function(e,t,r){},c9b5:function(e,t,r){"use strict";var n=r("9279"),a=r.n(n);a.a},cc42:function(e,t,r){"use strict";var n=r("6d42"),a=r.n(n);a.a},dc87:function(e,t,r){"use strict";var n=r("4b9e"),a=r.n(n);a.a},e1c6:function(e,t,r){}});
//# sourceMappingURL=app.9cfc3222.js.map