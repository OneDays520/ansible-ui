{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/App.vue","mtime":1638868521196},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IGdldEVycm9yTWVzc2FnZSB9IGZyb20gJ0AvbGliL2Vycm9yJzsKaW1wb3J0IEVkaXREaWFsb2cgZnJvbSAnQC9jb21wb25lbnRzL0VkaXREaWFsb2cudnVlJzsKaW1wb3J0IFRhc2tMb2dWaWV3IGZyb20gJ0AvY29tcG9uZW50cy9UYXNrTG9nVmlldy52dWUnOwppbXBvcnQgUHJvamVjdEZvcm0gZnJvbSAnQC9jb21wb25lbnRzL1Byb2plY3RGb3JtLnZ1ZSc7CmltcG9ydCBVc2VyRm9ybSBmcm9tICdAL2NvbXBvbmVudHMvVXNlckZvcm0udnVlJzsKaW1wb3J0IENoYW5nZVBhc3N3b3JkRm9ybSBmcm9tICdAL2NvbXBvbmVudHMvQ2hhbmdlUGFzc3dvcmRGb3JtLnZ1ZSc7CmltcG9ydCBFdmVudEJ1cyBmcm9tICdAL2V2ZW50LWJ1cyc7CmltcG9ydCBzb2NrZXQgZnJvbSAnQC9zb2NrZXQnOwoKY29uc3QgUFJPSkVDVF9DT0xPUlMgPSBbCiAgJ3JlZCcsCiAgJ2JsdWUnLAogICdvcmFuZ2UnLAogICdncmVlbicsCl07CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0FwcCcsCiAgY29tcG9uZW50czogewogICAgQ2hhbmdlUGFzc3dvcmRGb3JtLAogICAgVXNlckZvcm0sCiAgICBFZGl0RGlhbG9nLAogICAgVGFza0xvZ1ZpZXcsCiAgICBQcm9qZWN0Rm9ybSwKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkcmF3ZXI6IG51bGwsCiAgICAgIHVzZXI6IG51bGwsCiAgICAgIHN0YXRlOiAnbG9hZGluZycsCiAgICAgIHNuYWNrYmFyOiBmYWxzZSwKICAgICAgc25hY2tiYXJUZXh0OiAnJywKICAgICAgc25hY2tiYXJDb2xvcjogJycsCiAgICAgIHByb2plY3RzOiBudWxsLAogICAgICBuZXdQcm9qZWN0RGlhbG9nOiBudWxsLAogICAgICB1c2VyRGlhbG9nOiBudWxsLAogICAgICBwYXNzd29yZERpYWxvZzogbnVsbCwKCiAgICAgIHRhc2tMb2dEaWFsb2c6IG51bGwsCiAgICAgIHRhc2s6IG51bGwsCiAgICAgIHRlbXBsYXRlOiBudWxsLAogICAgfTsKICB9LAoKICB3YXRjaDogewogICAgYXN5bmMgcHJvamVjdHModmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoID09PSAwCiAgICAgICAgICAmJiB0aGlzLiRyb3V0ZS5wYXRoLnN0YXJ0c1dpdGgoJy9wcm9qZWN0LycpCiAgICAgICAgICAmJiB0aGlzLiRyb3V0ZS5wYXRoICE9PSAnL3Byb2plY3QvbmV3JykgewogICAgICAgIGF3YWl0IHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogJy9wcm9qZWN0L25ldycgfSk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgJHJvdXRlKHZhbCkgewogICAgICBpZiAodmFsLnF1ZXJ5LnQgPT0gbnVsbCkgewogICAgICAgIHRoaXMudGFza0xvZ0RpYWxvZyA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHRhc2tJZCA9IHBhcnNlSW50KHRoaXMuJHJvdXRlLnF1ZXJ5LnQgfHwgJycsIDEwKTsKICAgICAgICBpZiAodGFza0lkKSB7CiAgICAgICAgICBFdmVudEJ1cy4kZW1pdCgnaS1zaG93LXRhc2snLCB7IHRhc2tJZCB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgfSwKCiAgY29tcHV0ZWQ6IHsKICAgIHByb2plY3RJZCgpIHsKICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuJHJvdXRlLnBhcmFtcy5wcm9qZWN0SWQsIDEwKSB8fCBudWxsOwogICAgfSwKCiAgICBwcm9qZWN0KCkgewogICAgICByZXR1cm4gdGhpcy5wcm9qZWN0cy5maW5kKCh4KSA9PiB4LmlkID09PSB0aGlzLnByb2plY3RJZCk7CiAgICB9LAoKICAgIGlzQXV0aGVudGljYXRlZCgpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmNvb2tpZS5pbmNsdWRlcygnc2VtYXBob3JlPScpOwogICAgfSwKCiAgICB0ZW1wbGF0ZXNVcmwoKSB7CiAgICAgIGxldCB2aWV3SWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgcHJvamVjdCR7dGhpcy5wcm9qZWN0SWR9X19sYXN0VmlzaXRlZFZpZXdJZGApOwogICAgICBpZiAodmlld0lkKSB7CiAgICAgICAgdmlld0lkID0gcGFyc2VJbnQodmlld0lkLCAxMCk7CiAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4odmlld0lkKSkgewogICAgICAgICAgcmV0dXJuIGAvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS92aWV3cy8ke3ZpZXdJZH0vdGVtcGxhdGVzYDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGAvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS90ZW1wbGF0ZXNgOwogICAgfSwKICB9LAoKICBhc3luYyBjcmVhdGVkKCkgewogICAgaWYgKCF0aGlzLmlzQXV0aGVudGljYXRlZCkgewogICAgICBpZiAodGhpcy4kcm91dGUucGF0aCAhPT0gJy9hdXRoL2xvZ2luJykgewogICAgICAgIGF3YWl0IHRoaXMuJHJvdXRlci5wdXNoKHsgcGF0aDogJy9hdXRoL2xvZ2luJyB9KTsKICAgICAgfQogICAgICB0aGlzLnN0YXRlID0gJ3N1Y2Nlc3MnOwogICAgICByZXR1cm47CiAgICB9CgogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5sb2FkRGF0YSgpOwogICAgICB0aGlzLnN0YXRlID0gJ3N1Y2Nlc3MnOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIEV2ZW50QnVzLiRlbWl0KCdpLXNuYWNrYmFyJywgewogICAgICAgIGNvbG9yOiAnZXJyb3InLAogICAgICAgIHRleHQ6IGdldEVycm9yTWVzc2FnZShlcnIpLAogICAgICB9KTsKICAgICAgdGhpcy5zdGF0ZSA9ICdlcnJvcic7CiAgICAgIHNvY2tldC5zdG9wKCk7CiAgICB9CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIEV2ZW50QnVzLiRvbignaS1zbmFja2JhcicsIChlKSA9PiB7CiAgICAgIHRoaXMuc25hY2tiYXIgPSB0cnVlOwogICAgICB0aGlzLnNuYWNrYmFyQ29sb3IgPSBlLmNvbG9yOwogICAgICB0aGlzLnNuYWNrYmFyVGV4dCA9IGUudGV4dDsKICAgIH0pOwoKICAgIEV2ZW50QnVzLiRvbignaS1hY2NvdW50LWNoYW5nZScsIGFzeW5jICgpID0+IHsKICAgICAgYXdhaXQgdGhpcy5sb2FkVXNlckluZm8oKTsKICAgIH0pOwoKICAgIEV2ZW50QnVzLiRvbignaS1zaG93LWRyYXdlcicsIGFzeW5jICgpID0+IHsKICAgICAgdGhpcy5kcmF3ZXIgPSB0cnVlOwogICAgfSk7CgogICAgRXZlbnRCdXMuJG9uKCdpLXNob3ctdGFzaycsIGFzeW5jIChlKSA9PiB7CiAgICAgIGlmIChwYXJzZUludCh0aGlzLiRyb3V0ZS5xdWVyeS50IHx8ICcnLCAxMCkgIT09IGUudGFza0lkKSB7CiAgICAgICAgY29uc3QgcXVlcnkgPSB7IC4uLnRoaXMuJHJvdXRlLnF1ZXJ5LCB0OiBlLnRhc2tJZCB9OwogICAgICAgIGF3YWl0IHRoaXMuJHJvdXRlci5yZXBsYWNlKHsgcXVlcnkgfSk7CiAgICAgIH0KCiAgICAgIHRoaXMudGFzayA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdGFza3MvJHtlLnRhc2tJZH1gLAogICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICB9KSkuZGF0YTsKCiAgICAgIHRoaXMudGVtcGxhdGUgPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3RlbXBsYXRlcy8ke3RoaXMudGFzay50ZW1wbGF0ZV9pZH1gLAogICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICB9KSkuZGF0YTsKCiAgICAgIHRoaXMudGFza0xvZ0RpYWxvZyA9IHRydWU7CiAgICB9KTsKCiAgICBFdmVudEJ1cy4kb24oJ2ktb3Blbi1sYXN0LXByb2plY3QnLCBhc3luYyAoKSA9PiB7CiAgICAgIGF3YWl0IHRoaXMudHJ5U2VsZWN0TW9zdFN1aXRhYmxlUHJvamVjdCgpOwogICAgfSk7CgogICAgRXZlbnRCdXMuJG9uKCdpLXVzZXInLCBhc3luYyAoZSkgPT4gewogICAgICBsZXQgdGV4dDsKCiAgICAgIHN3aXRjaCAoZS5hY3Rpb24pIHsKICAgICAgICBjYXNlICduZXcnOgogICAgICAgICAgdGV4dCA9IGBVc2VyICR7ZS5pdGVtLm5hbWV9IGNyZWF0ZWRgOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnZWRpdCc6CiAgICAgICAgICB0ZXh0ID0gYFVzZXIgJHtlLml0ZW0ubmFtZX0gc2F2ZWRgOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnZGVsZXRlJzoKICAgICAgICAgIHRleHQgPSBgVXNlciAke2UuaXRlbS5uYW1lfSBkZWxldGVkYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gcHJvamVjdCBhY3Rpb24nKTsKICAgICAgfQoKICAgICAgRXZlbnRCdXMuJGVtaXQoJ2ktc25hY2tiYXInLCB7CiAgICAgICAgY29sb3I6ICdzdWNjZXNzJywKICAgICAgICB0ZXh0LAogICAgICB9KTsKCiAgICAgIGlmICh0aGlzLnVzZXIgJiYgZS5pdGVtLmlkID09PSB0aGlzLnVzZXIuaWQpIHsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRVc2VySW5mbygpOwogICAgICB9CiAgICB9KTsKCiAgICBFdmVudEJ1cy4kb24oJ2ktcHJvamVjdCcsIGFzeW5jIChlKSA9PiB7CiAgICAgIGxldCB0ZXh0OwoKICAgICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZCgocCkgPT4gcC5pZCA9PT0gZS5pdGVtLmlkKSB8fCBlLml0ZW07CiAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdC5uYW1lIHx8IGAjJHtwcm9qZWN0LmlkfWA7CgogICAgICBzd2l0Y2ggKGUuYWN0aW9uKSB7CiAgICAgICAgY2FzZSAnbmV3JzoKICAgICAgICAgIHRleHQgPSBgUHJvamVjdCAke3Byb2plY3ROYW1lfSBjcmVhdGVkYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2VkaXQnOgogICAgICAgICAgdGV4dCA9IGBQcm9qZWN0ICR7cHJvamVjdE5hbWV9IHNhdmVkYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2RlbGV0ZSc6CiAgICAgICAgICB0ZXh0ID0gYFByb2plY3QgJHtwcm9qZWN0TmFtZX0gZGVsZXRlZGA7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIHByb2plY3QgYWN0aW9uJyk7CiAgICAgIH0KCiAgICAgIEV2ZW50QnVzLiRlbWl0KCdpLXNuYWNrYmFyJywgewogICAgICAgIGNvbG9yOiAnc3VjY2VzcycsCiAgICAgICAgdGV4dCwKICAgICAgfSk7CgogICAgICBhd2FpdCB0aGlzLmxvYWRQcm9qZWN0cygpOwoKICAgICAgc3dpdGNoIChlLmFjdGlvbikgewogICAgICAgIGNhc2UgJ25ldyc6CiAgICAgICAgICBhd2FpdCB0aGlzLnNlbGVjdFByb2plY3QoZS5pdGVtLmlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2RlbGV0ZSc6CiAgICAgICAgICBpZiAodGhpcy5wcm9qZWN0SWQgPT09IGUuaXRlbS5pZCAmJiB0aGlzLnByb2plY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5zZWxlY3RQcm9qZWN0KHRoaXMucHJvamVjdHNbMF0uaWQpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9KTsKICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyBvblRhc2tMb2dEaWFsb2dDbG9zZWQoKSB7CiAgICAgIGNvbnN0IHF1ZXJ5ID0geyAuLi50aGlzLiRyb3V0ZS5xdWVyeSwgdDogdW5kZWZpbmVkIH07CiAgICAgIGF3YWl0IHRoaXMuJHJvdXRlci5yZXBsYWNlKHsgcXVlcnkgfSk7CiAgICB9LAoKICAgIGFzeW5jIGxvYWREYXRhKCkgewogICAgICBpZiAoIXNvY2tldC5pc1J1bm5pbmcoKSkgewogICAgICAgIHNvY2tldC5zdGFydCgpOwogICAgICB9CgogICAgICBhd2FpdCB0aGlzLmxvYWRVc2VySW5mbygpOwogICAgICBhd2FpdCB0aGlzLmxvYWRQcm9qZWN0cygpOwoKICAgICAgLy8gdHJ5IHRvIGZpbmQgcHJvamVjdCBhbmQgc3dpdGNoIHRvIGl0IGlmIFVSTCBub3QgcG9pbnRpbmcgdG8gYW55IHByb2plY3QKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhdGggPT09ICcvJwogICAgICAgICAgfHwgdGhpcy4kcm91dGUucGF0aCA9PT0gJy9wcm9qZWN0JwogICAgICAgICAgfHwgKHRoaXMuJHJvdXRlLnBhdGguc3RhcnRzV2l0aCgnL3Byb2plY3QvJykpKSB7CiAgICAgICAgYXdhaXQgdGhpcy50cnlTZWxlY3RNb3N0U3VpdGFibGVQcm9qZWN0KCk7CiAgICAgIH0KCiAgICAgIC8vIGRpc3BsYXkgdGFzayBkaWFsb2cgaWYgcXVlcnkgcGFyYW0gdCBzcGVjaWZpZWQKICAgICAgaWYgKHRoaXMuJHJvdXRlLnF1ZXJ5LnQpIHsKICAgICAgICBjb25zdCB0YXNrSWQgPSBwYXJzZUludCh0aGlzLiRyb3V0ZS5xdWVyeS50IHx8ICcnLCAxMCk7CiAgICAgICAgaWYgKHRhc2tJZCkgewogICAgICAgICAgRXZlbnRCdXMuJGVtaXQoJ2ktc2hvdy10YXNrJywgeyB0YXNrSWQgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHRyeVNlbGVjdE1vc3RTdWl0YWJsZVByb2plY3QoKSB7CiAgICAgIGlmICh0aGlzLnByb2plY3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGlmICh0aGlzLiRyb3V0ZS5wYXRoICE9PSAnL3Byb2plY3QvbmV3JykgewogICAgICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnB1c2goeyBwYXRoOiAnL3Byb2plY3QvbmV3JyB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgcHJvamVjdElkOwoKICAgICAgaWYgKHRoaXMucHJvamVjdElkKSB7CiAgICAgICAgcHJvamVjdElkID0gdGhpcy5wcm9qZWN0SWQ7CiAgICAgIH0KCiAgICAgIGlmICgocHJvamVjdElkID09IG51bGwgfHwgIXRoaXMucHJvamVjdHMuc29tZSgocCkgPT4gcC5pZCA9PT0gcHJvamVjdElkKSkKICAgICAgICAgICYmIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0SWQnKSkgewogICAgICAgIHByb2plY3RJZCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0SWQnKSwgMTApOwogICAgICB9CgogICAgICBpZiAocHJvamVjdElkID09IG51bGwgfHwgIXRoaXMucHJvamVjdHMuc29tZSgocCkgPT4gcC5pZCA9PT0gcHJvamVjdElkKSkgewogICAgICAgIHByb2plY3RJZCA9IHRoaXMucHJvamVjdHNbMF0uaWQ7CiAgICAgIH0KCiAgICAgIGlmIChwcm9qZWN0SWQgIT0gbnVsbCkgewogICAgICAgIGF3YWl0IHRoaXMuc2VsZWN0UHJvamVjdChwcm9qZWN0SWQpOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHNlbGVjdFByb2plY3QocHJvamVjdElkKSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0SWQnLCBwcm9qZWN0SWQpOwogICAgICBpZiAodGhpcy5wcm9qZWN0SWQgPT09IHByb2plY3RJZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6IGAvcHJvamVjdC8ke3Byb2plY3RJZH1gIH0pOwogICAgfSwKCiAgICBhc3luYyBsb2FkUHJvamVjdHMoKSB7CiAgICAgIHRoaXMucHJvamVjdHMgPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiAnL2FwaS9wcm9qZWN0cycsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgIH0pKS5kYXRhOwogICAgfSwKCiAgICBhc3luYyBsb2FkVXNlckluZm8oKSB7CiAgICAgIGlmICghdGhpcy5pc0F1dGhlbnRpY2F0ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy51c2VyID0gKGF3YWl0IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgIHVybDogJy9hcGkvdXNlcicsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgIH0pKS5kYXRhOwogICAgfSwKCiAgICBnZXRQcm9qZWN0Q29sb3IocHJvamVjdERhdGEpIHsKICAgICAgY29uc3QgcHJvamVjdEluZGV4ID0gdGhpcy5wcm9qZWN0cy5sZW5ndGgKICAgICAgICAgIC0gdGhpcy5wcm9qZWN0cy5maW5kSW5kZXgoKHApID0+IHAuaWQgPT09IHByb2plY3REYXRhLmlkKTsKICAgICAgcmV0dXJuIFBST0pFQ1RfQ09MT1JTW3Byb2plY3RJbmRleCAlIFBST0pFQ1RfQ09MT1JTLmxlbmd0aF07CiAgICB9LAoKICAgIGdldFByb2plY3RJbml0aWFscyhwcm9qZWN0RGF0YSkgewogICAgICBjb25zdCBwYXJ0cyA9IHByb2plY3REYXRhLm5hbWUuc3BsaXQoL1xzLyk7CiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gMikgewogICAgICAgIHJldHVybiBgJHtwYXJ0c1swXVswXX0ke3BhcnRzWzFdWzBdfWAudG9VcHBlckNhc2UoKTsKICAgICAgfQogICAgICByZXR1cm4gcGFydHNbMF0uc3Vic3RyKDAsIDIpLnRvVXBwZXJDYXNlKCk7CiAgICB9LAoKICAgIGFzeW5jIHNpZ25PdXQoKSB7CiAgICAgIHRoaXMuc25hY2tiYXIgPSBmYWxzZTsKICAgICAgdGhpcy5zbmFja2JhckNvbG9yID0gJyc7CiAgICAgIHRoaXMuc25hY2tiYXJUZXh0ID0gJyc7CgogICAgICBzb2NrZXQuc3RvcCgpOwoKICAgICAgKGF3YWl0IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICB1cmw6ICcvYXBpL2F1dGgvbG9nb3V0JywKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpOwoKICAgICAgaWYgKHRoaXMuJHJvdXRlLnBhdGggIT09ICcvYXV0aC9sb2dpbicpIHsKICAgICAgICBhd2FpdCB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6ICcvYXV0aC9sb2dpbicgfSk7CiAgICAgICAgdGhpcy5zdGF0ZSA9ICdzdWNjZXNzJzsKICAgICAgfQogICAgfSwKCiAgICByZWZyZXNoUGFnZSgpIHsKICAgICAgY29uc3QgeyBsb2NhdGlvbiB9ID0gZG9jdW1lbnQ7CiAgICAgIGRvY3VtZW50LmxvY2F0aW9uID0gbG9jYXRpb247CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["App.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"App.vue","sourceRoot":"src","sourcesContent":["<template>\n  <v-app v-if=\"state === 'success'\" class=\"app\">\n    <EditDialog\n        v-model=\"passwordDialog\"\n        save-button-text=\"Save\"\n        title=\"Change password\"\n        v-if=\"user\"\n        event-name=\"i-user\"\n    >\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <ChangePasswordForm\n            :project-id=\"projectId\"\n            :item-id=\"user.id\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <EditDialog\n        v-model=\"userDialog\"\n        save-button-text=\"Save\"\n        title=\"Edit User\"\n        v-if=\"user\"\n        event-name=\"i-user\"\n    >\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <UserForm\n            :project-id=\"projectId\"\n            :item-id=\"user.id\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <EditDialog\n        v-model=\"taskLogDialog\"\n        save-button-text=\"Delete\"\n        :max-width=\"1000\"\n        :hide-buttons=\"true\"\n        @close=\"onTaskLogDialogClosed()\"\n    >\n      <template v-slot:title={}>\n        <div class=\"text-truncate\" style=\"max-width: calc(100% - 36px);\">\n          <router-link\n              class=\"breadcrumbs__item breadcrumbs__item--link\"\n              :to=\"`/project/${projectId}/templates/${template ? template.id : null}`\"\n              @click=\"taskLogDialog = false\"\n          >{{ template ? template.alias : null }}\n          </router-link>\n          <v-icon>mdi-chevron-right</v-icon>\n          <span class=\"breadcrumbs__item\">Task #{{ task ? task.id : null }}</span>\n        </div>\n\n        <v-spacer></v-spacer>\n        <v-btn\n            icon\n            @click=\"taskLogDialog = false; onTaskLogDialogClosed()\"\n        >\n          <v-icon>mdi-close</v-icon>\n        </v-btn>\n      </template>\n      <template v-slot:form=\"{}\">\n        <TaskLogView :project-id=\"projectId\" :item-id=\"task ? task.id : null\"/>\n      </template>\n    </EditDialog>\n\n    <EditDialog\n        v-model=\"newProjectDialog\"\n        save-button-text=\"创建\"\n        title=\"新项目\"\n        event-name=\"i-project\"\n    >\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <ProjectForm\n            item-id=\"new\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <v-snackbar\n        v-model=\"snackbar\"\n        :color=\"snackbarColor\"\n        :timeout=\"3000\"\n        top\n    >\n      {{ snackbarText }}\n      <v-btn\n          text\n          @click=\"snackbar = false\"\n      >\n        Close\n      </v-btn>\n    </v-snackbar>\n\n    <v-navigation-drawer\n        app\n        dark\n        color=\"#005057\"\n        fixed\n        width=\"260\"\n        v-model=\"drawer\"\n        mobile-breakpoint=\"960\"\n        v-if=\"$route.path.startsWith('/project/')\"\n    >\n      <v-menu bottom max-width=\"235\" max-height=\"100%\" v-if=\"project\">\n        <template v-slot:activator=\"{ on, attrs }\">\n          <v-list class=\"pa-0 overflow-y-auto\">\n            <v-list-item\n                key=\"project\"\n                class=\"app__project-selector\"\n                v-bind=\"attrs\"\n                v-on=\"on\"\n            >\n              <v-list-item-icon>\n                <v-avatar\n                    :color=\"getProjectColor(project)\"\n                    size=\"24\"\n                    style=\"font-size: 13px; font-weight: bold;\"\n                >\n                  <span class=\"white--text\">{{ getProjectInitials(project) }}</span>\n                </v-avatar>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                <v-list-item-title class=\"app__project-selector-title\">\n                  {{ project.name }}\n                </v-list-item-title>\n              </v-list-item-content>\n\n              <v-list-item-icon>\n                <v-icon>mdi-chevron-down</v-icon>\n              </v-list-item-icon>\n            </v-list-item>\n          </v-list>\n        </template>\n        <v-list>\n          <v-list-item\n              v-for=\"(item, i) in projects\"\n              :key=\"i\"\n              :to=\"`/project/${item.id}`\"\n              @click=\"selectProject(item.id)\"\n          >\n            <v-list-item-icon>\n              <v-avatar\n                  :color=\"getProjectColor(item)\"\n                  size=\"24\"\n                  style=\"font-size: 13px; font-weight: bold;\"\n              >\n                <span class=\"white--text\">{{ getProjectInitials(item) }}</span>\n              </v-avatar>\n            </v-list-item-icon>\n            <v-list-item-content>{{ item.name }}</v-list-item-content>\n          </v-list-item>\n\n          <v-list-item @click=\"newProjectDialog = true\">\n            <v-list-item-icon>\n              <v-icon>mdi-plus</v-icon>\n            </v-list-item-icon>\n\n            <v-list-item-content>\n              New project...\n            </v-list-item-content>\n          </v-list-item>\n        </v-list>\n      </v-menu>\n\n      <v-list class=\"pt-0\" v-if=\"!project\">\n        <v-list-item key=\"new_project\" :to=\"`/project/new`\">\n          <v-list-item-icon>\n            <v-icon>mdi-plus</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>New Project</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n      </v-list>\n\n      <v-list class=\"pt-0\" v-if=\"project\">\n        <v-list-item key=\"dashboard\" :to=\"`/project/${projectId}/history`\">\n          <v-list-item-icon>\n            <v-icon>mdi-view-dashboard</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>仪表盘</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n\n        <v-list-item key=\"templates\" :to=\"templatesUrl\">\n          <v-list-item-icon>\n            <v-icon>mdi-check-all</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>任务模板</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n\n        <v-list-item key=\"inventory\" :to=\"`/project/${projectId}/inventory`\">\n          <v-list-item-icon>\n            <v-icon>mdi-monitor-multiple</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>主机清单</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n\n        <v-list-item key=\"environment\" :to=\"`/project/${projectId}/environment`\">\n          <v-list-item-icon>\n            <v-icon>mdi-code-braces</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>运行环境</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n\n        <v-list-item key=\"keys\" :to=\"`/project/${projectId}/keys`\">\n          <v-list-item-icon>\n            <v-icon>mdi-key-change</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>密钥库</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n\n        <v-list-item key=\"repositories\" :to=\"`/project/${projectId}/repositories`\">\n          <v-list-item-icon>\n            <v-icon>mdi-git</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>剧本库</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n\n        <v-list-item key=\"team\" :to=\"`/project/${projectId}/team`\">\n          <v-list-item-icon>\n            <v-icon>mdi-account-multiple</v-icon>\n          </v-list-item-icon>\n\n          <v-list-item-content>\n            <v-list-item-title>团队</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n      </v-list>\n\n      <template v-slot:append>\n        <v-menu top max-width=\"235\" nudge-top=\"12\">\n          <template v-slot:activator=\"{ on, attrs }\">\n            <v-list class=\"pa-0\">\n              <v-list-item\n                  key=\"project\"\n                  v-bind=\"attrs\"\n                  v-on=\"on\"\n              >\n                <v-list-item-icon>\n                  <v-icon>mdi-account</v-icon>\n                </v-list-item-icon>\n\n                <v-list-item-content>\n                  <v-list-item-title>{{ user.name }}</v-list-item-title>\n                </v-list-item-content>\n              </v-list-item>\n            </v-list>\n          </template>\n\n          <v-list>\n            <v-list-item key=\"users\" to=\"/users\">\n              <v-list-item-icon>\n                <v-icon>mdi-account-multiple</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                用户\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-list-item key=\"edit\" @click=\"userDialog = true\">\n              <v-list-item-icon>\n                <v-icon>mdi-pencil</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                编辑账户\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-list-item key=\"password\" @click=\"passwordDialog = true\">\n              <v-list-item-icon>\n                <v-icon>mdi-lock</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                修改密码\n              </v-list-item-content>\n            </v-list-item>\n\n            <v-list-item key=\"sign_out\" @click=\"signOut()\">\n              <v-list-item-icon>\n                <v-icon>mdi-exit-to-app</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                退出\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-menu>\n      </template>\n    </v-navigation-drawer>\n\n    <v-main>\n      <router-view :projectId=\"projectId\" :userId=\"user ? user.id : null\"></router-view>\n    </v-main>\n\n  </v-app>\n  <v-app v-else-if=\"state === 'loading'\">\n    <v-main>\n      <v-container\n          fluid\n          fill-height\n          align-center\n          justify-center\n          class=\"pa-0\"\n      >\n        <v-progress-circular\n            :size=\"70\"\n            color=\"primary\"\n            indeterminate\n        ></v-progress-circular>\n      </v-container>\n    </v-main>\n  </v-app>\n  <v-app v-else-if=\"state === 'error'\">\n    <v-main>\n      <v-container\n          fluid\n          flex-column\n          fill-height\n          align-center\n          justify-center\n          class=\"pa-0 text-center\"\n      >\n        <v-alert text color=\"error\" class=\"d-inline-block\">\n          <h3 class=\"headline\">\n            错误\n          </h3>\n          {{ snackbarText }}\n        </v-alert>\n        <div class=\"mb-6\">\n          <v-btn text color=\"blue darken-1\" @click=\"refreshPage()\">\n            <v-icon left>mdi-refresh</v-icon>\n            刷新页面\n          </v-btn>\n          <v-btn text color=\"blue darken-1\" @click=\"signOut()\">\n            <v-icon left>mdi-exit-to-app</v-icon>\n            重新登录\n          </v-btn>\n        </div>\n      </v-container>\n    </v-main>\n  </v-app>\n  <v-app v-else></v-app>\n</template>\n<style lang=\"scss\">\n.v-dialog > .v-card > .v-card__title {\n  flex-wrap: nowrap;\n  overflow: hidden;\n  & * {\n    white-space: nowrap;\n  }\n}\n\n.v-data-table tbody tr.v-data-table__expanded__content {\n  box-shadow: none !important;\n\n}\n\n.v-data-table a {\n  text-decoration-line: none;\n\n  &:hover {\n    text-decoration-line: underline;\n  }\n}\n\n.breadcrumbs__item--link {\n  text-decoration-line: none;\n\n  &:hover {\n    text-decoration-line: underline;\n  }\n}\n\n.breadcrumbs__separator {\n  padding: 0 10px;\n}\n\n.app__project-selector {\n  height: 64px;\n\n  .v-list-item__icon {\n    margin-top: 20px !important;\n  }\n}\n\n.app__project-selector-title {\n  font-size: 1.25rem !important;\n  font-weight: bold;\n}\n\n.v-application--is-ltr .v-list-item__action:first-child,\n.v-application--is-ltr .v-list-item__icon:first-child {\n  margin-right: 16px !important;\n}\n\n.v-toolbar__content {\n  height: 64px !important;\n}\n\n.v-data-table-header {\n}\n\n.theme--light.v-data-table > .v-data-table__wrapper > table > thead > tr:last-child > th {\n  text-transform: uppercase;\n  white-space: nowrap;\n}\n\n.v-data-table > .v-data-table__wrapper > table > tbody > tr {\n  background: transparent !important;\n\n  & > td {\n    white-space: nowrap;\n  }\n\n  & > td:first-child {\n    //font-weight: bold !important;\n  }\n}\n\n.v-data-table > .v-data-table__wrapper > table > tbody > tr > th,\n.v-data-table > .v-data-table__wrapper > table > thead > tr > th,\n.v-data-table > .v-data-table__wrapper > table > tfoot > tr > th,\n.v-data-table > .v-data-table__wrapper > table > tbody > tr > td {\n  font-size: 1rem !important;\n}\n\n.v-data-footer {\n  font-size: 1rem !important;\n}\n\n.v-toolbar__title {\n  font-weight: bold !important;\n}\n\n.v-app-bar__nav-icon {\n  margin-left: 0 !important;\n}\n\n.v-toolbar__title:not(:first-child) {\n  margin-left: 10px !important;\n}\n\n@media (min-width: 960px) {\n  .v-app-bar__nav-icon {\n    display: none !important;\n  }\n\n  .v-toolbar__title:not(:first-child) {\n    padding-left: 0 !important;\n    margin-left: 0 !important;\n  }\n}\n\n</style>\n\n<script>\nimport axios from 'axios';\nimport { getErrorMessage } from '@/lib/error';\nimport EditDialog from '@/components/EditDialog.vue';\nimport TaskLogView from '@/components/TaskLogView.vue';\nimport ProjectForm from '@/components/ProjectForm.vue';\nimport UserForm from '@/components/UserForm.vue';\nimport ChangePasswordForm from '@/components/ChangePasswordForm.vue';\nimport EventBus from '@/event-bus';\nimport socket from '@/socket';\n\nconst PROJECT_COLORS = [\n  'red',\n  'blue',\n  'orange',\n  'green',\n];\n\nexport default {\n  name: 'App',\n  components: {\n    ChangePasswordForm,\n    UserForm,\n    EditDialog,\n    TaskLogView,\n    ProjectForm,\n  },\n  data() {\n    return {\n      drawer: null,\n      user: null,\n      state: 'loading',\n      snackbar: false,\n      snackbarText: '',\n      snackbarColor: '',\n      projects: null,\n      newProjectDialog: null,\n      userDialog: null,\n      passwordDialog: null,\n\n      taskLogDialog: null,\n      task: null,\n      template: null,\n    };\n  },\n\n  watch: {\n    async projects(val) {\n      if (val.length === 0\n          && this.$route.path.startsWith('/project/')\n          && this.$route.path !== '/project/new') {\n        await this.$router.push({ path: '/project/new' });\n      }\n    },\n\n    async $route(val) {\n      if (val.query.t == null) {\n        this.taskLogDialog = false;\n      } else {\n        const taskId = parseInt(this.$route.query.t || '', 10);\n        if (taskId) {\n          EventBus.$emit('i-show-task', { taskId });\n        }\n      }\n    },\n  },\n\n  computed: {\n    projectId() {\n      return parseInt(this.$route.params.projectId, 10) || null;\n    },\n\n    project() {\n      return this.projects.find((x) => x.id === this.projectId);\n    },\n\n    isAuthenticated() {\n      return document.cookie.includes('semaphore=');\n    },\n\n    templatesUrl() {\n      let viewId = localStorage.getItem(`project${this.projectId}__lastVisitedViewId`);\n      if (viewId) {\n        viewId = parseInt(viewId, 10);\n        if (!Number.isNaN(viewId)) {\n          return `/project/${this.projectId}/views/${viewId}/templates`;\n        }\n      }\n      return `/project/${this.projectId}/templates`;\n    },\n  },\n\n  async created() {\n    if (!this.isAuthenticated) {\n      if (this.$route.path !== '/auth/login') {\n        await this.$router.push({ path: '/auth/login' });\n      }\n      this.state = 'success';\n      return;\n    }\n\n    try {\n      await this.loadData();\n      this.state = 'success';\n    } catch (err) {\n      EventBus.$emit('i-snackbar', {\n        color: 'error',\n        text: getErrorMessage(err),\n      });\n      this.state = 'error';\n      socket.stop();\n    }\n  },\n\n  mounted() {\n    EventBus.$on('i-snackbar', (e) => {\n      this.snackbar = true;\n      this.snackbarColor = e.color;\n      this.snackbarText = e.text;\n    });\n\n    EventBus.$on('i-account-change', async () => {\n      await this.loadUserInfo();\n    });\n\n    EventBus.$on('i-show-drawer', async () => {\n      this.drawer = true;\n    });\n\n    EventBus.$on('i-show-task', async (e) => {\n      if (parseInt(this.$route.query.t || '', 10) !== e.taskId) {\n        const query = { ...this.$route.query, t: e.taskId };\n        await this.$router.replace({ query });\n      }\n\n      this.task = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/tasks/${e.taskId}`,\n        responseType: 'json',\n      })).data;\n\n      this.template = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/templates/${this.task.template_id}`,\n        responseType: 'json',\n      })).data;\n\n      this.taskLogDialog = true;\n    });\n\n    EventBus.$on('i-open-last-project', async () => {\n      await this.trySelectMostSuitableProject();\n    });\n\n    EventBus.$on('i-user', async (e) => {\n      let text;\n\n      switch (e.action) {\n        case 'new':\n          text = `User ${e.item.name} created`;\n          break;\n        case 'edit':\n          text = `User ${e.item.name} saved`;\n          break;\n        case 'delete':\n          text = `User ${e.item.name} deleted`;\n          break;\n        default:\n          throw new Error('Unknown project action');\n      }\n\n      EventBus.$emit('i-snackbar', {\n        color: 'success',\n        text,\n      });\n\n      if (this.user && e.item.id === this.user.id) {\n        await this.loadUserInfo();\n      }\n    });\n\n    EventBus.$on('i-project', async (e) => {\n      let text;\n\n      const project = this.projects.find((p) => p.id === e.item.id) || e.item;\n      const projectName = project.name || `#${project.id}`;\n\n      switch (e.action) {\n        case 'new':\n          text = `Project ${projectName} created`;\n          break;\n        case 'edit':\n          text = `Project ${projectName} saved`;\n          break;\n        case 'delete':\n          text = `Project ${projectName} deleted`;\n          break;\n        default:\n          throw new Error('Unknown project action');\n      }\n\n      EventBus.$emit('i-snackbar', {\n        color: 'success',\n        text,\n      });\n\n      await this.loadProjects();\n\n      switch (e.action) {\n        case 'new':\n          await this.selectProject(e.item.id);\n          break;\n        case 'delete':\n          if (this.projectId === e.item.id && this.projects.length > 0) {\n            await this.selectProject(this.projects[0].id);\n          }\n          break;\n        default:\n          break;\n      }\n    });\n  },\n\n  methods: {\n    async onTaskLogDialogClosed() {\n      const query = { ...this.$route.query, t: undefined };\n      await this.$router.replace({ query });\n    },\n\n    async loadData() {\n      if (!socket.isRunning()) {\n        socket.start();\n      }\n\n      await this.loadUserInfo();\n      await this.loadProjects();\n\n      // try to find project and switch to it if URL not pointing to any project\n      if (this.$route.path === '/'\n          || this.$route.path === '/project'\n          || (this.$route.path.startsWith('/project/'))) {\n        await this.trySelectMostSuitableProject();\n      }\n\n      // display task dialog if query param t specified\n      if (this.$route.query.t) {\n        const taskId = parseInt(this.$route.query.t || '', 10);\n        if (taskId) {\n          EventBus.$emit('i-show-task', { taskId });\n        }\n      }\n    },\n\n    async trySelectMostSuitableProject() {\n      if (this.projects.length === 0) {\n        if (this.$route.path !== '/project/new') {\n          await this.$router.push({ path: '/project/new' });\n        }\n        return;\n      }\n\n      let projectId;\n\n      if (this.projectId) {\n        projectId = this.projectId;\n      }\n\n      if ((projectId == null || !this.projects.some((p) => p.id === projectId))\n          && localStorage.getItem('projectId')) {\n        projectId = parseInt(localStorage.getItem('projectId'), 10);\n      }\n\n      if (projectId == null || !this.projects.some((p) => p.id === projectId)) {\n        projectId = this.projects[0].id;\n      }\n\n      if (projectId != null) {\n        await this.selectProject(projectId);\n      }\n    },\n\n    async selectProject(projectId) {\n      localStorage.setItem('projectId', projectId);\n      if (this.projectId === projectId) {\n        return;\n      }\n      await this.$router.push({ path: `/project/${projectId}` });\n    },\n\n    async loadProjects() {\n      this.projects = (await axios({\n        method: 'get',\n        url: '/api/projects',\n        responseType: 'json',\n      })).data;\n    },\n\n    async loadUserInfo() {\n      if (!this.isAuthenticated) {\n        return;\n      }\n      this.user = (await axios({\n        method: 'get',\n        url: '/api/user',\n        responseType: 'json',\n      })).data;\n    },\n\n    getProjectColor(projectData) {\n      const projectIndex = this.projects.length\n          - this.projects.findIndex((p) => p.id === projectData.id);\n      return PROJECT_COLORS[projectIndex % PROJECT_COLORS.length];\n    },\n\n    getProjectInitials(projectData) {\n      const parts = projectData.name.split(/\\s/);\n      if (parts.length >= 2) {\n        return `${parts[0][0]}${parts[1][0]}`.toUpperCase();\n      }\n      return parts[0].substr(0, 2).toUpperCase();\n    },\n\n    async signOut() {\n      this.snackbar = false;\n      this.snackbarColor = '';\n      this.snackbarText = '';\n\n      socket.stop();\n\n      (await axios({\n        method: 'post',\n        url: '/api/auth/logout',\n        responseType: 'json',\n      }));\n\n      if (this.$route.path !== '/auth/login') {\n        await this.$router.push({ path: '/auth/login' });\n        this.state = 'success';\n      }\n    },\n\n    refreshPage() {\n      const { location } = document;\n      document.location = location;\n    },\n  },\n};\n</script>\n"]}]}