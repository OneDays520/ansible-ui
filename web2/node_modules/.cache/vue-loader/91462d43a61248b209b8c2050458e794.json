{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/views/project/Templates.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/views/project/Templates.vue","mtime":1638860152195},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBJdGVtTGlzdFBhZ2VCYXNlIGZyb20gJ0AvY29tcG9uZW50cy9JdGVtTGlzdFBhZ2VCYXNlJzsKaW1wb3J0IFRlbXBsYXRlRm9ybSBmcm9tICdAL2NvbXBvbmVudHMvVGVtcGxhdGVGb3JtLnZ1ZSc7CmltcG9ydCBUYXNrTGluayBmcm9tICdAL2NvbXBvbmVudHMvVGFza0xpbmsudnVlJzsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IFRhc2tGb3JtIGZyb20gJ0AvY29tcG9uZW50cy9UYXNrRm9ybS52dWUnOwppbXBvcnQgRWRpdFZpZXdzRm9ybSBmcm9tICdAL2NvbXBvbmVudHMvRWRpdFZpZXdzRm9ybS52dWUnOwppbXBvcnQgVGFibGVTZXR0aW5nc1NoZWV0IGZyb20gJ0AvY29tcG9uZW50cy9UYWJsZVNldHRpbmdzU2hlZXQudnVlJzsKaW1wb3J0IFRhc2tMaXN0IGZyb20gJ0AvY29tcG9uZW50cy9UYXNrTGlzdC52dWUnOwppbXBvcnQgRXZlbnRCdXMgZnJvbSAnQC9ldmVudC1idXMnOwppbXBvcnQgVGFza1N0YXR1cyBmcm9tICdAL2NvbXBvbmVudHMvVGFza1N0YXR1cy52dWUnOwppbXBvcnQgc29ja2V0IGZyb20gJ0Avc29ja2V0JzsKCmltcG9ydCB7IFRFTVBMQVRFX1RZUEVfQUNUSU9OX1RJVExFUywgVEVNUExBVEVfVFlQRV9JQ09OUyB9IGZyb20gJy4uLy4uL2xpYi9jb25zdGFudHMnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIFRlbXBsYXRlRm9ybSwgVGFza0Zvcm0sIFRhYmxlU2V0dGluZ3NTaGVldCwgVGFza1N0YXR1cywgVGFza0xpbmssIFRhc2tMaXN0LCBFZGl0Vmlld3NGb3JtLAogIH0sCiAgbWl4aW5zOiBbSXRlbUxpc3RQYWdlQmFzZV0sCiAgYXN5bmMgY3JlYXRlZCgpIHsKICAgIHNvY2tldC5hZGRMaXN0ZW5lcigoZGF0YSkgPT4gdGhpcy5vbldlYnNvY2tldERhdGFSZWNlaXZlZChkYXRhKSk7CgogICAgYXdhaXQgdGhpcy5sb2FkRGF0YSgpOwogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIFRFTVBMQVRFX1RZUEVfSUNPTlMsCiAgICAgIFRFTVBMQVRFX1RZUEVfQUNUSU9OX1RJVExFUywKICAgICAgaW52ZW50b3J5OiBudWxsLAogICAgICBlbnZpcm9ubWVudDogbnVsbCwKICAgICAgcmVwb3NpdG9yaWVzOiBudWxsLAogICAgICBuZXdUYXNrRGlhbG9nOiBudWxsLAogICAgICBzZXR0aW5nc1NoZWV0OiBudWxsLAogICAgICBmaWx0ZXJlZEhlYWRlcnM6IFtdLAogICAgICBvcGVuZWRJdGVtczogW10sCiAgICAgIHZpZXdzOiBudWxsLAogICAgICBlZGl0Vmlld3NEaWFsb2c6IG51bGwsCiAgICAgIHZpZXdJdGVtc0xvYWRpbmc6IG51bGwsCiAgICAgIHZpZXdUYWI6IG51bGwsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHZpZXdJZCgpIHsKICAgICAgaWYgKC9eLT9cZCskLy50ZXN0KHRoaXMuJHJvdXRlLnBhcmFtcy52aWV3SWQpKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHRoaXMuJHJvdXRlLnBhcmFtcy52aWV3SWQsIDEwKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy4kcm91dGUucGFyYW1zLnZpZXdJZDsKICAgIH0sCgogICAgdGVtcGxhdGVUeXBlKCkgewogICAgICBpZiAodGhpcy5pdGVtSWQgPT0gbnVsbCB8fCB0aGlzLml0ZW1JZCA9PT0gJ25ldycpIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuaXRlbXMuZmluZCgoeCkgPT4geC5pZCA9PT0gdGhpcy5pdGVtSWQpLnR5cGU7CiAgICB9LAoKICAgIHRlbXBsYXRlQWxpYXMoKSB7CiAgICAgIGlmICh0aGlzLml0ZW1JZCA9PSBudWxsIHx8IHRoaXMuaXRlbUlkID09PSAnbmV3JykgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5pdGVtcy5maW5kKCh4KSA9PiB4LmlkID09PSB0aGlzLml0ZW1JZCkuYWxpYXM7CiAgICB9LAoKICAgIGlzTG9hZGVkKCkgewogICAgICByZXR1cm4gdGhpcy5pdGVtcwogICAgICAgICAgJiYgdGhpcy5pbnZlbnRvcnkKICAgICAgICAgICYmIHRoaXMuZW52aXJvbm1lbnQKICAgICAgICAgICYmIHRoaXMucmVwb3NpdG9yaWVzCiAgICAgICAgICAmJiB0aGlzLnZpZXdzOwogICAgfSwKICB9LAogIHdhdGNoOiB7CiAgICBhc3luYyB2aWV3SWQoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy52aWV3SXRlbXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRJdGVtcygpOwogICAgICAgIGlmICh0aGlzLnZpZXdJZCkgewogICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oYHByb2plY3Qke3RoaXMucHJvamVjdElkfV9fbGFzdFZpc2l0ZWRWaWV3SWRgLCB0aGlzLnZpZXdJZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGBwcm9qZWN0JHt0aGlzLnByb2plY3RJZH1fX2xhc3RWaXNpdGVkVmlld0lkYCk7CiAgICAgICAgfQogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMudmlld0l0ZW1zTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgYmVmb3JlTG9hZEl0ZW1zKCkgewogICAgICBhd2FpdCB0aGlzLmxvYWRWaWV3cygpOwogICAgfSwKCiAgICBnZXRWaWV3VXJsKHZpZXdJZCkgewogICAgICBpZiAodmlld0lkID09IG51bGwpIHsKICAgICAgICByZXR1cm4gYC9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3RlbXBsYXRlc2A7CiAgICAgIH0KICAgICAgcmV0dXJuIGAvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS92aWV3cy8ke3ZpZXdJZH0vdGVtcGxhdGVzYDsKICAgIH0sCgogICAgYXN5bmMgbG9hZFZpZXdzKCkgewogICAgICB0aGlzLnZpZXdzID0gKGF3YWl0IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgIHVybDogYC9hcGkvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS92aWV3c2AsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgIH0pKS5kYXRhOwogICAgICB0aGlzLnZpZXdzLnNvcnQoKHYxLCB2MikgPT4gdjEucG9zaXRpb24gLSB2Mi5wb3NpdGlvbik7CgogICAgICBpZiAodGhpcy52aWV3SWQgIT0gbnVsbCAmJiAhdGhpcy52aWV3cy5zb21lKCh2KSA9PiB2LmlkID09PSB0aGlzLnZpZXdJZCkpIHsKICAgICAgICBhd2FpdCB0aGlzLiRyb3V0ZXIucHVzaCh7IHBhdGg6IGAvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS90ZW1wbGF0ZXNgIH0pOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIGNsb3NlRWRpdFZpZXdEaWFsb2coKSB7CiAgICAgIHRoaXMuZWRpdFZpZXdzRGlhbG9nID0gZmFsc2U7CiAgICAgIGF3YWl0IHRoaXMubG9hZFZpZXdzKCk7CiAgICB9LAoKICAgIGFzeW5jIG9uV2Vic29ja2V0RGF0YVJlY2VpdmVkKGRhdGEpIHsKICAgICAgaWYgKGRhdGEucHJvamVjdF9pZCAhPT0gdGhpcy5wcm9qZWN0SWQgfHwgZGF0YS50eXBlICE9PSAndXBkYXRlJykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgdGVtcGxhdGUgPSB0aGlzLml0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IGRhdGEudGVtcGxhdGVfaWQpOwoKICAgICAgaWYgKHRlbXBsYXRlID09IG51bGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChkYXRhLnRhc2tfaWQgIT09IHRlbXBsYXRlLmxhc3RfdGFza19pZCkgewogICAgICAgIE9iamVjdC5hc3NpZ24odGVtcGxhdGUubGFzdF90YXNrLCAoYXdhaXQgYXhpb3MoewogICAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICAgIHVybDogYC9hcGkvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS90YXNrcy8ke2RhdGEudGFza19pZH1gLAogICAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgICAgfSkpLmRhdGEpOwogICAgICAgIHRlbXBsYXRlLmxhc3RfdGFza19pZCA9IGRhdGEudGFza19pZDsKICAgICAgfQoKICAgICAgT2JqZWN0LmFzc2lnbih0ZW1wbGF0ZS5sYXN0X3Rhc2ssIHsKICAgICAgICAuLi5kYXRhLAogICAgICAgIHR5cGU6IHVuZGVmaW5lZCwKICAgICAgfSk7CiAgICB9LAoKICAgIG9uVGFza0NyZWF0ZWQoZSkgewogICAgICBFdmVudEJ1cy4kZW1pdCgnaS1zaG93LXRhc2snLCB7CiAgICAgICAgdGFza0lkOiBlLml0ZW0uaWQsCiAgICAgIH0pOwogICAgICB0aGlzLml0ZW1JZCA9IG51bGw7CiAgICB9LAoKICAgIHNob3dUYXNrTG9nKHRhc2tJZCkgewogICAgICBFdmVudEJ1cy4kZW1pdCgnaS1zaG93LXRhc2snLCB7CiAgICAgICAgdGFza0lkLAogICAgICB9KTsKICAgIH0sCgogICAgY3JlYXRlVGFzayhpdGVtSWQpIHsKICAgICAgdGhpcy5pdGVtSWQgPSBpdGVtSWQ7CiAgICAgIHRoaXMubmV3VGFza0RpYWxvZyA9IHRydWU7CiAgICB9LAoKICAgIGdldEhlYWRlcnMoKSB7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+aooeadv+WQjeensCcsCiAgICAgICAgICB2YWx1ZTogJ2FsaWFzJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICfniYjmnKwnLAogICAgICAgICAgdmFsdWU6ICd2ZXJzaW9uJywKICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICfnirbmgIEnLAogICAgICAgICAgdmFsdWU6ICdzdGF0dXMnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+acgOi/keS7u+WKoScsCiAgICAgICAgICB2YWx1ZTogJ2xhc3RfdGFzaycsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiAn5Ymn5pysJywKICAgICAgICAgIHZhbHVlOiAncGxheWJvb2snLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+S4u+acuua4heWNlScsCiAgICAgICAgICB2YWx1ZTogJ2ludmVudG9yeV9pZCcsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiAn6L+Q6KGM546v5aKDJywKICAgICAgICAgIHZhbHVlOiAnZW52aXJvbm1lbnRfaWQnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+WJp+acrOW6kycsCiAgICAgICAgICB2YWx1ZTogJ3JlcG9zaXRvcnlfaWQnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+WKqOS9nCcsCiAgICAgICAgICB2YWx1ZTogJ2FjdGlvbnMnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgICAgd2lkdGg6ICcwJScsCiAgICAgICAgfSwKICAgICAgXTsKICAgIH0sCgogICAgZ2V0SXRlbXNVcmwoKSB7CiAgICAgIHJldHVybiB0aGlzLnZpZXdJZCA9PSBudWxsCiAgICAgICAgPyBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3RlbXBsYXRlc2AKICAgICAgICA6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdmlld3MvJHt0aGlzLnZpZXdJZH0vdGVtcGxhdGVzYDsKICAgIH0sCgogICAgYXN5bmMgbG9hZERhdGEoKSB7CiAgICAgIHRoaXMuaW52ZW50b3J5ID0gKGF3YWl0IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgIHVybDogYC9hcGkvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS9pbnZlbnRvcnlgLAogICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICB9KSkuZGF0YTsKCiAgICAgIHRoaXMuZW52aXJvbm1lbnQgPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L2Vudmlyb25tZW50YCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CgogICAgICB0aGlzLnJlcG9zaXRvcmllcyA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vcmVwb3NpdG9yaWVzYCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CiAgICB9LAoKICAgIG9uVGFibGVTZXR0aW5nc0NoYW5nZSh7IGhlYWRlcnMgfSkgewogICAgICB0aGlzLmZpbHRlcmVkSGVhZGVycyA9IGhlYWRlcnM7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["Templates.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Templates.vue","sourceRoot":"src/views/project","sourcesContent":["<template xmlns:v-slot=\"http://www.w3.org/1999/XSL/Transform\">\n  <div v-if=\"!isLoaded\">\n    <v-progress-linear\n        indeterminate\n        color=\"primary darken-2\"\n    ></v-progress-linear>\n  </div>\n  <div v-else>\n    <v-dialog\n        v-model=\"editViewsDialog\"\n        :max-width=\"400\"\n        persistent\n        :transition=\"false\"\n    >\n      <v-card>\n        <v-card-title>\n          编辑视图\n          <v-spacer></v-spacer>\n          <v-btn icon @click=\"closeEditViewDialog()\">\n            <v-icon>mdi-close</v-icon>\n          </v-btn>\n        </v-card-title>\n        <v-card-text>\n          <EditViewsForm :project-id=\"projectId\"/>\n        </v-card-text>\n      </v-card>\n    </v-dialog>\n\n    <EditDialog\n        :max-width=\"700\"\n        v-model=\"editDialog\"\n        save-button-text=\"创建\"\n        title=\"新模板\"\n        @save=\"loadItems()\"\n    >\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <TemplateForm\n            :project-id=\"projectId\"\n            item-id=\"new\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <EditDialog\n        v-model=\"newTaskDialog\"\n        :save-button-text=\"TEMPLATE_TYPE_ACTION_TITLES[templateType]\"\n        title=\"新任务\"\n        @save=\"onTaskCreated\"\n        @close=\"itemId = null\"\n    >\n      <template v-slot:title={}>\n        <v-icon small class=\"mr-4\">{{ TEMPLATE_TYPE_ICONS[templateType] }}</v-icon>\n        <span class=\"breadcrumbs__item\">{{ templateAlias }}</span>\n        <v-icon>mdi-chevron-right</v-icon>\n        <span class=\"breadcrumbs__item\">新任务</span>\n      </template>\n\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <TaskForm\n            :project-id=\"projectId\"\n            item-id=\"new\"\n            :template-id=\"itemId\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <v-toolbar flat color=\"white\">\n      <v-app-bar-nav-icon @click=\"showDrawer()\"></v-app-bar-nav-icon>\n      <v-toolbar-title>任务模板</v-toolbar-title>\n      <v-spacer></v-spacer>\n      <v-btn\n          color=\"primary\"\n          @click=\"editItem('new')\"\n          class=\"mr-1\"\n      >新模板\n      </v-btn>\n\n      <v-btn icon @click=\"settingsSheet = true\">\n        <v-icon>mdi-cog</v-icon>\n      </v-btn>\n    </v-toolbar>\n\n    <v-tabs show-arrows class=\"pl-4\" v-model=\"viewTab\">\n      <v-tab :to=\"getViewUrl(null)\" :disabled=\"viewItemsLoading\">All</v-tab>\n\n      <v-tab\n          v-for=\"(view) in views\"\n          :key=\"view.id\"\n          :to=\"getViewUrl(view.id)\"\n          :disabled=\"viewItemsLoading\"\n      >{{ view.title }}\n      </v-tab>\n\n      <v-btn icon class=\"mt-2 ml-4\" @click=\"editViewsDialog = true\">\n        <v-icon>mdi-pencil</v-icon>\n      </v-btn>\n    </v-tabs>\n\n    <v-data-table\n        hide-default-footer\n        class=\"mt-4 templates-table\"\n        single-expand\n        show-expand\n        :headers=\"filteredHeaders\"\n        :items=\"items\"\n        :items-per-page=\"Number.MAX_VALUE\"\n        :expanded.sync=\"openedItems\"\n        :style=\"{\n          opacity: viewItemsLoading ? 0.3 : 1,\n        }\"\n    >\n      <template v-slot:item.alias=\"{ item }\">\n        <v-icon class=\"mr-3\" small>\n          {{ TEMPLATE_TYPE_ICONS[item.type] }}\n        </v-icon>\n        <router-link\n            :to=\"viewId\n              ? `/project/${projectId}/views/${viewId}/templates/${item.id}`\n              : `/project/${projectId}/templates/${item.id}`\"\n        >{{ item.alias }}</router-link>\n      </template>\n\n      <template v-slot:item.version=\"{ item }\">\n        <TaskLink\n            v-if=\"item.last_task && item.last_task.tpl_type !== ''\"\n            :disabled=\"true\"\n            :status=\"item.last_task.status\"\n\n            :task-id=\"item.last_task.tpl_type === 'build'\n              ? item.last_task.id\n              : item.last_task.build_task.id\"\n\n            :label=\"item.last_task.tpl_type === 'build'\n              ? item.last_task.version\n              : item.last_task.build_task.version\"\n\n            :tooltip=\"item.last_task.tpl_type === 'build'\n              ? item.last_task.message\n              : item.last_task.build_task.message\"\n        />\n        <div v-else>&mdash;</div>\n      </template>\n\n      <template v-slot:item.status=\"{ item }\">\n        <div class=\"mt-2 mb-2 d-flex\" v-if=\"item.last_task != null\">\n          <TaskStatus :status=\"item.last_task.status\"/>\n        </div>\n        <div v-else class=\"mt-3 mb-2 d-flex\" style=\"color: gray;\">Not launched</div>\n      </template>\n\n      <template v-slot:item.last_task=\"{ item }\">\n        <div class=\"mt-2 mb-2\" v-if=\"item.last_task != null\" style=\"line-height: 1\">\n          <TaskLink\n              :task-id=\"item.last_task.id\"\n              :label=\"'#' + item.last_task.id\"\n              :tooltip=\"item.last_task.message\"\n          />\n          <div style=\"color: gray; font-size: 14px;\">\n            by {{ item.last_task.user_name }} {{ item.last_task.created|formatDate }}\n          </div>\n        </div>\n      </template>\n\n      <template v-slot:item.inventory_id=\"{ item }\">\n        {{ inventory.find((x) => x.id === item.inventory_id).name }}\n      </template>\n\n      <template v-slot:item.environment_id=\"{ item }\">\n        {{ environment.find((x) => x.id === item.environment_id).name }}\n      </template>\n\n      <template v-slot:item.repository_id=\"{ item }\">\n        {{ repositories.find((x) => x.id === item.repository_id).name }}\n      </template>\n\n      <template v-slot:item.actions=\"{ item }\">\n        <v-btn text color=\"black\" class=\"pl-1 pr-2\" @click=\"createTask(item.id)\">\n          <v-icon class=\"pr-1\">mdi-replay</v-icon>\n          {{ TEMPLATE_TYPE_ACTION_TITLES[item.type] }}\n        </v-btn>\n      </template>\n\n      <template v-slot:expanded-item=\"{ headers, item }\">\n        <td\n            :colspan=\"headers.length\"\n            v-if=\"openedItems.some((template) => template.id === item.id)\"\n        >\n          <TaskList\n              style=\"border: 1px solid lightgray; border-radius: 6px; margin: 10px 0;\"\n              :template=\"item\"\n              :limit=\"5\"\n              :hide-footer=\"true\"\n          />\n        </td>\n      </template>\n    </v-data-table>\n\n    <TableSettingsSheet\n        v-model=\"settingsSheet\"\n        table-name=\"project__template\"\n        :headers=\"headers\"\n        @change=\"onTableSettingsChange\"\n    />\n  </div>\n</template>\n<style lang=\"scss\">\n@import '~vuetify/src/styles/settings/_variables';\n\n.templates-table .text-start:first-child {\n  padding-right: 0 !important;\n}\n\n@media #{map-get($display-breakpoints, 'sm-and-down')} {\n  .templates-table .v-data-table__mobile-row:first-child {\n    display: none !important;\n  }\n}\n</style>\n<script>\nimport ItemListPageBase from '@/components/ItemListPageBase';\nimport TemplateForm from '@/components/TemplateForm.vue';\nimport TaskLink from '@/components/TaskLink.vue';\nimport axios from 'axios';\nimport TaskForm from '@/components/TaskForm.vue';\nimport EditViewsForm from '@/components/EditViewsForm.vue';\nimport TableSettingsSheet from '@/components/TableSettingsSheet.vue';\nimport TaskList from '@/components/TaskList.vue';\nimport EventBus from '@/event-bus';\nimport TaskStatus from '@/components/TaskStatus.vue';\nimport socket from '@/socket';\n\nimport { TEMPLATE_TYPE_ACTION_TITLES, TEMPLATE_TYPE_ICONS } from '../../lib/constants';\n\nexport default {\n  components: {\n    TemplateForm, TaskForm, TableSettingsSheet, TaskStatus, TaskLink, TaskList, EditViewsForm,\n  },\n  mixins: [ItemListPageBase],\n  async created() {\n    socket.addListener((data) => this.onWebsocketDataReceived(data));\n\n    await this.loadData();\n  },\n  data() {\n    return {\n      TEMPLATE_TYPE_ICONS,\n      TEMPLATE_TYPE_ACTION_TITLES,\n      inventory: null,\n      environment: null,\n      repositories: null,\n      newTaskDialog: null,\n      settingsSheet: null,\n      filteredHeaders: [],\n      openedItems: [],\n      views: null,\n      editViewsDialog: null,\n      viewItemsLoading: null,\n      viewTab: null,\n    };\n  },\n  computed: {\n    viewId() {\n      if (/^-?\\d+$/.test(this.$route.params.viewId)) {\n        return parseInt(this.$route.params.viewId, 10);\n      }\n      return this.$route.params.viewId;\n    },\n\n    templateType() {\n      if (this.itemId == null || this.itemId === 'new') {\n        return '';\n      }\n      return this.items.find((x) => x.id === this.itemId).type;\n    },\n\n    templateAlias() {\n      if (this.itemId == null || this.itemId === 'new') {\n        return '';\n      }\n      return this.items.find((x) => x.id === this.itemId).alias;\n    },\n\n    isLoaded() {\n      return this.items\n          && this.inventory\n          && this.environment\n          && this.repositories\n          && this.views;\n    },\n  },\n  watch: {\n    async viewId() {\n      try {\n        this.viewItemsLoading = true;\n        await this.loadItems();\n        if (this.viewId) {\n          localStorage.setItem(`project${this.projectId}__lastVisitedViewId`, this.viewId);\n        } else {\n          localStorage.removeItem(`project${this.projectId}__lastVisitedViewId`);\n        }\n      } finally {\n        this.viewItemsLoading = false;\n      }\n    },\n  },\n  methods: {\n    async beforeLoadItems() {\n      await this.loadViews();\n    },\n\n    getViewUrl(viewId) {\n      if (viewId == null) {\n        return `/project/${this.projectId}/templates`;\n      }\n      return `/project/${this.projectId}/views/${viewId}/templates`;\n    },\n\n    async loadViews() {\n      this.views = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/views`,\n        responseType: 'json',\n      })).data;\n      this.views.sort((v1, v2) => v1.position - v2.position);\n\n      if (this.viewId != null && !this.views.some((v) => v.id === this.viewId)) {\n        await this.$router.push({ path: `/project/${this.projectId}/templates` });\n      }\n    },\n\n    async closeEditViewDialog() {\n      this.editViewsDialog = false;\n      await this.loadViews();\n    },\n\n    async onWebsocketDataReceived(data) {\n      if (data.project_id !== this.projectId || data.type !== 'update') {\n        return;\n      }\n\n      const template = this.items.find((item) => item.id === data.template_id);\n\n      if (template == null) {\n        return;\n      }\n\n      if (data.task_id !== template.last_task_id) {\n        Object.assign(template.last_task, (await axios({\n          method: 'get',\n          url: `/api/project/${this.projectId}/tasks/${data.task_id}`,\n          responseType: 'json',\n        })).data);\n        template.last_task_id = data.task_id;\n      }\n\n      Object.assign(template.last_task, {\n        ...data,\n        type: undefined,\n      });\n    },\n\n    onTaskCreated(e) {\n      EventBus.$emit('i-show-task', {\n        taskId: e.item.id,\n      });\n      this.itemId = null;\n    },\n\n    showTaskLog(taskId) {\n      EventBus.$emit('i-show-task', {\n        taskId,\n      });\n    },\n\n    createTask(itemId) {\n      this.itemId = itemId;\n      this.newTaskDialog = true;\n    },\n\n    getHeaders() {\n      return [\n        {\n          text: '模板名称',\n          value: 'alias',\n        },\n        {\n          text: '版本',\n          value: 'version',\n          sortable: false,\n        },\n        {\n          text: '状态',\n          value: 'status',\n          sortable: false,\n        },\n        {\n          text: '最近任务',\n          value: 'last_task',\n          sortable: false,\n        },\n        {\n          text: '剧本',\n          value: 'playbook',\n          sortable: false,\n        },\n        {\n          text: '主机清单',\n          value: 'inventory_id',\n          sortable: false,\n        },\n        {\n          text: '运行环境',\n          value: 'environment_id',\n          sortable: false,\n        },\n        {\n          text: '剧本库',\n          value: 'repository_id',\n          sortable: false,\n        },\n        {\n          text: '动作',\n          value: 'actions',\n          sortable: false,\n          width: '0%',\n        },\n      ];\n    },\n\n    getItemsUrl() {\n      return this.viewId == null\n        ? `/api/project/${this.projectId}/templates`\n        : `/api/project/${this.projectId}/views/${this.viewId}/templates`;\n    },\n\n    async loadData() {\n      this.inventory = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/inventory`,\n        responseType: 'json',\n      })).data;\n\n      this.environment = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/environment`,\n        responseType: 'json',\n      })).data;\n\n      this.repositories = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/repositories`,\n        responseType: 'json',\n      })).data;\n    },\n\n    onTableSettingsChange({ headers }) {\n      this.filteredHeaders = headers;\n    },\n  },\n};\n</script>\n"]}]}