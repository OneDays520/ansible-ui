{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/EditViewsForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/EditViewsForm.vue","mtime":1638860208857},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBkcmFnZ2FibGUgZnJvbSAndnVlZHJhZ2dhYmxlJzsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBwcm9wczogewogICAgcHJvamVjdElkOiBOdW1iZXIsCiAgfSwKCiAgY29tcG9uZW50czogewogICAgZHJhZ2dhYmxlLAogIH0sCgogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnZpZXdzID0gKGF3YWl0IGF4aW9zKHsKICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3ZpZXdzYCwKICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICB9KSkuZGF0YS5tYXAoKHZpZXcpID0+ICh7CiAgICAgIC4uLnZpZXcsCiAgICAgIGFjdGl2ZTogZmFsc2UsCiAgICAgIGRpc2FibGVkOiBmYWxzZSwKICAgIH0pKTsKICAgIHRoaXMudmlld3Muc29ydCgodjEsIHYyKSA9PiB2MS5wb3NpdGlvbiAtIHYyLnBvc2l0aW9uKTsKICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdmlld3M6IG51bGwsCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgb25EcmFnRW5kKCkgewogICAgICBjb25zdCB2aWV3UG9zaXRpb25zID0gdGhpcy52aWV3cy5yZWR1Y2UoKHJldCwgdmlldywgaW5kZXgpID0+IHsKICAgICAgICBpZiAodmlldy5pZCA8IDAgfHwgdmlldy5wb3NpdGlvbiA9PT0gaW5kZXgpIHsKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAuLi5yZXQsCiAgICAgICAgICBbdmlldy5pZF06IGluZGV4LAogICAgICAgIH07CiAgICAgIH0sIHt9KTsKCiAgICAgIGF3YWl0IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdmlld3MvcG9zaXRpb25zYCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgICBkYXRhOiB2aWV3UG9zaXRpb25zLAogICAgICB9KTsKCiAgICAgIE9iamVjdC5rZXlzKHZpZXdQb3NpdGlvbnMpLm1hcCgoaWQpID0+IHBhcnNlSW50KGlkLCAxMCkpLmZvckVhY2goKGlkKSA9PiB7CiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMudmlld3MuZmluZCgodikgPT4gdi5pZCA9PT0gaWQpOwogICAgICAgIHZpZXcucG9zaXRpb24gPSB2aWV3UG9zaXRpb25zW2lkXTsKICAgICAgfSk7CiAgICB9LAoKICAgIGFzeW5jIHNhdmVWaWV3KHZpZXdJZCkgewogICAgICBjb25zdCBpID0gdGhpcy52aWV3cy5maW5kSW5kZXgoKHYpID0+IHYuaWQgPT09IHZpZXdJZCk7CiAgICAgIGlmIChpID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgdmlldyA9IHRoaXMudmlld3NbaV07CgogICAgICBpZiAoIXZpZXcudGl0bGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZpZXcuZGlzYWJsZWQgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGlmICh2aWV3LmlkIDwgMCkgewogICAgICAgICAgY29uc3QgbmV3VmlldyA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdmlld3NgLAogICAgICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgIHByb2plY3RfaWQ6IHRoaXMucHJvamVjdElkLAogICAgICAgICAgICAgIHRpdGxlOiB2aWV3LnRpdGxlLAogICAgICAgICAgICAgIHBvc2l0aW9uOiBpLAogICAgICAgICAgICB9LAogICAgICAgICAgfSkpLmRhdGE7CiAgICAgICAgICB2aWV3LmlkID0gbmV3Vmlldy5pZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXdhaXQgYXhpb3MoewogICAgICAgICAgICBtZXRob2Q6ICdwdXQnLAogICAgICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdmlld3MvJHt2aWV3LmlkfWAsCiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgaWQ6IHZpZXcuaWQsCiAgICAgICAgICAgICAgcHJvamVjdF9pZDogdGhpcy5wcm9qZWN0SWQsCiAgICAgICAgICAgICAgdGl0bGU6IHZpZXcudGl0bGUsCiAgICAgICAgICAgICAgcG9zaXRpb246IGksCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdmlldy5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICAgIHZpZXcuYWN0aXZlID0gZmFsc2U7CiAgICB9LAoKICAgIGFzeW5jIHJlc2V0Vmlldyh2aWV3SWQpIHsKICAgICAgY29uc3QgdmlldyA9IHRoaXMudmlld3MuZmluZCgodikgPT4gdi5pZCA9PT0gdmlld0lkKTsKICAgICAgaWYgKHZpZXcgPT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmlldy5kaXNhYmxlZCA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgb2xkVmlldyA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3ZpZXdzLyR7dmlldy5pZH1gLAogICAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgICAgfSkpLmRhdGE7CiAgICAgICAgdmlldy50aXRsZSA9IG9sZFZpZXcudGl0bGU7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdmlldy5kaXNhYmxlZCA9IGZhbHNlOwogICAgICB9CgogICAgICB2aWV3LmFjdGl2ZSA9IGZhbHNlOwogICAgfSwKCiAgICBlZGl0Vmlldyh2aWV3SWQpIHsKICAgICAgY29uc3QgdmlldyA9IHRoaXMudmlld3MuZmluZCgodikgPT4gdi5pZCA9PT0gdmlld0lkKTsKICAgICAgaWYgKHZpZXcgPT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2aWV3LmFjdGl2ZSA9IHRydWU7CiAgICB9LAoKICAgIGFzeW5jIHJlbW92ZVZpZXcodmlld0lkKSB7CiAgICAgIGNvbnN0IGkgPSB0aGlzLnZpZXdzLmZpbmRJbmRleCgodikgPT4gdi5pZCA9PT0gdmlld0lkKTsKICAgICAgaWYgKGkgPT09IC0xKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2aWV3ID0gdGhpcy52aWV3c1tpXTsKCiAgICAgIGlmICh2aWV3LmlkID49IDApIHsKICAgICAgICB2aWV3LmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgYXdhaXQgYXhpb3MoewogICAgICAgICAgICBtZXRob2Q6ICdkZWxldGUnLAogICAgICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdmlld3MvJHt2aWV3LmlkfWAsCiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLAogICAgICAgICAgfSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHZpZXcuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudmlld3Muc3BsaWNlKGksIDEpOwogICAgfSwKICAgIGFkZFZpZXcoKSB7CiAgICAgIHRoaXMudmlld3MucHVzaCh7CiAgICAgICAgaWQ6IC1NYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwMCksCiAgICAgICAgdGl0bGU6ICcnLAogICAgICAgIGFjdGl2ZTogdHJ1ZSwKICAgICAgICBkaXNhYmxlZDogZmFsc2UsCiAgICAgIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["EditViewsForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"EditViewsForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div v-if=\"views != null\">\n    <draggable\n        v-if=\"views.length > 0\"\n        :list=\"views\"\n        handle=\".handle6785\"\n        class=\"mb-5\"\n        @end=\"onDragEnd\"\n    >\n      <div v-for=\"(view) in views\" :key=\"view.id\" class=\"d-flex mb-2\">\n        <v-icon class=\"handle6785\" style=\"cursor: move;\">mdi-menu</v-icon>\n        <v-text-field\n            class=\"ml-4 mr-1\"\n            hide-details\n            dense\n            solo\n            :flat=\"!view.active\"\n            v-model=\"view.title\"\n            @focus=\"editView(view.id)\"\n            :disabled=\"view.disabled\"\n        />\n        <v-btn\n            class=\"mt-1\"\n            small\n            icon\n            @click=\"saveView(view.id)\"\n            v-if=\"view.active\"\n            :disabled=\"view.disabled\"\n        >\n          <v-icon small color=\"green\">mdi-check</v-icon>\n        </v-btn>\n        <v-btn\n            class=\"mt-1\"\n            small\n            icon\n            @click=\"resetView(view.id)\"\n            v-if=\"view.active && view.id > 0\"\n            :disabled=\"view.disabled\"\n        >\n          <v-icon small color=\"red\">mdi-close</v-icon>\n        </v-btn>\n\n        <v-btn class=\"ml-4\" icon @click=\"removeView(view.id)\">\n          <v-icon>mdi-close</v-icon>\n        </v-btn>\n      </div>\n    </draggable>\n    <v-alert\n        v-else\n        type=\"info\"\n    >无视图</v-alert>\n    <v-btn @click=\"addView()\" color=\"primary\">添加视图</v-btn>\n  </div>\n</template>\n\n<script>\nimport draggable from 'vuedraggable';\nimport axios from 'axios';\n\nexport default {\n  props: {\n    projectId: Number,\n  },\n\n  components: {\n    draggable,\n  },\n\n  async created() {\n    this.views = (await axios({\n      method: 'get',\n      url: `/api/project/${this.projectId}/views`,\n      responseType: 'json',\n    })).data.map((view) => ({\n      ...view,\n      active: false,\n      disabled: false,\n    }));\n    this.views.sort((v1, v2) => v1.position - v2.position);\n  },\n\n  data() {\n    return {\n      views: null,\n    };\n  },\n  methods: {\n    async onDragEnd() {\n      const viewPositions = this.views.reduce((ret, view, index) => {\n        if (view.id < 0 || view.position === index) {\n          return ret;\n        }\n        return {\n          ...ret,\n          [view.id]: index,\n        };\n      }, {});\n\n      await axios({\n        method: 'post',\n        url: `/api/project/${this.projectId}/views/positions`,\n        responseType: 'json',\n        data: viewPositions,\n      });\n\n      Object.keys(viewPositions).map((id) => parseInt(id, 10)).forEach((id) => {\n        const view = this.views.find((v) => v.id === id);\n        view.position = viewPositions[id];\n      });\n    },\n\n    async saveView(viewId) {\n      const i = this.views.findIndex((v) => v.id === viewId);\n      if (i === -1) {\n        return;\n      }\n\n      const view = this.views[i];\n\n      if (!view.title) {\n        return;\n      }\n\n      view.disabled = true;\n      try {\n        if (view.id < 0) {\n          const newView = (await axios({\n            method: 'post',\n            url: `/api/project/${this.projectId}/views`,\n            responseType: 'json',\n            data: {\n              project_id: this.projectId,\n              title: view.title,\n              position: i,\n            },\n          })).data;\n          view.id = newView.id;\n        } else {\n          await axios({\n            method: 'put',\n            url: `/api/project/${this.projectId}/views/${view.id}`,\n            responseType: 'json',\n            data: {\n              id: view.id,\n              project_id: this.projectId,\n              title: view.title,\n              position: i,\n            },\n          });\n        }\n      } finally {\n        view.disabled = false;\n      }\n      view.active = false;\n    },\n\n    async resetView(viewId) {\n      const view = this.views.find((v) => v.id === viewId);\n      if (view == null) {\n        return;\n      }\n\n      view.disabled = true;\n      try {\n        const oldView = (await axios({\n          method: 'get',\n          url: `/api/project/${this.projectId}/views/${view.id}`,\n          responseType: 'json',\n        })).data;\n        view.title = oldView.title;\n      } finally {\n        view.disabled = false;\n      }\n\n      view.active = false;\n    },\n\n    editView(viewId) {\n      const view = this.views.find((v) => v.id === viewId);\n      if (view == null) {\n        return;\n      }\n      view.active = true;\n    },\n\n    async removeView(viewId) {\n      const i = this.views.findIndex((v) => v.id === viewId);\n      if (i === -1) {\n        return;\n      }\n\n      const view = this.views[i];\n\n      if (view.id >= 0) {\n        view.disabled = true;\n        try {\n          await axios({\n            method: 'delete',\n            url: `/api/project/${this.projectId}/views/${view.id}`,\n            responseType: 'json',\n          });\n        } finally {\n          view.disabled = false;\n        }\n      }\n\n      this.views.splice(i, 1);\n    },\n    addView() {\n      this.views.push({\n        id: -Math.round(Math.random() * 10000000),\n        title: '',\n        active: true,\n        disabled: false,\n      });\n    },\n  },\n};\n</script>\n"]}]}