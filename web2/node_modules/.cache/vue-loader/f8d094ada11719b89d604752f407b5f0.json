{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/TaskLogView.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/TaskLogView.vue","mtime":1638931861025},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBUYXNrU3RhdHVzIGZyb20gJ0AvY29tcG9uZW50cy9UYXNrU3RhdHVzLnZ1ZSc7CmltcG9ydCBzb2NrZXQgZnJvbSAnQC9zb2NrZXQnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsgVGFza1N0YXR1cyB9LAogIHByb3BzOiB7CiAgICBpdGVtSWQ6IE51bWJlciwKICAgIHByb2plY3RJZDogTnVtYmVyLAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGl0ZW06IHt9LAogICAgICBvdXRwdXQ6IFtdLAogICAgICB1c2VyOiB7fSwKICAgIH07CiAgfSwKICB3YXRjaDogewogICAgYXN5bmMgaXRlbUlkKCkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIGF3YWl0IHRoaXMubG9hZERhdGEoKTsKICAgIH0sCgogICAgYXN5bmMgcHJvamVjdElkKCkgewogICAgICB0aGlzLnJlc2V0KCk7CiAgICAgIGF3YWl0IHRoaXMubG9hZERhdGEoKTsKICAgIH0sCiAgfSwKICBhc3luYyBjcmVhdGVkKCkgewogICAgc29ja2V0LmFkZExpc3RlbmVyKChkYXRhKSA9PiB0aGlzLm9uV2Vic29ja2V0RGF0YVJlY2VpdmVkKGRhdGEpKTsKICAgIGF3YWl0IHRoaXMubG9hZERhdGEoKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyBzdG9wVGFzaygpIHsKICAgICAgYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgIHVybDogYC9hcGkvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS90YXNrcy8ke3RoaXMuaXRlbUlkfS9zdG9wYCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSk7CiAgICB9LAoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLml0ZW0gPSB7fTsKICAgICAgdGhpcy5vdXRwdXQgPSBbXTsKICAgICAgdGhpcy51c2VyID0ge307CiAgICB9LAoKICAgIG9uV2Vic29ja2V0RGF0YVJlY2VpdmVkKGRhdGEpIHsKICAgICAgaWYgKGRhdGEucHJvamVjdF9pZCAhPT0gdGhpcy5wcm9qZWN0SWQgfHwgZGF0YS50YXNrX2lkICE9PSB0aGlzLml0ZW1JZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHsKICAgICAgICBjYXNlICd1cGRhdGUnOgogICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLml0ZW0sIHsKICAgICAgICAgICAgLi4uZGF0YSwKICAgICAgICAgICAgdHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdsb2cnOgogICAgICAgICAgdGhpcy5vdXRwdXQucHVzaChkYXRhKTsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB0aGlzLiRyZWZzLm91dHB1dC5zY3JvbGxUb3AgPSB0aGlzLiRyZWZzLm91dHB1dC5zY3JvbGxIZWlnaHQ7CiAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIGxvYWREYXRhKCkgewogICAgICB0aGlzLml0ZW0gPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3Rhc2tzLyR7dGhpcy5pdGVtSWR9YCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CgogICAgICB0aGlzLm91dHB1dCA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdGFza3MvJHt0aGlzLml0ZW1JZH0vb3V0cHV0YCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CgogICAgICB0aGlzLnVzZXIgPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiBgL2FwaS91c2Vycy8ke3RoaXMuaXRlbS51c2VyX2lkfWAsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgIH0pKS5kYXRhOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["TaskLogView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TaskLogView.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"task-log-view\" :class=\"{'task-log-view--with-message': item.message}\">\n    <v-alert\n        type=\"info\"\n        text\n        v-if=\"item.message\"\n    >{{ item.message }}\n    </v-alert>\n\n    <v-container class=\"pa-0 mb-2\">\n      <v-row no-gutters>\n        <v-col>\n          <v-list two-line subheader class=\"pa-0\">\n            <v-list-item class=\"pa-0\">\n              <v-list-item-content>\n                <div>\n                  <TaskStatus :status=\"item.status\"/>\n                </div>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list two-line subheader class=\"pa-0\">\n            <v-list-item class=\"pa-0\">\n              <v-list-item-content>\n                <v-list-item-title>作者</v-list-item-title>\n                <v-list-item-subtitle>{{ user.name }}</v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list two-line subheader class=\"pa-0\">\n            <v-list-item class=\"pa-0\">\n              <v-list-item-content>\n                <v-list-item-title>启动</v-list-item-title>\n                <v-list-item-subtitle>\n                  {{ item.start | formatDate }}\n                </v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list-item class=\"pa-0\">\n            <v-list-item-content>\n              <v-list-item-title>持续时间</v-list-item-title>\n              <v-list-item-subtitle>\n                {{ [item.start, item.end] | formatMilliseconds }}\n              </v-list-item-subtitle>\n            </v-list-item-content>\n          </v-list-item>\n        </v-col>\n      </v-row>\n    </v-container>\n    <div class=\"task-log-records\" ref=\"output\">\n      <div class=\"task-log-records__record\" v-for=\"record in output\" :key=\"record.id\">\n        <div class=\"task-log-records__time\">\n          {{ record.time | formatTime }}\n        </div>\n        <div class=\"task-log-records__output\">{{ record.output }}</div>\n      </div>\n    </div>\n\n    <v-btn\n        color=\"error\"\n        style=\"position: absolute; bottom: 10px; right: 10px;\"\n        v-if=\"item.status === 'running' || item.status === 'waiting'\"\n        @click=\"stopTask()\"\n    >\n      Stop\n    </v-btn>\n  </div>\n</template>\n\n<style lang=\"scss\">\n\n@import '~vuetify/src/styles/settings/_variables';\n\n.task-log-view {\n}\n\n.task-log-records {\n  background: black;\n  color: white;\n  height: calc(100vh - 250px);\n  overflow: auto;\n  font-family: monospace;\n  margin: 0 -24px;\n  padding: 5px 10px;\n}\n\n.task-log-view--with-message .task-log-records {\n  height: calc(100vh - 300px);\n}\n\n.task-log-records__record {\n  display: flex;\n  flex-direction: row;\n  justify-content: left;\n}\n\n.task-log-records__time {\n  width: 120px;\n  min-width: 120px;\n}\n\n.task-log-records__output {\n  width: 100%;\n}\n\n@media #{map-get($display-breakpoints, 'sm-and-down')} {\n  .task-log-records {\n    height: calc(100vh - 340px);\n  }\n\n  .task-log-view--with-message .task-log-records {\n    height: calc(100vh - 370px);\n  }\n}\n</style>\n<script>\nimport axios from 'axios';\nimport TaskStatus from '@/components/TaskStatus.vue';\nimport socket from '@/socket';\n\nexport default {\n  components: { TaskStatus },\n  props: {\n    itemId: Number,\n    projectId: Number,\n  },\n  data() {\n    return {\n      item: {},\n      output: [],\n      user: {},\n    };\n  },\n  watch: {\n    async itemId() {\n      this.reset();\n      await this.loadData();\n    },\n\n    async projectId() {\n      this.reset();\n      await this.loadData();\n    },\n  },\n  async created() {\n    socket.addListener((data) => this.onWebsocketDataReceived(data));\n    await this.loadData();\n  },\n\n  methods: {\n    async stopTask() {\n      await axios({\n        method: 'post',\n        url: `/api/project/${this.projectId}/tasks/${this.itemId}/stop`,\n        responseType: 'json',\n      });\n    },\n\n    reset() {\n      this.item = {};\n      this.output = [];\n      this.user = {};\n    },\n\n    onWebsocketDataReceived(data) {\n      if (data.project_id !== this.projectId || data.task_id !== this.itemId) {\n        return;\n      }\n\n      switch (data.type) {\n        case 'update':\n          Object.assign(this.item, {\n            ...data,\n            type: undefined,\n          });\n          break;\n        case 'log':\n          this.output.push(data);\n          setTimeout(() => {\n            this.$refs.output.scrollTop = this.$refs.output.scrollHeight;\n          }, 200);\n          break;\n        default:\n          break;\n      }\n    },\n\n    async loadData() {\n      this.item = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/tasks/${this.itemId}`,\n        responseType: 'json',\n      })).data;\n\n      this.output = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/tasks/${this.itemId}/output`,\n        responseType: 'json',\n      })).data;\n\n      this.user = (await axios({\n        method: 'get',\n        url: `/api/users/${this.item.user_id}`,\n        responseType: 'json',\n      })).data;\n    },\n  },\n};\n</script>\n"]}]}