{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/views/project/History.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/views/project/History.vue","mtime":1638857107767},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBJdGVtTGlzdFBhZ2VCYXNlIGZyb20gJ0AvY29tcG9uZW50cy9JdGVtTGlzdFBhZ2VCYXNlJzsKaW1wb3J0IEV2ZW50QnVzIGZyb20gJ0AvZXZlbnQtYnVzJzsKaW1wb3J0IFRhc2tTdGF0dXMgZnJvbSAnQC9jb21wb25lbnRzL1Rhc2tTdGF0dXMudnVlJzsKaW1wb3J0IFRhc2tMaW5rIGZyb20gJ0AvY29tcG9uZW50cy9UYXNrTGluay52dWUnOwppbXBvcnQgc29ja2V0IGZyb20gJ0Avc29ja2V0JzsKaW1wb3J0IHsgVEVNUExBVEVfVFlQRV9JQ09OUyB9IGZyb20gJ0AvbGliL2NvbnN0YW50cyc7CgpleHBvcnQgZGVmYXVsdCB7CiAgbWl4aW5zOiBbSXRlbUxpc3RQYWdlQmFzZV0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4geyBURU1QTEFURV9UWVBFX0lDT05TIH07CiAgfSwKCiAgY29tcG9uZW50czogeyBUYXNrU3RhdHVzLCBUYXNrTGluayB9LAoKICB3YXRjaDogewogICAgYXN5bmMgcHJvamVjdElkKCkgewogICAgICBhd2FpdCB0aGlzLmxvYWRJdGVtcygpOwogICAgfSwKICB9LAoKICBjcmVhdGVkKCkgewogICAgc29ja2V0LmFkZExpc3RlbmVyKChkYXRhKSA9PiB0aGlzLm9uV2Vic29ja2V0RGF0YVJlY2VpdmVkKGRhdGEpKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICBzaG93VGFza0xvZyh0YXNrSWQpIHsKICAgICAgRXZlbnRCdXMuJGVtaXQoJ2ktc2hvdy10YXNrJywgewogICAgICAgIHRhc2tJZCwKICAgICAgfSk7CiAgICB9LAoKICAgIGFzeW5jIG9uV2Vic29ja2V0RGF0YVJlY2VpdmVkKGRhdGEpIHsKICAgICAgaWYgKGRhdGEucHJvamVjdF9pZCAhPT0gdGhpcy5wcm9qZWN0SWQgfHwgZGF0YS50eXBlICE9PSAndXBkYXRlJykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLml0ZW1zLnNvbWUoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IGRhdGEudGFza19pZCkpIHsKICAgICAgICBhd2FpdCB0aGlzLmxvYWRJdGVtcygpOwogICAgICB9CgogICAgICBjb25zdCB0YXNrID0gdGhpcy5pdGVtcy5maW5kKChpdGVtKSA9PiBpdGVtLmlkID09PSBkYXRhLnRhc2tfaWQpOwoKICAgICAgT2JqZWN0LmFzc2lnbih0YXNrLCB7CiAgICAgICAgLi4uZGF0YSwKICAgICAgICB0eXBlOiB1bmRlZmluZWQsCiAgICAgIH0pOwogICAgfSwKCiAgICBnZXRIZWFkZXJzKCkgewogICAgICByZXR1cm4gWwogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICfku7vliqEnLAogICAgICAgICAgdmFsdWU6ICd0cGxfYWxpYXMnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+eJiOacrCcsCiAgICAgICAgICB2YWx1ZTogJ3ZlcnNpb24nLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ+eKtuaAgScsCiAgICAgICAgICB2YWx1ZTogJ3N0YXR1cycsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiAn55So5oi3JywKICAgICAgICAgIHZhbHVlOiAndXNlcl9uYW1lJywKICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICflkK/liqgnLAogICAgICAgICAgdmFsdWU6ICdzdGFydCcsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0ZXh0OiAn5oyB57ut5pe26Ze0JywKICAgICAgICAgIHZhbHVlOiAnZW5kJywKICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSwKICAgICAgICB9LAogICAgICBdOwogICAgfSwKCiAgICBnZXRJdGVtc1VybCgpIHsKICAgICAgcmV0dXJuIGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdGFza3MvbGFzdGA7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["History.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8EA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"History.vue","sourceRoot":"src/views/project","sourcesContent":["<template xmlns:v-slot=\"http://www.w3.org/1999/XSL/Transform\">\n  <div v-if=\"items != null\">\n    <v-toolbar flat color=\"white\">\n      <v-app-bar-nav-icon @click=\"showDrawer()\"></v-app-bar-nav-icon>\n      <v-toolbar-title>仪表盘</v-toolbar-title>\n      <v-spacer></v-spacer>\n      <div>\n        <v-tabs centered>\n          <v-tab key=\"history\" :to=\"`/project/${projectId}/history`\">历史</v-tab>\n          <v-tab key=\"activity\" :to=\"`/project/${projectId}/activity`\">动作</v-tab>\n          <v-tab key=\"settings\" :to=\"`/project/${projectId}/settings`\">设置</v-tab>\n        </v-tabs>\n      </div>\n    </v-toolbar>\n    <v-data-table\n        :headers=\"headers\"\n        :items=\"items\"\n        :footer-props=\"{ itemsPerPageOptions: [20] }\"\n        class=\"mt-4\"\n    >\n      <template v-slot:item.tpl_alias=\"{ item }\">\n        <div class=\"d-flex\">\n          <v-icon class=\"mr-3\" small>\n            {{ TEMPLATE_TYPE_ICONS[item.tpl_type] }}\n          </v-icon>\n\n          <TaskLink\n              :task-id=\"item.id\"\n              :tooltip=\"item.message\"\n              :label=\"'#' + item.id\"\n          />\n\n          <v-icon small class=\"ml-1 mr-1\">mdi-arrow-left</v-icon>\n\n          <a :href=\"\n          '/project/' + item.project_id +\n          '/templates/' + item.template_id\"\n          >{{ item.tpl_alias }}</a>\n        </div>\n      </template>\n      <template v-slot:item.version=\"{ item }\">\n        <TaskLink\n            :disabled=\"item.tpl_type === 'build'\"\n            class=\"ml-2\"\n            v-if=\"item.tpl_type !== ''\"\n            :status=\"item.status\"\n\n            :task-id=\"item.tpl_type === 'build'\n              ? item.id\n              : item.build_task.id\"\n\n            :label=\"item.tpl_type === 'build'\n              ? item.version\n              : item.build_task.version\"\n\n            :tooltip=\"item.tpl_type === 'build'\n              ? item.message\n              : item.build_task.message\"\n        />\n        <div class=\"text-center\" v-else>&mdash;</div>\n      </template>\n\n      <template v-slot:item.status=\"{ item }\">\n        <TaskStatus :status=\"item.status\"/>\n      </template>\n\n      <template v-slot:item.start=\"{ item }\">\n        {{ item.start | formatDate }}\n      </template>\n\n      <template v-slot:item.end=\"{ item }\">\n        {{ [item.start, item.end] | formatMilliseconds }}\n      </template>\n    </v-data-table>\n  </div>\n</template>\n\n<script>\nimport ItemListPageBase from '@/components/ItemListPageBase';\nimport EventBus from '@/event-bus';\nimport TaskStatus from '@/components/TaskStatus.vue';\nimport TaskLink from '@/components/TaskLink.vue';\nimport socket from '@/socket';\nimport { TEMPLATE_TYPE_ICONS } from '@/lib/constants';\n\nexport default {\n  mixins: [ItemListPageBase],\n\n  data() {\n    return { TEMPLATE_TYPE_ICONS };\n  },\n\n  components: { TaskStatus, TaskLink },\n\n  watch: {\n    async projectId() {\n      await this.loadItems();\n    },\n  },\n\n  created() {\n    socket.addListener((data) => this.onWebsocketDataReceived(data));\n  },\n\n  methods: {\n    showTaskLog(taskId) {\n      EventBus.$emit('i-show-task', {\n        taskId,\n      });\n    },\n\n    async onWebsocketDataReceived(data) {\n      if (data.project_id !== this.projectId || data.type !== 'update') {\n        return;\n      }\n\n      if (!this.items.some((item) => item.id === data.task_id)) {\n        await this.loadItems();\n      }\n\n      const task = this.items.find((item) => item.id === data.task_id);\n\n      Object.assign(task, {\n        ...data,\n        type: undefined,\n      });\n    },\n\n    getHeaders() {\n      return [\n        {\n          text: '任务',\n          value: 'tpl_alias',\n          sortable: false,\n        },\n        {\n          text: '版本',\n          value: 'version',\n          sortable: false,\n        },\n        {\n          text: '状态',\n          value: 'status',\n          sortable: false,\n        },\n        {\n          text: '用户',\n          value: 'user_name',\n          sortable: false,\n        },\n        {\n          text: '启动',\n          value: 'start',\n          sortable: false,\n        },\n        {\n          text: '持续时间',\n          value: 'end',\n          sortable: false,\n        },\n      ];\n    },\n\n    getItemsUrl() {\n      return `/api/project/${this.projectId}/tasks/last`;\n    },\n  },\n};\n</script>\n"]}]}