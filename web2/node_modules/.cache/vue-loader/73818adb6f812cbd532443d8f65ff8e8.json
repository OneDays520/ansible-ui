{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/TaskLogView.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/TaskLogView.vue","mtime":1638931861025},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAnfnZ1ZXRpZnkvc3JjL3N0eWxlcy9zZXR0aW5ncy9fdmFyaWFibGVzJzsKCi50YXNrLWxvZy12aWV3IHsKfQoKLnRhc2stbG9nLXJlY29yZHMgewogIGJhY2tncm91bmQ6IGJsYWNrOwogIGNvbG9yOiB3aGl0ZTsKICBoZWlnaHQ6IGNhbGMoMTAwdmggLSAyNTBweCk7CiAgb3ZlcmZsb3c6IGF1dG87CiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsKICBtYXJnaW46IDAgLTI0cHg7CiAgcGFkZGluZzogNXB4IDEwcHg7Cn0KCi50YXNrLWxvZy12aWV3LS13aXRoLW1lc3NhZ2UgLnRhc2stbG9nLXJlY29yZHMgewogIGhlaWdodDogY2FsYygxMDB2aCAtIDMwMHB4KTsKfQoKLnRhc2stbG9nLXJlY29yZHNfX3JlY29yZCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93OwogIGp1c3RpZnktY29udGVudDogbGVmdDsKfQoKLnRhc2stbG9nLXJlY29yZHNfX3RpbWUgewogIHdpZHRoOiAxMjBweDsKICBtaW4td2lkdGg6IDEyMHB4Owp9CgoudGFzay1sb2ctcmVjb3Jkc19fb3V0cHV0IHsKICB3aWR0aDogMTAwJTsKfQoKQG1lZGlhICN7bWFwLWdldCgkZGlzcGxheS1icmVha3BvaW50cywgJ3NtLWFuZC1kb3duJyl9IHsKICAudGFzay1sb2ctcmVjb3JkcyB7CiAgICBoZWlnaHQ6IGNhbGMoMTAwdmggLSAzNDBweCk7CiAgfQoKICAudGFzay1sb2ctdmlldy0td2l0aC1tZXNzYWdlIC50YXNrLWxvZy1yZWNvcmRzIHsKICAgIGhlaWdodDogY2FsYygxMDB2aCAtIDM3MHB4KTsKICB9Cn0K"},{"version":3,"sources":["TaskLogView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8EA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"TaskLogView.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"task-log-view\" :class=\"{'task-log-view--with-message': item.message}\">\n    <v-alert\n        type=\"info\"\n        text\n        v-if=\"item.message\"\n    >{{ item.message }}\n    </v-alert>\n\n    <v-container class=\"pa-0 mb-2\">\n      <v-row no-gutters>\n        <v-col>\n          <v-list two-line subheader class=\"pa-0\">\n            <v-list-item class=\"pa-0\">\n              <v-list-item-content>\n                <div>\n                  <TaskStatus :status=\"item.status\"/>\n                </div>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list two-line subheader class=\"pa-0\">\n            <v-list-item class=\"pa-0\">\n              <v-list-item-content>\n                <v-list-item-title>作者</v-list-item-title>\n                <v-list-item-subtitle>{{ user.name }}</v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list two-line subheader class=\"pa-0\">\n            <v-list-item class=\"pa-0\">\n              <v-list-item-content>\n                <v-list-item-title>启动</v-list-item-title>\n                <v-list-item-subtitle>\n                  {{ item.start | formatDate }}\n                </v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list-item class=\"pa-0\">\n            <v-list-item-content>\n              <v-list-item-title>持续时间</v-list-item-title>\n              <v-list-item-subtitle>\n                {{ [item.start, item.end] | formatMilliseconds }}\n              </v-list-item-subtitle>\n            </v-list-item-content>\n          </v-list-item>\n        </v-col>\n      </v-row>\n    </v-container>\n    <div class=\"task-log-records\" ref=\"output\">\n      <div class=\"task-log-records__record\" v-for=\"record in output\" :key=\"record.id\">\n        <div class=\"task-log-records__time\">\n          {{ record.time | formatTime }}\n        </div>\n        <div class=\"task-log-records__output\">{{ record.output }}</div>\n      </div>\n    </div>\n\n    <v-btn\n        color=\"error\"\n        style=\"position: absolute; bottom: 10px; right: 10px;\"\n        v-if=\"item.status === 'running' || item.status === 'waiting'\"\n        @click=\"stopTask()\"\n    >\n      Stop\n    </v-btn>\n  </div>\n</template>\n\n<style lang=\"scss\">\n\n@import '~vuetify/src/styles/settings/_variables';\n\n.task-log-view {\n}\n\n.task-log-records {\n  background: black;\n  color: white;\n  height: calc(100vh - 250px);\n  overflow: auto;\n  font-family: monospace;\n  margin: 0 -24px;\n  padding: 5px 10px;\n}\n\n.task-log-view--with-message .task-log-records {\n  height: calc(100vh - 300px);\n}\n\n.task-log-records__record {\n  display: flex;\n  flex-direction: row;\n  justify-content: left;\n}\n\n.task-log-records__time {\n  width: 120px;\n  min-width: 120px;\n}\n\n.task-log-records__output {\n  width: 100%;\n}\n\n@media #{map-get($display-breakpoints, 'sm-and-down')} {\n  .task-log-records {\n    height: calc(100vh - 340px);\n  }\n\n  .task-log-view--with-message .task-log-records {\n    height: calc(100vh - 370px);\n  }\n}\n</style>\n<script>\nimport axios from 'axios';\nimport TaskStatus from '@/components/TaskStatus.vue';\nimport socket from '@/socket';\n\nexport default {\n  components: { TaskStatus },\n  props: {\n    itemId: Number,\n    projectId: Number,\n  },\n  data() {\n    return {\n      item: {},\n      output: [],\n      user: {},\n    };\n  },\n  watch: {\n    async itemId() {\n      this.reset();\n      await this.loadData();\n    },\n\n    async projectId() {\n      this.reset();\n      await this.loadData();\n    },\n  },\n  async created() {\n    socket.addListener((data) => this.onWebsocketDataReceived(data));\n    await this.loadData();\n  },\n\n  methods: {\n    async stopTask() {\n      await axios({\n        method: 'post',\n        url: `/api/project/${this.projectId}/tasks/${this.itemId}/stop`,\n        responseType: 'json',\n      });\n    },\n\n    reset() {\n      this.item = {};\n      this.output = [];\n      this.user = {};\n    },\n\n    onWebsocketDataReceived(data) {\n      if (data.project_id !== this.projectId || data.task_id !== this.itemId) {\n        return;\n      }\n\n      switch (data.type) {\n        case 'update':\n          Object.assign(this.item, {\n            ...data,\n            type: undefined,\n          });\n          break;\n        case 'log':\n          this.output.push(data);\n          setTimeout(() => {\n            this.$refs.output.scrollTop = this.$refs.output.scrollHeight;\n          }, 200);\n          break;\n        default:\n          break;\n      }\n    },\n\n    async loadData() {\n      this.item = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/tasks/${this.itemId}`,\n        responseType: 'json',\n      })).data;\n\n      this.output = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/tasks/${this.itemId}/output`,\n        responseType: 'json',\n      })).data;\n\n      this.user = (await axios({\n        method: 'get',\n        url: `/api/users/${this.item.user_id}`,\n        responseType: 'json',\n      })).data;\n    },\n  },\n};\n</script>\n"]}]}