{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/TaskList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/components/TaskList.vue","mtime":1638858930046},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBFdmVudEJ1cyBmcm9tICdAL2V2ZW50LWJ1cyc7CmltcG9ydCBUYXNrRm9ybSBmcm9tICdAL2NvbXBvbmVudHMvVGFza0Zvcm0udnVlJzsKaW1wb3J0IFRhc2tTdGF0dXMgZnJvbSAnQC9jb21wb25lbnRzL1Rhc2tTdGF0dXMudnVlJzsKaW1wb3J0IFRhc2tMaW5rIGZyb20gJ0AvY29tcG9uZW50cy9UYXNrTGluay52dWUnOwppbXBvcnQgRWRpdERpYWxvZyBmcm9tICdAL2NvbXBvbmVudHMvRWRpdERpYWxvZy52dWUnOwppbXBvcnQgeyBURU1QTEFURV9UWVBFX0FDVElPTl9USVRMRVMsIFRFTVBMQVRFX1RZUEVfSUNPTlMgfSBmcm9tICdAL2xpYi9jb25zdGFudHMnOwoKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEVkaXREaWFsb2csIFRhc2tTdGF0dXMsIFRhc2tGb3JtLCBUYXNrTGluaywKICB9LAogIHByb3BzOiB7CiAgICB0ZW1wbGF0ZTogT2JqZWN0LAogICAgbGltaXQ6IE51bWJlciwKICAgIGhpZGVGb290ZXI6IEJvb2xlYW4sCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaGVhZGVyczogWwogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICdUYXNrIElEJywKICAgICAgICAgIHZhbHVlOiAnaWQnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ1ZlcnNpb24nLAogICAgICAgICAgdmFsdWU6ICd2ZXJzaW9uJywKICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICdTdGF0dXMnLAogICAgICAgICAgdmFsdWU6ICdzdGF0dXMnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ1VzZXInLAogICAgICAgICAgdmFsdWU6ICd1c2VyX25hbWUnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ1N0YXJ0JywKICAgICAgICAgIHZhbHVlOiAnc3RhcnQnLAogICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ0R1cmF0aW9uJywKICAgICAgICAgIHZhbHVlOiAnZW5kJywKICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRleHQ6ICdBY3Rpb25zJywKICAgICAgICAgIHZhbHVlOiAnYWN0aW9ucycsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UsCiAgICAgICAgICB3aWR0aDogJzAlJywKICAgICAgICB9LAogICAgICBdLAogICAgICB0YXNrczogbnVsbCwKICAgICAgdGFza0lkOiBudWxsLAogICAgICBuZXdUYXNrRGlhbG9nOiBudWxsLAogICAgICBzb3VyY2VUYXNrOiBudWxsLAogICAgICBURU1QTEFURV9UWVBFX0lDT05TLAogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBhc3luYyB0ZW1wbGF0ZSgpIHsKICAgICAgYXdhaXQgdGhpcy5sb2FkRGF0YSgpOwogICAgfSwKICB9LAogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICBhd2FpdCB0aGlzLmxvYWREYXRhKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBsb2FkRGF0YSgpIHsKICAgICAgdGhpcy50YXNrcyA9IG51bGw7CiAgICAgIHRoaXMudGFza3MgPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy50ZW1wbGF0ZS5wcm9qZWN0X2lkfS90ZW1wbGF0ZXMvJHt0aGlzLnRlbXBsYXRlLmlkfS90YXNrcy9sYXN0P2xpbWl0PSR7dGhpcy5saW1pdCB8fCAyMDB9YCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CiAgICB9LAogICAgZ2V0QWN0aW9uQnV0dG9uVGl0bGUoKSB7CiAgICAgIHJldHVybiBURU1QTEFURV9UWVBFX0FDVElPTl9USVRMRVNbdGhpcy50ZW1wbGF0ZS50eXBlXTsKICAgIH0sCgogICAgb25UYXNrQ3JlYXRlZChlKSB7CiAgICAgIEV2ZW50QnVzLiRlbWl0KCdpLXNob3ctdGFzaycsIHsKICAgICAgICB0YXNrSWQ6IGUuaXRlbS5pZCwKICAgICAgfSk7CiAgICB9LAoKICAgIGNyZWF0ZVRhc2sodGFzaykgewogICAgICB0aGlzLnNvdXJjZVRhc2sgPSB0YXNrOwogICAgICB0aGlzLm5ld1Rhc2tEaWFsb2cgPSB0cnVlOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["TaskList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgFA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"TaskList.vue","sourceRoot":"src/components","sourcesContent":["<template xmlns:v-slot=\"http://www.w3.org/1999/XSL/Transform\">\n  <div v-if=\"tasks != null\">\n    <EditDialog\n        v-model=\"newTaskDialog\"\n        :save-button-text=\"'Re' + getActionButtonTitle()\"\n        @save=\"onTaskCreated\"\n    >\n      <template v-slot:title={}>\n        <v-icon class=\"mr-4\">{{ TEMPLATE_TYPE_ICONS[template.type] }}</v-icon>\n        <span class=\"breadcrumbs__item\">{{ template.alias }}</span>\n        <v-icon>mdi-chevron-right</v-icon>\n        <span class=\"breadcrumbs__item\">新任务</span>\n      </template>\n\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <TaskForm\n            :project-id=\"template.project_id\"\n            item-id=\"new\"\n            :template-id=\"template.id\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n            :commit-hash=\"sourceTask == null ? null : sourceTask.commit_hash\"\n            :commit-message=\"sourceTask == null ? null : sourceTask.commit_message\"\n            :build_task=\"sourceTask == null ? null : sourceTask.build_task\"\n        />\n      </template>\n    </EditDialog>\n\n    <v-data-table\n        :headers=\"headers\"\n        :items=\"tasks\"\n        :hide-default-footer=\"hideFooter\"\n        :footer-props=\"{ itemsPerPageOptions: [20] }\"\n        class=\"mt-0\"\n    >\n      <template v-slot:item.id=\"{ item }\">\n        <TaskLink\n            :task-id=\"item.id\"\n            :tooltip=\"item.message\"\n            :label=\"'#' + item.id\"\n        />\n      </template>\n\n      <template v-slot:item.version=\"{ item }\">\n        <div v-if=\"item.tpl_type !== ''\">\n          <TaskLink\n              :disabled=\"item.tpl_type === 'build'\"\n              :task-id=\"item.build_task_id\"\n              :tooltip=\"item.tpl_type === 'build' ? item.message : item.build_task.message\"\n              :label=\"item.tpl_type === 'build' ? item.version : item.build_task.version\"\n              :status=\"item.status\"\n          />\n        </div>\n        <div v-else>&mdash;</div>\n      </template>\n\n      <template v-slot:item.status=\"{ item }\">\n        <TaskStatus :status=\"item.status\"/>\n      </template>\n\n      <template v-slot:item.start=\"{ item }\">\n        {{ item.start | formatDate }}\n      </template>\n\n      <template v-slot:item.end=\"{ item }\">\n        {{ [item.start, item.end] | formatMilliseconds }}\n      </template>\n\n      <template v-slot:item.actions=\"{ item }\">\n        <v-btn text color=\"black\" class=\"pl-1 pr-2\" @click=\"createTask(item)\">\n          <v-icon class=\"pr-1\">mdi-replay</v-icon>\n          Re{{ getActionButtonTitle() }}\n        </v-btn>\n      </template>\n    </v-data-table>\n  </div>\n</template>\n<script>\nimport axios from 'axios';\nimport EventBus from '@/event-bus';\nimport TaskForm from '@/components/TaskForm.vue';\nimport TaskStatus from '@/components/TaskStatus.vue';\nimport TaskLink from '@/components/TaskLink.vue';\nimport EditDialog from '@/components/EditDialog.vue';\nimport { TEMPLATE_TYPE_ACTION_TITLES, TEMPLATE_TYPE_ICONS } from '@/lib/constants';\n\nexport default {\n  components: {\n    EditDialog, TaskStatus, TaskForm, TaskLink,\n  },\n  props: {\n    template: Object,\n    limit: Number,\n    hideFooter: Boolean,\n  },\n  data() {\n    return {\n      headers: [\n        {\n          text: 'Task ID',\n          value: 'id',\n          sortable: false,\n        },\n        {\n          text: 'Version',\n          value: 'version',\n          sortable: false,\n        },\n        {\n          text: 'Status',\n          value: 'status',\n          sortable: false,\n        },\n        {\n          text: 'User',\n          value: 'user_name',\n          sortable: false,\n        },\n        {\n          text: 'Start',\n          value: 'start',\n          sortable: false,\n        },\n        {\n          text: 'Duration',\n          value: 'end',\n          sortable: false,\n        },\n        {\n          text: 'Actions',\n          value: 'actions',\n          sortable: false,\n          width: '0%',\n        },\n      ],\n      tasks: null,\n      taskId: null,\n      newTaskDialog: null,\n      sourceTask: null,\n      TEMPLATE_TYPE_ICONS,\n    };\n  },\n  watch: {\n    async template() {\n      await this.loadData();\n    },\n  },\n  async created() {\n    await this.loadData();\n  },\n  methods: {\n    async loadData() {\n      this.tasks = null;\n      this.tasks = (await axios({\n        method: 'get',\n        url: `/api/project/${this.template.project_id}/templates/${this.template.id}/tasks/last?limit=${this.limit || 200}`,\n        responseType: 'json',\n      })).data;\n    },\n    getActionButtonTitle() {\n      return TEMPLATE_TYPE_ACTION_TITLES[this.template.type];\n    },\n\n    onTaskCreated(e) {\n      EventBus.$emit('i-show-task', {\n        taskId: e.item.id,\n      });\n    },\n\n    createTask(task) {\n      this.sourceTask = task;\n      this.newTaskDialog = true;\n    },\n  },\n};\n</script>\n"]}]}