{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/views/project/TemplateView.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/views/project/TemplateView.vue","mtime":1638867583221},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCBFdmVudEJ1cyBmcm9tICdAL2V2ZW50LWJ1cyc7CmltcG9ydCB7IGdldEVycm9yTWVzc2FnZSB9IGZyb20gJ0AvbGliL2Vycm9yJzsKaW1wb3J0IFllc05vRGlhbG9nIGZyb20gJ0AvY29tcG9uZW50cy9ZZXNOb0RpYWxvZy52dWUnOwppbXBvcnQgRWRpdERpYWxvZyBmcm9tICdAL2NvbXBvbmVudHMvRWRpdERpYWxvZy52dWUnOwppbXBvcnQgVGVtcGxhdGVGb3JtIGZyb20gJ0AvY29tcG9uZW50cy9UZW1wbGF0ZUZvcm0udnVlJzsKaW1wb3J0IFRhc2tMaXN0IGZyb20gJ0AvY29tcG9uZW50cy9UYXNrTGlzdC52dWUnOwppbXBvcnQgeyBURU1QTEFURV9UWVBFX0FDVElPTl9USVRMRVMsIFRFTVBMQVRFX1RZUEVfSUNPTlMsIFRFTVBMQVRFX1RZUEVfVElUTEVTIH0gZnJvbSAnQC9saWIvY29uc3RhbnRzJzsKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBZZXNOb0RpYWxvZywgRWRpdERpYWxvZywgVGVtcGxhdGVGb3JtLCBUYXNrTGlzdCwKICB9LAoKICBwcm9wczogewogICAgcHJvamVjdElkOiBOdW1iZXIsCiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGl0ZW06IG51bGwsCiAgICAgIGludmVudG9yeTogbnVsbCwKICAgICAgZW52aXJvbm1lbnQ6IG51bGwsCiAgICAgIHJlcG9zaXRvcmllczogbnVsbCwKICAgICAgZGVsZXRlRGlhbG9nOiBudWxsLAogICAgICBlZGl0RGlhbG9nOiBudWxsLAogICAgICBjb3B5RGlhbG9nOiBudWxsLAogICAgICBURU1QTEFURV9UWVBFX0lDT05TLAogICAgICBURU1QTEFURV9UWVBFX1RJVExFUywKICAgICAgVEVNUExBVEVfVFlQRV9BQ1RJT05fVElUTEVTLAogICAgfTsKICB9LAoKICBjb21wdXRlZDogewogICAgdmlld0lkKCkgewogICAgICBpZiAoL14tP1xkKyQvLnRlc3QodGhpcy4kcm91dGUucGFyYW1zLnZpZXdJZCkpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy4kcm91dGUucGFyYW1zLnZpZXdJZCwgMTApOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLiRyb3V0ZS5wYXJhbXMudmlld0lkOwogICAgfSwKCiAgICBpdGVtSWQoKSB7CiAgICAgIGlmICgvXi0/XGQrJC8udGVzdCh0aGlzLiRyb3V0ZS5wYXJhbXMudGVtcGxhdGVJZCkpIHsKICAgICAgICByZXR1cm4gcGFyc2VJbnQodGhpcy4kcm91dGUucGFyYW1zLnRlbXBsYXRlSWQsIDEwKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy4kcm91dGUucGFyYW1zLnRlbXBsYXRlSWQ7CiAgICB9LAogICAgaXNOZXcoKSB7CiAgICAgIHJldHVybiB0aGlzLml0ZW1JZCA9PT0gJ25ldyc7CiAgICB9LAogICAgaXNMb2FkZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLml0ZW0KICAgICAgICAgICYmIHRoaXMuaW52ZW50b3J5CiAgICAgICAgICAmJiB0aGlzLmVudmlyb25tZW50CiAgICAgICAgICAmJiB0aGlzLnJlcG9zaXRvcmllczsKICAgIH0sCiAgfSwKCiAgd2F0Y2g6IHsKICAgIGFzeW5jIGl0ZW1JZCgpIHsKICAgICAgYXdhaXQgdGhpcy5sb2FkRGF0YSgpOwogICAgfSwKICB9LAoKICBhc3luYyBjcmVhdGVkKCkgewogICAgaWYgKHRoaXMuaXNOZXcpIHsKICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnJlcGxhY2UoewogICAgICAgIHBhdGg6IGAvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS90ZW1wbGF0ZXMvbmV3L2VkaXRgLAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGF3YWl0IHRoaXMubG9hZERhdGEoKTsKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBzaG93RHJhd2VyKCkgewogICAgICBFdmVudEJ1cy4kZW1pdCgnaS1zaG93LWRyYXdlcicpOwogICAgfSwKCiAgICBhc3luYyByZW1vdmUoKSB7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgYXhpb3MoewogICAgICAgICAgbWV0aG9kOiAnZGVsZXRlJywKICAgICAgICAgIHVybDogYC9hcGkvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS90ZW1wbGF0ZXMvJHt0aGlzLml0ZW1JZH1gLAogICAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgICAgfSk7CgogICAgICAgIEV2ZW50QnVzLiRlbWl0KCdpLXNuYWNrYmFyJywgewogICAgICAgICAgY29sb3I6ICdzdWNjZXNzJywKICAgICAgICAgIHRleHQ6IGBUZW1wbGF0ZSAiJHt0aGlzLml0ZW0uYWxpYXN9IiBkZWxldGVkYCwKICAgICAgICB9KTsKCiAgICAgICAgYXdhaXQgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgcGF0aDogYC9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3RlbXBsYXRlc2AsCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIEV2ZW50QnVzLiRlbWl0KCdpLXNuYWNrYmFyJywgewogICAgICAgICAgY29sb3I6ICdlcnJvcicsCiAgICAgICAgICB0ZXh0OiBnZXRFcnJvck1lc3NhZ2UoZXJyKSwKICAgICAgICB9KTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmRlbGV0ZURpYWxvZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIG9uVGVtcGxhdGVDb3BpZWQoZSkgewogICAgICBhd2FpdCB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgcGF0aDogYC9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3RlbXBsYXRlcy8ke2UuaXRlbS5pZH1gLAogICAgICB9KTsKICAgIH0sCgogICAgYXN5bmMgbG9hZERhdGEoKSB7CiAgICAgIHRoaXMuaXRlbSA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vdGVtcGxhdGVzLyR7dGhpcy5pdGVtSWR9YCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CgogICAgICB0aGlzLmludmVudG9yeSA9IChhd2FpdCBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICB1cmw6IGAvYXBpL3Byb2plY3QvJHt0aGlzLnByb2plY3RJZH0vaW52ZW50b3J5YCwKICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJywKICAgICAgfSkpLmRhdGE7CgogICAgICB0aGlzLmVudmlyb25tZW50ID0gKGF3YWl0IGF4aW9zKHsKICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgIHVybDogYC9hcGkvcHJvamVjdC8ke3RoaXMucHJvamVjdElkfS9lbnZpcm9ubWVudGAsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgIH0pKS5kYXRhOwoKICAgICAgdGhpcy5yZXBvc2l0b3JpZXMgPSAoYXdhaXQgYXhpb3MoewogICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgdXJsOiBgL2FwaS9wcm9qZWN0LyR7dGhpcy5wcm9qZWN0SWR9L3JlcG9zaXRvcmllc2AsCiAgICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsCiAgICAgIH0pKS5kYXRhOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["TemplateView.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TemplateView.vue","sourceRoot":"src/views/project","sourcesContent":["<template xmlns:v-slot=\"http://www.w3.org/1999/XSL/Transform\">\n  <div v-if=\"!isLoaded\">\n    <v-progress-linear\n        indeterminate\n        color=\"primary darken-2\"\n    ></v-progress-linear>\n  </div>\n  <div v-else>\n\n    <EditDialog\n        :max-width=\"700\"\n        v-model=\"editDialog\"\n        save-button-text=\"Save\"\n        title=\"编辑模板\"\n        @save=\"loadData()\"\n    >\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <TemplateForm\n            :project-id=\"projectId\"\n            :item-id=\"itemId\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <EditDialog\n        v-model=\"copyDialog\"\n        save-button-text=\"创建\"\n        title=\"新模板\"\n        @save=\"onTemplateCopied\"\n    >\n      <template v-slot:form=\"{ onSave, onError, needSave, needReset }\">\n        <TemplateForm\n            :project-id=\"projectId\"\n            item-id=\"new\"\n            :source-item-id=\"itemId\"\n            @save=\"onSave\"\n            @error=\"onError\"\n            :need-save=\"needSave\"\n            :need-reset=\"needReset\"\n        />\n      </template>\n    </EditDialog>\n\n    <YesNoDialog\n        title=\"删除模板\"\n        text=\"Are you really want to delete this template?\"\n        v-model=\"deleteDialog\"\n        @yes=\"remove()\"\n    />\n\n    <v-toolbar flat color=\"white\">\n      <v-app-bar-nav-icon @click=\"showDrawer()\"></v-app-bar-nav-icon>\n      <v-toolbar-title class=\"breadcrumbs\">\n        <router-link\n            class=\"breadcrumbs__item breadcrumbs__item--link\"\n            :to=\"viewId\n              ? `/project/${projectId}/views/${viewId}/templates/`\n              : `/project/${projectId}/templates/`\"\n        >任务模板</router-link>\n        <v-icon>mdi-chevron-right</v-icon>\n        <span class=\"breadcrumbs__item\">{{ item.alias }}</span>\n      </v-toolbar-title>\n\n      <v-spacer></v-spacer>\n\n      <v-btn\n          icon\n          color=\"error\"\n          @click=\"deleteDialog = true\"\n      >\n        <v-icon>mdi-delete</v-icon>\n      </v-btn>\n\n      <v-btn\n          icon\n          color=\"black\"\n          @click=\"copyDialog = true\"\n      >\n        <v-icon>mdi-content-copy</v-icon>\n      </v-btn>\n\n      <v-btn\n          icon\n          color=\"black\"\n          @click=\"editDialog = true\"\n      >\n        <v-icon>mdi-pencil</v-icon>\n      </v-btn>\n    </v-toolbar>\n\n    <v-container>\n\n      <v-alert\n          text\n          type=\"info\"\n          class=\"mb-0 ml-4 mr-4 mb-2\"\n          v-if=\"item.description\"\n      >{{ item.description }}\n      </v-alert>\n\n      <v-row>\n        <v-col>\n          <v-list subheader dense>\n            <v-list-item>\n              <v-list-item-icon>\n                <v-icon>mdi-book-play</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                <v-list-item-title>剧本</v-list-item-title>\n                <v-list-item-subtitle>{{ item.playbook }}</v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list subheader dense>\n            <v-list-item>\n              <v-list-item-icon>\n                <v-icon>{{ TEMPLATE_TYPE_ICONS[item.type] }}</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                <v-list-item-title>任务类型</v-list-item-title>\n                <v-list-item-subtitle>{{ TEMPLATE_TYPE_TITLES[item.type] }}</v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list subheader dense>\n            <v-list-item>\n              <v-list-item-icon>\n                <v-icon>mdi-monitor</v-icon>\n              </v-list-item-icon>\n\n              <v-list-item-content>\n                <v-list-item-title>主机清单</v-list-item-title>\n                <v-list-item-subtitle>\n                  {{ inventory.find((x) => x.id === item.inventory_id).name }}\n                </v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list subheader dense>\n            <v-list-item>\n              <v-list-item-icon>\n                <v-icon>mdi-code-braces</v-icon>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title>运行环境</v-list-item-title>\n                <v-list-item-subtitle>\n                  {{ environment.find((x) => x.id === item.environment_id).name }}\n                </v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n        <v-col>\n          <v-list subheader dense>\n            <v-list-item>\n              <v-list-item-icon>\n                <v-icon>mdi-git</v-icon>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title>剧本仓库</v-list-item-title>\n                <v-list-item-subtitle>\n                  {{ repositories.find((x) => x.id === item.repository_id).name }}\n                </v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </v-list>\n        </v-col>\n      </v-row>\n    </v-container>\n\n    <TaskList :template=\"item\" />\n  </div>\n</template>\n<style lang=\"scss\">\n\n</style>\n<script>\nimport axios from 'axios';\nimport EventBus from '@/event-bus';\nimport { getErrorMessage } from '@/lib/error';\nimport YesNoDialog from '@/components/YesNoDialog.vue';\nimport EditDialog from '@/components/EditDialog.vue';\nimport TemplateForm from '@/components/TemplateForm.vue';\nimport TaskList from '@/components/TaskList.vue';\nimport { TEMPLATE_TYPE_ACTION_TITLES, TEMPLATE_TYPE_ICONS, TEMPLATE_TYPE_TITLES } from '@/lib/constants';\n\nexport default {\n  components: {\n    YesNoDialog, EditDialog, TemplateForm, TaskList,\n  },\n\n  props: {\n    projectId: Number,\n  },\n\n  data() {\n    return {\n      item: null,\n      inventory: null,\n      environment: null,\n      repositories: null,\n      deleteDialog: null,\n      editDialog: null,\n      copyDialog: null,\n      TEMPLATE_TYPE_ICONS,\n      TEMPLATE_TYPE_TITLES,\n      TEMPLATE_TYPE_ACTION_TITLES,\n    };\n  },\n\n  computed: {\n    viewId() {\n      if (/^-?\\d+$/.test(this.$route.params.viewId)) {\n        return parseInt(this.$route.params.viewId, 10);\n      }\n      return this.$route.params.viewId;\n    },\n\n    itemId() {\n      if (/^-?\\d+$/.test(this.$route.params.templateId)) {\n        return parseInt(this.$route.params.templateId, 10);\n      }\n      return this.$route.params.templateId;\n    },\n    isNew() {\n      return this.itemId === 'new';\n    },\n    isLoaded() {\n      return this.item\n          && this.inventory\n          && this.environment\n          && this.repositories;\n    },\n  },\n\n  watch: {\n    async itemId() {\n      await this.loadData();\n    },\n  },\n\n  async created() {\n    if (this.isNew) {\n      await this.$router.replace({\n        path: `/project/${this.projectId}/templates/new/edit`,\n      });\n    } else {\n      await this.loadData();\n    }\n  },\n\n  methods: {\n    showDrawer() {\n      EventBus.$emit('i-show-drawer');\n    },\n\n    async remove() {\n      try {\n        await axios({\n          method: 'delete',\n          url: `/api/project/${this.projectId}/templates/${this.itemId}`,\n          responseType: 'json',\n        });\n\n        EventBus.$emit('i-snackbar', {\n          color: 'success',\n          text: `Template \"${this.item.alias}\" deleted`,\n        });\n\n        await this.$router.push({\n          path: `/project/${this.projectId}/templates`,\n        });\n      } catch (err) {\n        EventBus.$emit('i-snackbar', {\n          color: 'error',\n          text: getErrorMessage(err),\n        });\n      } finally {\n        this.deleteDialog = false;\n      }\n    },\n\n    async onTemplateCopied(e) {\n      await this.$router.push({\n        path: `/project/${this.projectId}/templates/${e.item.id}`,\n      });\n    },\n\n    async loadData() {\n      this.item = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/templates/${this.itemId}`,\n        responseType: 'json',\n      })).data;\n\n      this.inventory = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/inventory`,\n        responseType: 'json',\n      })).data;\n\n      this.environment = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/environment`,\n        responseType: 'json',\n      })).data;\n\n      this.repositories = (await axios({\n        method: 'get',\n        url: `/api/project/${this.projectId}/repositories`,\n        responseType: 'json',\n      })).data;\n    },\n  },\n};\n</script>\n"]}]}