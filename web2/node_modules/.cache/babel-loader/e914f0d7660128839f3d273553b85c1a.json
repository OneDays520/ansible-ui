{"remainingRequest":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/thread-loader/dist/cjs.js!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/eslint-loader/index.js??ref--13-0!/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/lib/Socket.js","dependencies":[{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/lib/Socket.js","mtime":1638779901602},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICIvVXNlcnMvbHgvZ28vc3JjL2dpdGh1Yi5jb20vYW5zaWJsZS1zZW1hcGhvcmUvc2VtYXBob3JlL3dlYjIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvbHgvZ28vc3JjL2dpdGh1Yi5jb20vYW5zaWJsZS1zZW1hcGhvcmUvc2VtYXBob3JlL3dlYjIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0IF9pbmhlcml0cyBmcm9tICIvVXNlcnMvbHgvZ28vc3JjL2dpdGh1Yi5jb20vYW5zaWJsZS1zZW1hcGhvcmUvc2VtYXBob3JlL3dlYjIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2luaGVyaXRzIjsKaW1wb3J0IF9jcmVhdGVTdXBlciBmcm9tICIvVXNlcnMvbHgvZ28vc3JjL2dpdGh1Yi5jb20vYW5zaWJsZS1zZW1hcGhvcmUvc2VtYXBob3JlL3dlYjIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZVN1cGVyIjsKaW1wb3J0IExpc3RlbmFibGUgZnJvbSAnQC9saWIvTGlzdGVuYWJsZSc7Cgp2YXIgU29ja2V0ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfTGlzdGVuYWJsZSkgewogIF9pbmhlcml0cyhTb2NrZXQsIF9MaXN0ZW5hYmxlKTsKCiAgdmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihTb2NrZXQpOwoKICBmdW5jdGlvbiBTb2NrZXQod2Vic29ja2V0Q3JlYXRvcikgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTb2NrZXQpOwoKICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcyk7CiAgICBfdGhpcy53ZWJzb2NrZXRDcmVhdG9yID0gd2Vic29ja2V0Q3JlYXRvcjsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhTb2NrZXQsIFt7CiAgICBrZXk6ICJzdGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RhcnQoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMud3MgIT0gbnVsbCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignV2Vic29ja2V0IGFscmVhZHkgc3RhcnRlZC4gUGxlYXNlIHN0b3AgaXQgYmVmb3JlIHN0YXJ0aW5nLicpOwogICAgICB9CgogICAgICB0aGlzLndzID0gdGhpcy53ZWJzb2NrZXRDcmVhdG9yKCk7CgogICAgICB0aGlzLndzLm9uY2xvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFfdGhpczIuaXNSdW5uaW5nKCkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIF90aGlzMi53cyA9IG51bGw7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIuc3RhcnQoKTsKICAgICAgICB9LCAyMDAwKTsKICAgICAgfTsKCiAgICAgIHRoaXMud3Mub25tZXNzYWdlID0gZnVuY3Rpb24gKF9yZWYpIHsKICAgICAgICB2YXIgZGF0YSA9IF9yZWYuZGF0YTsKCiAgICAgICAgX3RoaXMyLmNhbGxMaXN0ZW5lcnMoSlNPTi5wYXJzZShkYXRhKSk7CiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNSdW5uaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc1J1bm5pbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLndzICE9IG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAic3RvcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RvcCgpIHsKICAgICAgaWYgKCF0aGlzLndzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLndzLmNsb3NlKCk7CiAgICAgIGRlbGV0ZSB0aGlzLndzOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFNvY2tldDsKfShMaXN0ZW5hYmxlKTsKCmV4cG9ydCB7IFNvY2tldCBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["/Users/lx/go/src/github.com/ansible-semaphore/semaphore/web2/src/lib/Socket.js"],"names":["Listenable","Socket","websocketCreator","ws","Error","onclose","isRunning","setTimeout","start","onmessage","data","callListeners","JSON","parse","close"],"mappings":";;;;AAAA,OAAOA,UAAP,MAAuB,kBAAvB;;IAEqBC,M;;;;;AACnB,kBAAYC,gBAAZ,EAA8B;AAAA;;AAAA;;AAC5B;AACA,UAAKA,gBAAL,GAAwBA,gBAAxB;AAF4B;AAG7B;;;;4BAEO;AAAA;;AACN,UAAI,KAAKC,EAAL,IAAW,IAAf,EAAqB;AACnB,cAAM,IAAIC,KAAJ,CAAU,4DAAV,CAAN;AACD;;AACD,WAAKD,EAAL,GAAU,KAAKD,gBAAL,EAAV;;AACA,WAAKC,EAAL,CAAQE,OAAR,GAAkB,YAAM;AACtB,YAAI,CAAC,MAAI,CAACC,SAAL,EAAL,EAAuB;AACrB;AACD;;AACD,QAAA,MAAI,CAACH,EAAL,GAAU,IAAV;AACAI,QAAAA,UAAU,CAAC,YAAM;AACf,UAAA,MAAI,CAACC,KAAL;AACD,SAFS,EAEP,IAFO,CAAV;AAGD,OARD;;AASA,WAAKL,EAAL,CAAQM,SAAR,GAAoB,gBAAc;AAAA,YAAXC,IAAW,QAAXA,IAAW;;AAChC,QAAA,MAAI,CAACC,aAAL,CAAmBC,IAAI,CAACC,KAAL,CAAWH,IAAX,CAAnB;AACD,OAFD;AAGD;;;gCAEW;AACV,aAAO,KAAKP,EAAL,IAAW,IAAlB;AACD;;;2BAEM;AACL,UAAI,CAAC,KAAKA,EAAV,EAAc;AACZ;AACD;;AACD,WAAKA,EAAL,CAAQW,KAAR;AACA,aAAO,KAAKX,EAAZ;AACD;;;;EAnCiCH,U;;SAAfC,M","sourcesContent":["import Listenable from '@/lib/Listenable';\n\nexport default class Socket extends Listenable {\n  constructor(websocketCreator) {\n    super();\n    this.websocketCreator = websocketCreator;\n  }\n\n  start() {\n    if (this.ws != null) {\n      throw new Error('Websocket already started. Please stop it before starting.');\n    }\n    this.ws = this.websocketCreator();\n    this.ws.onclose = () => {\n      if (!this.isRunning()) {\n        return;\n      }\n      this.ws = null;\n      setTimeout(() => {\n        this.start();\n      }, 2000);\n    };\n    this.ws.onmessage = ({ data }) => {\n      this.callListeners(JSON.parse(data));\n    };\n  }\n\n  isRunning() {\n    return this.ws != null;\n  }\n\n  stop() {\n    if (!this.ws) {\n      return;\n    }\n    this.ws.close();\n    delete this.ws;\n  }\n}\n"]}]}